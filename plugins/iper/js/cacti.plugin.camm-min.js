Ext.overrideIf=function(a,c){if(c){var b=a.prototype;for(var d in c){if(!b[d]){b[d]=c[d]}}}};Ext.tree.TreeLoader.override({processResponse:function(response,node,callback){var json=response.responseText;try{var o=eval("("+json+")");if(this.root!=null){o=eval("o."+this.root)}node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate();if(typeof callback=="function"){callback(this,node)}}catch(e){this.handleFailure(response)}}});Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++;var regexNum=Date.parseRegexes.length;var currentGroup=1;Date.parseFunctions[format]=funcName;var code="Date."+funcName+" = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1, ms = -1, o, z, u, v;\ninput = String(input);var d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {";var regex="";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;regex+=String.escape(ch)}else{var obj=Date.formatCodeToRegex(ch,currentGroup);currentGroup+=obj.g;regex+=obj.s;if(obj.g&&obj.c){code+=obj.c}}}}code+="if (u){\nv = new Date(u * 1000);\n}else if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0 && ms >= 0){\nv = new Date(y, m, d, h, i, s, ms);\n}else if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0){\nv = new Date(y, m, d, h, i, s);\n}else if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0){\nv = new Date(y, m, d, h, i);\n}else if (y >= 0 && m >= 0 && d > 0 && h >= 0){\nv = new Date(y, m, d, h);\n}else if (y >= 0 && m >= 0 && d > 0){\nv = new Date(y, m, d);\n}else if (y >= 0 && m >= 0){\nv = new Date(y, m);\n}else if (y >= 0){\nv = new Date(y);\n}\n}\nreturn (v && (z || o))? (Ext.type(z) == 'number' ? v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - z) : v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn))) : v;\n}";Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$","i");eval(code)};Ext.apply(Date.parseCodes,{j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},M:function(){for(var b=[],c=0;c<12;b.push(Date.getShortMonthName(c)),++c){}return Ext.applyIf({s:"("+b.join("|")+")"},Date.formatCodeToRegex("F"))},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},o:function(){return Date.formatCodeToRegex("Y")},g:function(){return Date.formatCodeToRegex("G")},h:function(){return Date.formatCodeToRegex("H")},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1);","var hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60);","var mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"}});Date.formatCodeToRegex=function(a,c){var b=Date.parseCodes[a];if(b){b=Ext.type(b)=="function"?b():b;Date.parseCodes[a]=b}return b?Ext.applyIf({c:b.c?String.format(b.c,c||"{0}"):b.c},b):{g:0,c:null,s:Ext.escapeRe(a)}};Date.prototype.getGMTOffset=function(a){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.abs(Math.floor(this.getTimezoneOffset()/60)),2,"0")+(a?":":"")+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0")};Ext.override(Ext.form.ComboBox,{setValue:function(c){if(this.store.getCount()==0){this.store.on("load",this.setValue.createDelegate(this,[c]),null,{single:true});return}var b=c;if(this.valueField){var a=this.findRecord(this.valueField,c);if(a){b=a.data[this.displayField]}else{if(this.valueNotFoundText!==undefined){b=this.valueNotFoundText}}}this.lastSelectionText=b;if(this.hiddenField){this.hiddenField.value=c}Ext.form.ComboBox.superclass.setValue.call(this,b);this.value=c}});Ext.override(Ext.form.FieldSet,{onCollapse:function(){Ext.form.FieldSet.superclass.onCollapse.apply(this,arguments);if(this.items){this.items.each(function(a){if(a instanceof Ext.form.Field){a.disable()}},this)}},onExpand:function(){Ext.form.FieldSet.superclass.onExpand.apply(this,arguments);if(this.items){this.items.each(function(a){if(a instanceof Ext.form.Field){a.enable()}},this)}}});Ext.override(Ext.Element,{findParent:function(f,k,j){var h=this.dom,d=document.body,a=0,l=Ext.DomQuery,g;k=k||50;if(typeof k!="number"){g=Ext.getDom(k);k=10}try{while(h&&h.nodeType==1&&a<k&&h!=d&&h!=g){if(l.is(h,f)){return j?Ext.get(h):h}a++;h=h.parentNode}}catch(c){}return null}});Ext.overrideIf(Array,{copy:function(){var c=[];for(var d=0,b=this.length;d<b;d++){c.push(this[d])}return c},indexOf:function(d,a){for(var e=+a||0,c=this.length;e<c;e++){if(this[e]===d){return e}}return -1},intersect:function(){if(!arguments.length){return[]}var d=this,h,f;for(var g=0,c=arguments.length;g<c;g++){f=[];h=arguments[g]||[];for(var b=0,e=d.length;b<e;b++){if(-1<h.indexOf(d[b])){f.push(d[b])}}d=f}return f.unique()},lastIndexOf:function(c,a){a=+a||0;var d=this.length;while(d-->a){if(this[d]===c){return d}}return -1},union:function(){var d=this.copy(),c;for(var e=0,g=arguments.length;e<g;e++){c=arguments[e]||[];for(var f=0,b=c.length;f<b;f++){d.push(c[f])}}return d.unique()},unique:function(){var c=[],d,b=this.length;for(d=0;d<b;d++){if(c.indexOf(this[d])<0){c.push(this[d])}}return c},contains:function(b){for(var a=0;a<this.length;++a){if(this[a]===b){return true}}return false},sub_contains:function(b){for(var a=0;a<this.length;++a){if(this[a][0]===b){return true}}return false}});Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.pPageSize=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.Andrie.pPageSize,Ext.util.Observable,{beforeText:"Show",afterText:"",addBefore:"-",addAfter:null,dynamic:false,variations:[5,10,20,50,100,200,500,1000],comboCfg:undefined,init:function(a){this.pagingToolbar=a;this.pagingToolbar.pageSizeCombo=this;this.pagingToolbar.setPageSize=this.setPageSize.createDelegate(this);this.pagingToolbar.getPageSize=function(){return this.pageSize};this.pagingToolbar.on("render",this.onRender,this)},addSize:function(a){if(a>0){this.sizes.push([a])}},updateStore:function(){if(this.dynamic){var c=this.pagingToolbar.pageSize,a;c=(c>0)?c:1;this.sizes=[];var d=this.variations;for(var e=0,b=d.length;e<b;e++){this.addSize(c-d[d.length-1-e])}this.addToStore(c);for(var e=0,b=d.length;e<b;e++){this.addSize(c+d[e])}}else{if(!this.staticSizes){this.sizes=[];var d=this.variations;var c=0;for(var e=0,b=d.length;e<b;e++){this.addSize(c+d[e])}this.staticSizes=this.sizes.slice(0)}else{this.sizes=this.staticSizes.slice(0)}}this.combo.store.loadData(this.sizes);this.combo.collapse();this.combo.setValue(this.pagingToolbar.pageSize)},setPageSize:function(a,e){var f=this.pagingToolbar;this.combo.collapse();a=parseInt(a)||parseInt(this.combo.getValue());a=(a>0)?a:1;if(a==f.pageSize){return}else{if(a<f.pageSize){f.pageSize=a;var g=Math.round(f.cursor/a)+1;var c=(g-1)*a;var b=f.store;if(c>b.getTotalCount()){this.pagingToolbar.pageSize=a;this.pagingToolbar.doLoad(c-a)}else{b.suspendEvents();for(var h=0,j=c-f.cursor;h<j;h++){b.remove(b.getAt(0))}while(b.getCount()>a){b.remove(b.getAt(b.getCount()-1))}b.resumeEvents();b.fireEvent("datachanged",b);f.cursor=c;var k=f.getPageData();f.afterTextEl.el.innerHTML=String.format(f.afterPageText,k.pages);f.field.dom.value=g;f.first.setDisabled(g==1);f.prev.setDisabled(g==1);f.next.setDisabled(g==k.pages);f.last.setDisabled(g==k.pages);f.updateInfo()}}else{this.pagingToolbar.pageSize=a;this.pagingToolbar.doLoad(Math.floor(this.pagingToolbar.cursor/this.pagingToolbar.pageSize)*this.pagingToolbar.pageSize)}}this.updateStore()},onRender:function(){this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.comboCfg||{},{store:new Ext.data.SimpleStore({fields:["pageSize"],data:[]}),displayField:"pageSize",valueField:"pageSize",mode:"local",triggerAction:"all",width:50,xtype:"combo"}));this.combo.on("select",this.setPageSize,this);this.updateStore();if(this.addBefore){this.pagingToolbar.add(this.addBefore)}if(this.beforeText){this.pagingToolbar.add(this.beforeText)}this.pagingToolbar.add(this.combo);if(this.afterText){this.pagingToolbar.add(this.afterText)}if(this.addAfter){this.pagingToolbar.add(this.addAfter)}}});Ext.ux.Andrie.AutoRefresher=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.Andrie.AutoRefresher,Ext.util.Observable,{intervals:[[0.2],[0.5],[1],[5],[10],[15],[30],[60]],beforeText:"Refresh every",afterText:"minutes",addBefore:"-",addAfter:null,init:function(a){this.Toolbar=a;if(a.store){this.store=a.store}a.on("render",this.onRender,this);this.store.startAutoRefresh=function(b){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}this.autoRefreshProcId=setInterval(this.reload.createDelegate(this,[{}]),b*1000)};this.store.stopAutoRefresh=function(){if(this.autoRefreshProcId){clearInterval(this.autoRefreshProcId)}}},update:function(b){var a=b.getValue();if(a>0){this.store.startAutoRefresh(a*60)}else{this.store.stopAutoRefresh()}},public_update:function(a){if(a>0){if(this.intervals.sub_contains(a)){this.store.startAutoRefresh(a*60);this.combo.setValue(a)}}else{this.store.stopAutoRefresh()}},onRender:function(){this.intervals.unshift([""]);var a={maskRe:/^d*$/,store:new Ext.data.SimpleStore({fields:["autoRefresh"],data:this.intervals}),displayField:"autoRefresh",typeAhead:true,mode:"local",emptyText:"never",triggerAction:"all",selectOnFocus:true,width:50};Ext.apply(a,this.comboCfg);this.combo=new Ext.form.ComboBox(a);this.combo.on("change",this.update,this);this.combo.on("select",this.update,this);if(this.addBefore){this.Toolbar.add(this.addBefore)}this.Toolbar.add(this.beforeText,this.combo,this.afterText);if(this.addAfter){this.Toolbar.add(this.addAfter)}this.combo.getEl().on("keydown",function(c){var b=c.getKey();switch(b){case Ext.EventObject.ENTER:this.update(this.combo)}},this)}});Ext.namespace("Ext.ux.layout");Ext.ux.layout.RowFitLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,trackChildEvents:["collapse","expand","hide","show"],renderAll:function(a,b){Ext.ux.layout.RowFitLayout.superclass.renderAll.apply(this,arguments);a.on("add",this.containerListener);a.on("remove",this.containerListener)},renderItem:function(a,b,e){Ext.ux.layout.RowFitLayout.superclass.renderItem.apply(this,arguments);for(var d=0,f=this.trackChildEvents.length;d<f;d++){a.on(this.trackChildEvents[d],this.itemListener)}a.animCollapse=false;a.rowFit={hasAbsHeight:false,relHeight:0,calcRelHeight:0,calcAbsHeight:0};if(a.height){if(typeof a.height=="string"&&a.height.indexOf("%")){a.rowFit.relHeight=parseInt(a.height)}else{a.setHeight(a.height);a.rowFit.hasAbsHeight=true}}},onLayout:function(l,m){Ext.ux.layout.RowFitLayout.superclass.onLayout.call(this,l,m);if(this.container.collapsed||!l.items||!l.items.length){return}var b=0,f=0,p=1,o=[],h=0;for(var e=0,a=l.items.length;e<a;e++){var q=l.items.itemAt(e);if(!q.isVisible()){continue}if(q.collapsed){b+=q.getFrameHeight()}else{if(q.rowFit.hasAbsHeight){b+=q.height}else{if(!q.rowFit.relHeight){h++}else{f+=q.rowFit.relHeight}o.push(q)}}}if(h==0&&f!=100){p=100/f}var k=m.getStyleSize().height-b,d=k;while(o.length){var q=o.shift(),j=q.rowFit.relHeight*p,g=0;if(!j){j=(100-f)/h}if(!o.length){g=d}else{g=Math.round(k*j/100)}if(g<0){g=0}q.rowFit.calcAbsHeight=g;q.rowFit.calcRelHeight=j;q.setHeight(g);d-=g}},itemListener:function(a){a.ownerCt.doLayout()},containerListener:function(a){a.doLayout()}});if(Ext.SplitBar.BasicLayoutAdapter){Ext.ux.layout.RowFitLayout.SplitAdapter=function(b){if(b&&b.el.dom.nextSibling){var a=Ext.getCmp(b.el.dom.nextSibling.id),c=Ext.getCmp(b.resizingEl.id);if(a){b.maxSize=(c.height||c.rowFit.calcAbsHeight)+a.getInnerHeight()-1}b.minSize=c.getFrameHeight()+1}};Ext.extend(Ext.ux.layout.RowFitLayout.SplitAdapter,Ext.SplitBar.BasicLayoutAdapter,{setElementSize:function(e,f,a){var d=Ext.getCmp(e.resizingEl.id);if(!d||d.collapsed||!d.isVisible()){return}if(d.rowFit.hasAbsHeight){d.setHeight(f)}else{if(e.el.dom.nextSibling){var c=Ext.getCmp(e.el.dom.nextSibling.id),k=f-d.rowFit.calcAbsHeight,b=c.rowFit,j=d.rowFit,g=j.calcRelHeight/j.calcAbsHeight,h=g*k;j.relHeight=j.calcRelHeight+h;if(b.hasAbsHeight){var l=c.height-k;c.height=l;c.setHeight(l)}else{b.relHeight=b.calcRelHeight-h}}}d.ownerCt.doLayout()}})}Ext.Container.LAYOUTS["row-fit"]=Ext.ux.layout.RowFitLayout;Ext.apply(Ext.DataView.prototype,{deselect:function(b,a){if(this.isSelected(b)){var b=this.getNode(b);this.selected.removeElement(b);if(this.last==b.viewIndex){this.last=false}Ext.fly(b).removeClass(this.selectedClass);if(!a){this.fireEvent("selectionchange",this,this.selected.elements)}}}});Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.Select=function(a){if(a.transform&&typeof a.multiSelect=="undefined"){var b=Ext.getDom(a.transform);a.multiSelect=(Ext.isIE?b.getAttributeNode("multiple").specified:b.hasAttribute("multiple"))}a.hideTrigger2=a.hideTrigger2||a.hideTrigger;Ext.ux.Andrie.Select.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.Andrie.Select,Ext.form.ComboBox,{multiSelect:false,minLength:0,minLengthText:"Minimum {0} items required",maxLength:Number.MAX_VALUE,maxLengthText:"Maximum {0} items allowed",clearTrigger:true,history:false,historyMaxLength:0,separator:",",displaySeparator:",",valueArray:[],rawValueArray:[],initComponent:function(){this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class}]};Ext.ux.Andrie.Select.superclass.initComponent.call(this);if(this.multiSelect){this.typeAhead=false;this.editable=false;this.triggerAction="all";this.selectOnFocus=false}if(this.history){this.forceSelection=false}if(this.value){this.setValue(this.value)}},hideTrigger1:true,getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-arrow-trigger",onTrigger2Click:function(){this.onTriggerClick()},onTrigger1Click:function(){this.clearValue()},initList:function(){if(!this.list){var a="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[a,this.listClass].join(" "),constrain:false});var b=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(b);this.list.swallowEvent("mousewheel");this.assetHeight=0;if(this.title){this.header=this.list.createChild({cls:a+"-hd",html:this.title});this.assetHeight+=this.header.getHeight()}this.innerList=this.list.createChild({cls:a+"-inner"});this.innerList.on("mouseover",this.onViewOver,this);this.innerList.on("mousemove",this.onViewMove,this);this.innerList.setWidth(b-this.list.getFrameWidth("lr"));if(this.pageSize){this.footer=this.list.createChild({cls:a+"-ft"});this.pageTb=new Ext.PagingToolbar({store:this.store,pageSize:this.pageSize,renderTo:this.footer});this.assetHeight+=this.footer.getHeight()}if(!this.tpl){this.tpl='<tpl for="."><div class="'+a+'-item">{'+this.displayField+"}</div></tpl>"}this.view=new Ext.DataView({applyTo:this.innerList,tpl:this.tpl,singleSelect:true,multiSelect:this.multiSelect,simpleSelect:true,overClass:a+"-cursor",selectedClass:this.selectedClass,itemSelector:this.itemSelector||"."+a+"-item"});this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.bindStore(this.store,true);if(this.valueArray.length){this.selectByValue(this.valueArray)}if(this.resizable){this.resizer=new Ext.Resizable(this.list,{pinned:true,handles:"se"});this.resizer.on("resize",function(c,d,e){this.maxHeight=e-this.handleHeight-this.list.getFrameWidth("tb")-this.assetHeight;this.listWidth=d;this.innerList.setWidth(d-this.list.getFrameWidth("lr"));this.restrictHeight()},this);this[this.pageSize?"footer":"innerList"].setStyle("margin-bottom",this.handleHeight+"px")}}},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(a){this.inKeyMode=true;this.hoverPrev()},down:function(a){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.hoverNext()}},enter:function(b){if(this.isExpanded()){this.inKeyMode=true;var a=this.view.indexOf(this.view.lastItem);this.onViewBeforeClick(this.view,a,this.view.getNode(a),b);this.onViewClick(this.view,a,this.view.getNode(a),b)}else{this.onSingleBlur()}return true},esc:function(a){this.collapse()},tab:function(a){this.collapse();return true},home:function(a){this.hoverFirst();return false},end:function(a){this.hoverLast();return false},scope:this,doRelay:function(b,a,c){if(c=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}if(c=="enter"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this)}if(!this.multiSelect){if(this.forceSelection){this.on("blur",this.doForce,this)}this.on("focus",this.onSingleFocus,this);this.on("blur",this.onSingleBlur,this)}this.on("change",this.onChange,this)},doForce:function(){if(this.el.dom.value.length>0){if(this.el.dom.value==this.emptyText){this.clearValue()}else{if(!this.multiSelect){this.el.dom.value=this.lastSelectionText===undefined?"":this.lastSelectionText;this.applyEmptyText()}}}},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}this.selectByValue(this.value,true)}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.onEmptyResults()}},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){this.addValue(a.data[this.valueField||this.displayField]);this.fireEvent("select",this,a,b);if(!this.multiSelect){this.collapse()}}},onSingleFocus:function(){this.oldValue=this.getRawValue()},onSingleBlur:function(){var a=this.findRecord(this.displayField,this.getRawValue());if(a){this.select(this.store.indexOf(a))}if(String(this.oldValue)!=String(this.getRawValue())){this.setValue(this.getRawValue());this.fireEvent("change",this,this.oldValue,this.getRawValue())}this.oldValue=String(this.getRawValue())},onChange:function(){if(!this.clearTrigger){return}if(this.getValue()!=""){this.triggers[0].show()}else{this.triggers[0].hide()}},collapse:function(){this.hoverOut();Ext.ux.Andrie.Select.superclass.collapse.call(this)},expand:function(){Ext.ux.Andrie.Select.superclass.expand.call(this)},onViewOver:function(b,a){if(this.inKeyMode){return}},onViewBeforeClick:function(c,a,b,d){this.preClickSelections=this.view.getSelectedIndexes()},onViewClick:function(a,d,g,b){if(typeof d!="undefined"){var c=this.preClickSelections.indexOf(d);if(c!=-1&&this.multiSelect){this.removeValue(this.store.getAt(d).data[this.valueField||this.displayField]);if(this.inKeyMode){this.view.deselect(d,true)}this.hover(d,true)}else{var f=this.store.getAt(d);if(f){if(this.inKeyMode){this.view.select(d,true)}this.onSelect(f,d);this.hover(d,true)}}}if(a!==false){this.el.focus()}},addValue:function(c){if(!this.multiSelect){this.setValue(c);return}if(c instanceof Array){c=c[0]}c=String(c);if(this.valueArray.indexOf(c)==-1){var a=c;var d=this.findRecord(this.valueField||displayField,c);if(d){a=d.data[this.displayField];if(this.view){this.select(this.store.indexOf(d))}}else{if(this.forceSelection){return}}var b=Ext.apply([],this.valueArray);b.push(c);var e=Ext.apply([],this.rawValueArray);e.push(a);c=b.join(this.separator||",");a=e.join(this.displaySeparator||this.separator||",");this.commonChangeValue(c,a,b,e)}},removeValue:function(c){if(c instanceof Array){c=c[0]}c=String(c);if(this.valueArray.indexOf(c)!=-1){var a=c;var d=this.findRecord(this.valueField||displayField,c);if(d){a=d.data[this.displayField];if(this.view){this.deselect(this.store.indexOf(d))}}else{if(this.forceSelection){return}}var b=Ext.apply([],this.valueArray);b.remove(c);var e=Ext.apply([],this.rawValueArray);e.remove(a);c=b.join(this.separator||",");a=e.join(this.displaySeparator||this.separator||",");this.commonChangeValue(c,a,b,e)}},setValue:function(g){var f=[],d=[];if(g!==null){if(!(g instanceof Array)){if(this.separator&&this.separator!==true){g=g.split(String(this.separator))}else{g=[g]}}else{if(!this.multiSelect){g=g.slice(0,1)}}for(var h=0,e=g.length;h<e;h++){var b=g[h];var c=null;if(this.valueField){var a=this.findRecord(this.valueField||this.displayField,b);if(a){c=a.data[this.displayField]}else{if(this.forceSelection){continue}else{var a=this.findRecord(this.displayField,b);c=b;b=a.data[this.valueField]}}}f.push(b);d.push(c)}}g=f.join(this.separator||",");c=d.join(this.displaySeparator||this.separator||",");this.commonChangeValue(g,c,f,d);if(this.history&&!this.multiSelect&&this.mode=="local"){this.addHistory(this.valueField?this.getValue():this.getRawValue())}if(this.view){this.view.clearSelections();this.selectByValue(this.valueArray)}},commonChangeValue:function(b,d,a,c){this.lastSelectionText=d;this.valueArray=a;this.rawValueArray=c;if(this.hiddenField){this.hiddenField.value=b}Ext.form.ComboBox.superclass.setValue.call(this,d);this.value=b;if(this.oldValueArray!=this.valueArray){this.fireEvent("change",this,this.oldValueArray,this.valueArray)}this.oldValueArray=Ext.apply([],this.valueArray)},validateValue:function(a){if(!Ext.ux.Andrie.Select.superclass.validateValue.call(this,a)){return false}if(this.valueArray.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(this.valueArray.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true},clearValue:function(){this.commonChangeValue("","",[],[]);if(this.view){this.view.clearSelections()}Ext.ux.Andrie.Select.superclass.clearValue.call(this)},reset:function(){if(this.view){this.view.clearSelections()}Ext.ux.Andrie.Select.superclass.reset.call(this)},getValue:function(a){if(a){return typeof this.valueArray!="undefined"?this.valueArray:[]}return Ext.ux.Andrie.Select.superclass.getValue.call(this)},getRawValue:function(a){if(a){return typeof this.rawValueArray!="undefined"?this.rawValueArray:[]}return Ext.ux.Andrie.Select.superclass.getRawValue.call(this)},select:function(c,b){this.selectedIndex=c;if(!this.view){return}this.view.select(c,this.multiSelect);if(b!==false){var a=this.view.getNode(c);if(a){this.innerList.scrollChildIntoView(a,false)}}},deselect:function(c,b){this.selectedIndex=c;this.view.deselect(c,this.multiSelect);if(b!==false){var a=this.view.getNode(c);if(a){this.innerList.scrollChildIntoView(a,false)}}},selectByValue:function(b,f){this.hoverOut();if(b!==undefined&&b!==null){if(!(b instanceof Array)){b=[b]}var a=[];for(var c=0,g=b.length;c<g;c++){var e=b[c];var d=this.findRecord(this.valueField||this.displayField,e);if(d){this.select(this.store.indexOf(d),f);a.push(e)}}return a.join(",")}return false},selectFirst:function(){var a=this.store.getCount();if(a>0){this.select(0)}},selectLast:function(){var a=this.store.getCount();if(a>0){this.select(a)}},hover:function(a,d){if(!this.view){return}this.hoverOut();var c=this.view.getNode(a);this.view.lastItem=c;Ext.fly(c).addClass(this.view.overClass);if(d!==false){var b=this.view.getNode(a);if(b){this.innerList.scrollChildIntoView(b,false)}}},hoverOut:function(){if(!this.view){return}if(this.view.lastItem){Ext.fly(this.view.lastItem).removeClass(this.view.overClass);delete this.view.lastItem}},hoverNext:function(){if(!this.view){return}var b=this.store.getCount();if(b>0){if(!this.view.lastItem){this.hover(0)}else{var a=this.view.indexOf(this.view.lastItem);if(a<b-1){this.hover(a+1)}}}},hoverPrev:function(){if(!this.view){return}var b=this.store.getCount();if(b>0){if(!this.view.lastItem){this.hover(0)}else{var a=this.view.indexOf(this.view.lastItem);if(a!=0){this.hover(a-1)}}}},hoverFirst:function(){var a=this.store.getCount();if(a>0){this.hover(0)}},hoverLast:function(){var a=this.store.getCount();if(a>0){this.hover(a)}},addHistory:function(a){if(!a.length){return}var c=this.findRecord(this.valueField||this.displayField,a);if(c){this.store.remove(c)}else{var b={};if(this.valueField){b[this.valueField]=a}b[this.displayField]=a;c=new this.store.reader.recordType(b)}this.store.clearFilter();this.store.insert(0,c);this.pruneHistory()},pruneHistory:function(){if(this.historyMaxLength==0){return}if(this.store.getCount()>this.historyMaxLength){var b=this.store.getRange(this.historyMaxLength,this.store.getCount());for(var a=0,c=b.length;a<c;a++){this.store.remove(b[a])}}}});Ext.reg("select",Ext.ux.Andrie.Select);Ext.ns("Ext.ux.form");Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"input",type:"hidden"},timeWidth:100,dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",dateFormat:"m/d/y",timeFormat:"g:i A",initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);this.validationTask=new Ext.util.DelayedTask(this.validate,this);var b=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,validationEvent:false,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);this.df=new Ext.form.DateField(b);delete (this.dateFormat);var a=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,width:this.timeWidth,selectOnFocus:this.selectOnFocus,validationEvent:false,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);this.tf=new Ext.form.TimeField(a);delete (this.timeFormat);this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);this.relayEvents(this.tf,["focus","specialkey","invalid","valid"])},filterValidation:function(a){if(!a.isNavKeyPress()){this.validationTask.delay(this.validationDelay)}},destroy:function(){if(this.df.rendered){this.df.destroy()}if(this.tf.rendered){this.tf.destroy()}Ext.ux.form.DateTime.superclass.destroy.call(this)},onRender:function(c,a){if(this.isRendered){return}Ext.ux.form.DateTime.superclass.onRender.call(this,c,a);var b;if("bellow"===this.timePosition){b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)}else{b=Ext.DomHelper.append(c,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)}this.tableEl=b;this.wrap=b.wrap({cls:"x-form-field-wrap"});this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});this.df.render(b.child("td.ux-datetime-date"));this.tf.render(b.child("td.ux-datetime-time"));this.df.getEl().on("keyup",this.filterValidation,this);this.tf.getEl().on("keyup",this.filterValidation,this);if(Ext.isIE&&Ext.isStrict){b.select("input").applyStyles({top:0})}this.on("specialkey",this.onSpecialKey,this);this.df.el.swallowEvent(["keydown","keypress"]);this.tf.el.swallowEvent(["keydown","keypress"]);if("side"===this.msgTarget){var d=this.el.findParent(".x-form-element",10,true);this.errorIcon=d.createChild({cls:"x-form-invalid-icon"});this.df.errorIcon=this.errorIcon;this.tf.errorIcon=this.errorIcon}this.isRendered=true;this.validate()},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},initTimeValue:function(){this.timeValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;this.df.onDisable();this.tf.onDisable()}this.disabled=true;this.df.disabled=true;this.tf.disabled=true;this.fireEvent("disable",this);return this},enable:function(){if(this.rendered){this.df.onEnable();this.tf.onEnable()}this.disabled=false;this.df.disabled=false;this.tf.disabled=false;this.fireEvent("enable",this);return this},focus:function(){this.df.focus()},getPositionEl:function(){return this.wrap},getResizeEl:function(){return this.wrap},getValue:function(){return(this.getDateTime())},isValid:function(){return this.df.isValid()&&this.tf.isValid()},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()},onBlur:function(a){if(this.wrapClick){a.focus();this.wrapClick=false}if(a===this.df){this.updateDate()}else{this.updateTime()}this.updateHidden();(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var b=this.getValue();if(String(b)!==String(this.startValue)){this.fireEvent("change",this,b,this.startValue)}this.hasFocus=false;this.fireEvent("blur",this)}}).defer(100,this)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.fireEvent("focus",this)}},onMouseDown:function(a){this.wrapClick="td"===a.target.nodeName.toLowerCase()},onSpecialKey:function(a,b){var c=b.getKey();if(c==b.TAB){if(a===this.df&&!b.shiftKey){b.stopEvent();this.tf.focus()}if(a===this.tf&&b.shiftKey){b.stopEvent();this.df.focus()}}if(c==b.ENTER){this.updateValue()}},setDate:function(a){this.df.setValue(a)},setTime:function(a){this.tf.setValue(a)},setSize:function(a,b){if(!a){return}if("bellow"==this.timePosition){this.df.setSize(a,b);this.tf.setSize(a,b);if(Ext.isIE){this.df.el.up("td").setWidth(a);this.tf.el.up("td").setWidth(a)}}else{this.df.setSize(a-this.timeWidth-4,b);this.tf.setSize(this.timeWidth,b);if(Ext.isIE){this.df.el.up("td").setWidth(a-this.timeWidth-4);this.tf.el.up("td").setWidth(this.timeWidth)}}},setValue:function(b){if(!b&&true===this.emptyToNow){this.setValue(new Date());return}else{if(!b){this.setDate("");this.setTime("");this.updateValue();if(this.rendered){this.validate()}return}}b=b?b:new Date(1970,0,1,0,0,0);var c,a;if(b instanceof Date){this.setDate(b);this.setTime(b);this.dateValue=new Date(b);this.timeValue=new Date(b)}else{c=b.split(this.dtSeparator);this.setDate(c[0]);if(c[1]){this.setTime(c[1])}}this.updateValue();if(this.rendered){this.validate()}},setVisible:function(a){if(a){this.df.show();this.tf.show()}else{this.df.hide();this.tf.hide()}return this},show:function(){return this.setVisible(true)},hide:function(){return this.setVisible(false)},updateDate:function(){var a=this.df.getValue();if(a){if(!(this.dateValue instanceof Date)){this.initDateValue()}this.dateValue.setMonth(0);this.dateValue.setFullYear(a.getFullYear());this.dateValue.setMonth(a.getMonth());this.dateValue.setDate(a.getDate())}else{this.dateValue=""}},updateTime:function(){var a=this.tf.getValue();if(a){if(!(a instanceof Date)){a=Date.parseDate(a,this.tf.format)}if(!(this.timeValue instanceof Date)){this.initTimeValue()}this.timeValue.setHours(a.getHours());this.timeValue.setMinutes(a.getMinutes());this.timeValue.setSeconds(a.getSeconds())}else{this.timeValue=""}},getDateTime:function(){if(this.dateValue instanceof Date&&this.timeValue instanceof Date){var a=new Date();a.setHours(this.timeValue.getHours());a.setMinutes(this.timeValue.getMinutes());a.setSeconds(this.timeValue.getSeconds());a.setMonth(0);a.setFullYear(this.dateValue.getFullYear());a.setMonth(this.dateValue.getMonth());a.setDate(this.dateValue.getDate());return(a)}else{if(this.dateValue instanceof Date){return(new Date(this.dateValue))}}return("")},updateHidden:function(){if(this.isRendered){var b="";var a=this.getDateTime();if(a instanceof Date){b=a.format(this.hiddenFormat)}this.el.dom.value=b}},updateValue:function(){this.updateDate();this.updateTime();this.updateHidden();return},validate:function(){var b=this.tf.validate();var a=this.df.validate();if(a){this.df.clearInvalid()}if(b){this.tf.clearInvalid()}if(a&&b){this.updateValue();return(this.validateValue(this.getValue()))}return(false)},markInvalid:function(a){this.df.markInvalid(a);this.tf.markInvalid(a)},clearInvalid:function(){this.df.clearInvalid();this.tf.clearInvalid()},renderer:function(b){var a=b.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;a+=" "+(b.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);var c=function(e){var d=Ext.util.Format.date(e,a);return d};return c}});Ext.reg("xdatetime",Ext.ux.form.DateTime);Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.Operator=function(b,a){this.id=b;this.label=((a==undefined)?b:a);this.field=null};Ext.ux.netbox.core.Operator.prototype={isAvailableValuesAvailable:function(){if(this.getField()===null){throw ("An operator must be associated to a Field to know if there is the list of the available values!")}return(this.getField().isAvailableValuesAvailable())},getAvailableValues:function(){if(!this.isAvailableValuesAvailable()){throw ("Available values not available!")}if(this.getField()==null){throw ("An operator must be associated to a field to obtain the list of the available values!")}return(this.getField().getAvailableValues())},getId:function(){return(this.id)},getLabel:function(){return(this.label)},setField:function(a){this.field=a},getField:function(){return(this.field)},render:function(a){if(this.getField()===undefined||this.getField()===null){throw ("Impossible to render a value from the operator "+this.getId()+" which is without field")}return(this.getField().render(a,this.getId()))},getEditor:function(c){if(this.getField()==undefined||this.getField()==null){throw ("Impossible to obtain the editor for the operator "+this.getId()+" which is without field")}var e;if(c===undefined){c=true}if(this.editor==null||!c){e=this.createEditor();var d=e.field;var f=d.validateValue;var b=this.validate;var a=this;d.validateValue=function(h){if(f.call(this,d.value)===false){return false}var g=b.call(a,e.getValue());if(g===true){return true}d.markInvalid(g)};if(c){this.editor=e}}else{e=this.editor}return(e)},convertValue:function(a){if(a!==null&&a!==undefined&&Ext.type(a)=="array"){if(a.length>0&&a[0].value!==undefined&&a[0].label!==undefined){if(a.length==1){return(a)}else{return([a[0]])}}}return([])},isStoreRemote:function(){if(this.getField()===undefined||this.getField()===null){throw ("Impossible to obtain the type of the store (remote/local) for the operator "+this.getId()+" which is without field")}return(this.getField().isStoreRemote())},isForceReload:function(){if(this.getField()===undefined||this.getField()===null){throw ("Impossible to obtain the forceReload info for the operator "+this.getId()+" which is without field")}return(this.getField().isForceReload())},isCaseSensitive:function(){if(this.getField()===undefined||this.getField()===null){throw ("Impossible to obtain the caseSensitive info for the operator "+this.getId()+" which is without field")}return(this.getField().isCaseSensitive())},getDefaultValues:function(){return(this.getField().getDefaultValues())},validate:function(b){if(this.validateFn!==undefined){return this.validateFn.call(this,b)}if(this.getField()===undefined||this.getField()===null){throw ("Impossible to call the validate function on the field: is not defined. Operation id: "+this.getId())}var a=this.getField().validate(b);if(a&&this.additionalValidationFn){a=this.additionalValidationFn.call(this,b)}return(a)},createEditor:function(){if(this.getField()===undefined||this.getField()===null){throw ("Impossible to create the editor for the operator "+this.getId()+" which is without field")}return(this.getField().createEditor(this.getId()))},addValidateFn:function(a){this.additionalValidationFn=a},setValidateFn:function(a){this.validateFn=a}};Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.Field=function(b,c,a){Ext.ux.netbox.core.Field.superclass.constructor.call(this);this.addEvents({operatorAdded:true,operatorRemoved:true,defaultOperatorChanged:true});this.id=b;this.label=((c===undefined)?b:c);this.availableOperators=[];this.defaultOperator=null;this.editor=null;this.availableValueStore=null;this.isRemote=true;this.forceReload=false;this.defaultValues=((a==undefined)?[]:a);this.validateFunc=null};Ext.extend(Ext.ux.netbox.core.Field,Ext.util.Observable,{caseSensitive:true,getDefaultValues:function(){return(this.defaultValues)},setDefaultValues:function(c){var b=[];for(var a=0;a<c.length;a++){if(c[a].label==undefined){c[a].label=c[a].value}b.push(c[a])}this.defaultValues=b},getDefaultOperator:function(){return(this.defaultOperator)},setDefaultOperator:function(c){var b=c.getId();var a=this.getAvailableOperatorById(b);if(a==null){throw ("operator not among available operators")}this.defaultOperator=c;this.fireEvent("defaultOperatorChanged",c)},getAvailableValues:function(){if(!this.isAvailableValuesAvailable()){throw ("Available values not available!")}return(this.availableValueStore)},setAvailableValues:function(a){this.availableValueStore=a;this.editor=null},isAvailableValuesAvailable:function(){return(this.availableValueStore!==null)},setStoreRemote:function(a){this.isRemote=a},isStoreRemote:function(){if(!this.isAvailableValuesAvailable()){throw (this.getId()+" isStoreRemote: no store available")}return(this.isRemote)},setForceReload:function(a){this.forceReload=a},isForceReload:function(){if(!this.isAvailableValuesAvailable()){throw (this.getId()+" isForceReload: no store available")}return(this.forceReload)},setCaseSensitive:function(a){this.caseSensitive=a},isCaseSensitive:function(){if(!this.isAvailableValuesAvailable()){throw (this.getId()+" isCaseSensitive: no store available")}return(this.caseSensitive)},addOperator:function(a){if(a.getField()!==null&&a.getField()!=this){throw ("Impossible to add the operator "+a.getId()+" to the Field "+this.getId()+". The operator is already associated to another Field")}this.availableOperators.push(a);a.setField(this);this.fireEvent("operatorAdded",a)},getAvailableOperators:function(){return(this.availableOperators)},getAvailableOperatorById:function(b){var a=this._getOperatorIndexById(b);if(a===null){return(null)}else{return(this.getAvailableOperators()[a])}},_getOperatorIndexById:function(b){var a=this.getAvailableOperators();for(var c=0;c<a.length;c++){if(a[c].getId()==b){return(c)}}return(null)},removeOperator:function(b){var a=this._getOperatorIndexById(b);if(a===null){throw ("The operator with the given id doesn't exist")}else{var c=this.getAvailableOperators()[a];if(c==this.getDefaultOperator){throw ("operator to remove is the DefaultOperator")}this.availableOperators.splice(a,1);this.fireEvent("operatorRemoved",c)}},getElementaryFilterInstance:function(a){var b=new Ext.ux.netbox.core.ElementaryFilter(this,a);return b},getId:function(){return(this.id)},getLabel:function(){return(this.label)},render:function(c,a){if(c!==undefined&&c!==null){if(Ext.type(c)=="array"){var d=[];for(var b=0;b<c.length;b++){d.push(this.render(c[b],a))}return(d.join(","))}else{if(c.value!==undefined&&c.label!==undefined){return(this.render(c.label,a))}return(String(c))}}else{return("")}},createEditor:function(a){var b;if(!this.isAvailableValuesAvailable()){b=new Ext.ux.netbox.core.TextValuesEditor()}else{b=new Ext.ux.netbox.core.AvailableValuesEditor(this.getAvailableValues(),{remote:this.isStoreRemote(),forceReload:this.isForceReload(),caseSensitive:this.isCaseSensitive()})}return b},setValidateFn:function(a){this.validateFunc=a},validate:function(a){if(this.validateFunc!==null){return this.validateFunc.call(this,a)}else{return true}},emptyNotAllowedFn:function(a){if(!a){return(this.emptyNotAllowed)}if(!a.length){return(this.emptyNotAllowed)}return(true)},emptyNotAllowed:"Empty value not allowed"});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.Filter=function(){Ext.ux.netbox.core.Filter.superclass.constructor.call(this)};Ext.extend(Ext.ux.netbox.core.Filter,Ext.util.Observable,{getFilterObj:function(){throw ("getFilterObj is an abstract method!")},setFilterObj:function(a){throw ("setFilterObj is an abstract method!")},getElementaryFilterById:function(a){throw ("getElementaryFilterById is an abstract method!")},getElementaryFiltersByFieldId:function(a){throw ("getElementaryFiltersByFieldId is an abstract method!")}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.ElementaryFilter=function(b,a){Ext.ux.netbox.core.ElementaryFilter.superclass.constructor.call(this);this.addEvents({operatorChanged:true,valueChanged:true});this.id=b.getId()+Ext.ux.netbox.core.ElementaryFilter.sequence;Ext.ux.netbox.core.ElementaryFilter.sequence++;this.field=b;this.operator;this.setOperator(((a==undefined)?b.getDefaultOperator():a));this.values;this.setValues(this.getOperator().getDefaultValues())};if(Ext.ux.netbox.core.ElementaryFilter.sequence==undefined){Ext.ux.netbox.core.ElementaryFilter.sequence=0}Ext.extend(Ext.ux.netbox.core.ElementaryFilter,Ext.ux.netbox.core.Filter,{getField:function(){return(this.field)},getOperator:function(){return(this.operator)},setOperator:function(a){if(a==null){throw ("Null Operator not allowed")}if(a.getId){if(this.field.getAvailableOperatorById(a.getId())==null){throw ("Operator "+a.getId()+" is not available for this elementaryFilter")}}else{var b=this.getField().getAvailableOperatorById(a);if(b==null){throw ("Operator "+a+" is not available for this elementaryFilter")}a=b}this.operator=a;this.fireEvent("operatorChanged",this,a);this.setValues(this.operator.convertValue(this.getValues()))},getValues:function(){if(this.values){return(this.values.concat())}return(this.values)},addValue:function(a){this.values.push(a);this.fireEvent("valueChanged",this,a)},removeValue:function(b){var a=-1;for(var c=0;c<this.getValues().length;c++){if(this.getValues()[c]==b){a=c;break}}if(a!=-1){this.values.splice(a,1);this.fireEvent("valueChanged",this,b)}else{throw ("Unable to remove the value "+b+". Not found")}},setValues:function(a){if(a===undefined||a===null){throw ("ElementaryFilter "+this.getId()+". Impossible to set a undefined or null value. The empty value is an empty array.")}if(Ext.type(a)!="array"){throw ("ElementaryFilter "+this.getId()+". The value of a ElementaryFilter MUST be an array!")}if(Ext.util.JSON.encode(this.values)!=Ext.util.JSON.encode(a)){if(this.getOperator().validate(a)===true||this.getOperator().validate(this.getValues())!==true){this.values=a;this.fireEvent("valueChanged",this,a)}}},getFilterObj:function(){return({fieldId:this.getField().getId(),operatorId:this.getOperator().getId(),values:this.getValues()})},setFilterObj:function(a){if(this.getField().getId()!=a.fieldId){throw ("Wrong field for this filter. Expected "+this.getField().getId()+" got "+a.fieldId)}this.setOperator(this.getField().getAvailableOperatorById(a.operatorId));this.setValues(a.values)},getId:function(){return(this.id)},getElementaryFilterById:function(a){if(this.getId()==a){return(this)}return(null)},getElementaryFiltersByFieldId:function(a){if(this.getField().getId()==a){return([this])}return([])},isValid:function(){if(this.values!==undefined&&this.getOperator().validate(this.values)===true){return true}else{return false}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.CompositeFilter=function(b,c,a){Ext.ux.netbox.core.CompositeFilter.superclass.constructor.call(this);this.addEvents({leftSideChanged:true,rightSideChanged:true,operatorChanged:true});this.left;this.setLeftSide(b);this.logicalOperator;this.setLogicalOperator(c);this.right;this.setRightSide(a)};Ext.ux.netbox.core.CompositeFilter.OR="OR";Ext.ux.netbox.core.CompositeFilter.AND="AND";Ext.extend(Ext.ux.netbox.core.CompositeFilter,Ext.ux.netbox.core.Filter,{AND:Ext.ux.netbox.core.CompositeFilter.AND,OR:Ext.ux.netbox.core.CompositeFilter.OR,setLogicalOperator:function(a){if(a!=Ext.ux.netbox.core.CompositeFilter.AND&&a!=Ext.ux.netbox.core.CompositeFilter.OR){throw ("Unknown logical operator : "+a)}this.logicalOperator=a;this.fireEvent("operatorChanged",this)},getLogicalOperator:function(){return(this.logicalOperator)},setRightSide:function(a){this.right=a;this.fireEvent("rightSideChanged",this)},getRightSide:function(){return(this.right)},setLeftSide:function(a){this.left=a;this.fireEvent("leftSideChanged",this)},getLeftSide:function(){return(this.left)},setFilterObj:function(a){this.setLeftSide(a.left);this.setLogicalOperator(a.logicalOperator);this.setRightSide(a.right)},getFilterObj:function(){return{left:this.getLeftSide(),logicalOperator:this.getLogicalOperator(),right:this.getRightSide()}},getElementaryFilterById:function(b){var a=this.getLeftSide().getElementaryFilterById(b);if(a!=null){return(a)}if(this.getRightSide()!=null){return(this.getRightSide().getElementaryFilterById(b))}return null},getElementaryFiltersByFieldId:function(a){var b=this.getLeftSide().getElementaryFiltersByFieldId(a);if(this.getRightSide()!=null){b=b.concat(this.getRightSide().getElementaryFiltersByFieldId(a))}return b}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.FieldManager=function(a){Ext.ux.netbox.core.FieldManager.superclass.constructor.call(this);this.addEvents({fieldAdded:true,fieldRemoved:true,beforeFieldRemoved:true});this.fields=new Ext.util.MixedCollection(false,function(c){return(c.getId())});if(a!==undefined){for(var b=0;b<a.length;b++){this.addField(a[b])}}};Ext.extend(Ext.ux.netbox.core.FieldManager,Ext.util.Observable,{getAllFields:function(){return(this.fields.getRange())},getFieldById:function(b){var a=this.fields.get(b);if(!a){return(null)}return(a)},createFieldFromCfg:function(b){var a;if(b.type===undefined){b.type="string"}switch(b.type){case"string":a=new Ext.ux.netbox.string.StringField(b.id,b.label);break;case"enum":a=new Ext.ux.netbox.string.EnumField(b.id,b.label);break;case"float":case"int":a=new Ext.ux.netbox.number.NumberField(b.id,b.label);break;case"date":a=new Ext.ux.netbox.date.DateField(b.id,b.label,b.format);break;default:return(null)}if(b.availableValues!==undefined){a.setAvailableValues(b.availableValues);if(b.remoteStore!==undefined){a.setStoreRemote(b.remoteStore)}if(b.type=="string"||b.type=="enum"){a.addOperator(new Ext.ux.netbox.string.StringListOperator("STRING_LIST",a.stringListText));a.addOperator(new Ext.ux.netbox.string.StringListOperator("STRING_NOT_IN_LIST",a.stringNotListText))}}if(b.defaultValues!==undefined){a.setDefaultValues(b.defaultValues)}if(b.forceReload!==undefined){a.setForceReload(b.forceReload)}if(b.caseSensitive!==undefined){a.setCaseSensitive(b.caseSensitive)}if(b.validate!==undefined){a.setValidateFn(b.validate)}return(a)},addField:function(a){if(!(a instanceof Ext.ux.netbox.core.Field)){a=this.createFieldFromCfg(a)}this.fields.add(a);this.fireEvent("fieldAdded",a)},removeField:function(a){if(this.fields.containsKey(a.getId())){if(this.fireEvent("beforeFieldRemoved",a)!==false){if(this.fields.removeKey(a.getId())){this.fireEvent("fieldRemoved",a)}}}},removeAll:function(){for(var a=this.fields.items.length-1;a>=0;a--){this.removeField(this.fields.items[a])}},reconfigure:function(a){this.removeAll();if(a!==undefined){for(var b=0;b<a.length;b++){this.addField(a[b])}}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.FilterModel=function(a){Ext.ux.netbox.core.FilterModel.superclass.constructor.call(this);this.addEvents({elementaryFilterAdded:true,elementaryFilterRemoved:true,filterChanged:true});this.filter=null;if(a instanceof Ext.ux.netbox.core.FieldManager){this.fieldManager=a}else{this.fieldManager=new Ext.ux.netbox.core.FieldManager(a)}this.fieldManager.on("beforeFieldRemoved",this.onBeforeFieldRemoved,this);if(a.logicalOperator===undefined){this.logicalOperator=Ext.ux.netbox.core.CompositeFilter.AND}else{this.logicalOperator=a.logicalOperator}};Ext.extend(Ext.ux.netbox.core.FilterModel,Ext.util.Observable,{onBeforeFieldRemoved:function(a){if(this.getElementaryFiltersByFieldId(a.getId()).length>0){return(false)}},_createFilter:function(d,c,b){var e=this.getFieldManager().getFieldById(d);if(e==null){throw ("Field "+d+" not found!")}var a=e.getElementaryFilterInstance();if(c!=undefined){a.setOperator(c)}if(b!=undefined){a.setValues(b)}return(a)},_addFilter:function(a){if(this.getFilter()==null){this.filter=a}else{this.filter=new Ext.ux.netbox.core.CompositeFilter(this.getFilter(),this.logicalOperator,a)}this.fireEvent("elementaryFilterAdded",this,a)},_decodeFilter:function(e){if(e.fieldId){var c=this.getFieldManager().getFieldById(e.fieldId);if(c==null){throw ("Field "+e.fieldId+" not found!")}var a=c.getAvailableOperatorById(e.operatorId);if(a===null){a=undefined}var d=c.getElementaryFilterInstance(a);d.setFilterObj(e);return(d)}else{var f=this._decodeFilter(e.left);var g=this._decodeFilter(e.right);var b=new Ext.ux.netbox.core.CompositeFilter(f,e.logicalOperator,g);return(b)}},_encodeFilter:function(b){if(b.setValues){return(b.getFilterObj())}else{var a=b.getFilterObj();a.left=this._encodeFilter(a.left);a.right=this._encodeFilter(a.right);return(a)}},_findAndRemoveFilter:function(b,a,e,d){if(a instanceof Ext.ux.netbox.core.ElementaryFilter){if(e.call(this,a)){d.push(a);return(true)}else{return(false)}}var f=this._findAndRemoveFilter(a,a.getLeftSide(),e,d);var c=this._findAndRemoveFilter(a,a.getRightSide(),e,d);if(c&&f){return(true)}if(f){if(b.getLeftSide()==a){b.setLeftSide(a.getRightSide())}else{b.setRightSide(a.getRightSide())}}if(c){if(b.getLeftSide()==a){b.setLeftSide(a.getLeftSide())}else{b.setRightSide(a.getLeftSide())}}return(false)},getFieldManager:function(){return(this.fieldManager)},getFilter:function(){return(this.filter)},getFilterObj:function(g,b,a){var k;if(b===undefined){k=null}else{k=this._decodeFilter(b)}if(a===undefined){a=Ext.ux.netbox.core.CompositeFilter.AND}var e=this.getFilter();var c=null;if(this.getFilter()!==null){if(e===null){c=k}else{c=this._decodeFilter(this._encodeFilter(this.getFilter()));if(k!==null){c=new Ext.ux.netbox.core.CompositeFilter(c,a,k)}}}if(c instanceof Ext.ux.netbox.core.ElementaryFilter){if(!c.isValid()){c=null}}else{if(c!==null){var j=function(l){return(!l.isValid())};var d=[];var f=this._findAndRemoveFilter(c,c.getLeftSide(),j,d);var h=this._findAndRemoveFilter(c,c.getRightSide(),j,d);if(f&&h){c=null}else{if(f){c=c.getRightSide()}else{if(h){c=c.getLeftSide()}}}}}if(c!=null){return(this._encodeFilter(c))}else{return null}},setFilterObj:function(a){if(a){if(!a.setFilterObj){a=this._decodeFilter(a)}}this.filter=a;this.fireEvent("filterChanged",this)},getElementaryFilterById:function(a){if(this.getFilter()!=null){return(this.getFilter().getElementaryFilterById(a))}return(null)},getElementaryFiltersByFieldId:function(a){if(this.getFilter()!=null){return(this.getFilter().getElementaryFiltersByFieldId(a))}return[]},addElementaryFilterByFieldId:function(a){var b=this._createFilter(a);this._addFilter(b);return(b.getId())},addElementaryFilter:function(b){var a=this._createFilter(b.fieldId,b.operatorId,b.values);this._addFilter(a);return(a.getId())},removeElementaryFilterById:function(d){var e=null;if(this.getFilter()==null){throw ("Unable to remove the elementaryFilter with id "+d+". The elementaryFilter doesn't exist.")}if(this.getFilter() instanceof Ext.ux.netbox.core.ElementaryFilter){if(this.getFilter().getId()==d){e=this.filter;this.filter=null}else{throw ("Unable to remove the elementaryFilter with id "+d+". The elementaryFilter doesn't exist")}}else{var a=function(g){if(g.getId()===d){return(true)}else{return(false)}};var f=[];var b=this._findAndRemoveFilter(this.getFilter(),this.getFilter().getLeftSide(),a,f);var c=this._findAndRemoveFilter(this.getFilter(),this.getFilter().getRightSide(),a,f);if(f.length===0){throw ("Unable to remove the elementaryFilter with id "+d+". The elementaryFilter doesn't exist")}e=f[0];if(b){this.filter=this.getFilter().getRightSide()}if(c){this.filter=this.getFilter().getLeftSide()}}this.fireEvent("elementaryFilterRemoved",this,e)},getAllElementaryFilters:function(b){if(b===undefined){b=this.getFilter()}var a=[];if(b!=null){if(b.setValues){a.push(b)}else{a=a.concat(this.getAllElementaryFilters(b.getLeftSide()));a=a.concat(this.getAllElementaryFilters(b.getRightSide()))}}return(a)},getLogicalOperator:function(){return this.logicalOperator},setLogicalOperator:function(a){if(a===Ext.ux.netbox.core.CompositeFilter.OR||a===Ext.ux.netbox.core.CompositeFilter.AND){this.logicalOperator=a}},each:function(b,a,c){if(c===undefined){c=this.getFilter()}if(c==null){return}if(a===undefined){a=window}b.call(a,c);if(c instanceof Ext.ux.netbox.core.CompositeFilter){this.each(b,a,c.getLeftSide());this.each(b,a,c.getRightSide())}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.DynamicFilterModelView=function(a){this.filterModel=a.filterModel;a=this.createFilterGridConfig(a);Ext.ux.netbox.core.DynamicFilterModelView.superclass.constructor.call(this,a);this.populateFilterStore();this.createFieldCombo();this.createLogicOpeCombo();this.setLogicOpeCombo();this.on("cellclick",this.removeFilter,this);this.on("beforeedit",this.updateOperatorStore,this);this.on("afteredit",this.updateFilter,this);this.getFilterModel().on("elementaryFilterAdded",this.onFilterAdded,this);this.getFilterModel().on("elementaryFilterRemoved",this.onFilterRemoved,this);this.getFilterModel().on("filterChanged",this.onFilterChanged,this);this.getFilterModel().getFieldManager().on("fieldAdded",this.onFieldAdded,this);this.getFilterModel().getFieldManager().on("fieldRemoved",this.onFieldRemoved,this);this.getView().getRowClass=function(d,f,g,c){var b="";var e=d.data.filter;if(!e.isValid()){b="x-grid3-row-notValid"}return b}};Ext.extend(Ext.ux.netbox.core.DynamicFilterModelView,Ext.grid.EditorGridPanel,{deleteText:"Delete",filterText:"Field",operatorText:"Operator",valueText:"Value",comboText:"Select a new field",logicOpeAndText:"Check all",logicOpeOrText:"Check at least one",getFilterModel:function(){return(this.filterModel)},onFieldAdded:function(a){this.addFields([a])},onFieldRemoved:function(a){this.removeFields(a)},onFilterAdded:function(b,a){var c=[];c.push(["",a.getField(),a.getOperator().getId(),a.getValues(),a,a.getId()]);this.filterStore.loadData(c,true);a.on("operatorChanged",this.updateFilterOperator,this);a.on("valueChanged",this.updateFilterValues,this)},onFilterRemoved:function(b,a){var c=this.filterStore.getById(a.getId());this.filterStore.remove(c);a.un("operatorChanged",this.updateFilterOperator,this);a.on("valueChanged",this.updateFilterValues,this)},onFilterChanged:function(){this.populateFilterStore();this.setLogicOpeCombo()},onEditComplete:function(d,g,c){this.editing=false;this.activeEditor=null;d.un("specialkey",this.selModel.onEditorKey,this.selModel);if(Ext.util.JSON.encode(g)!==Ext.util.JSON.encode(c)){var f=d.record;f.set=function(e,h){if(Ext.util.JSON.encode(this.data[e])==Ext.util.JSON.encode(h)){return}this.dirty=true;if(!this.modified){this.modified={}}if(typeof this.modified[e]=="undefined"){this.modified[e]=this.data[e]}this.data[e]=h;if(!this.editing){this.store.afterEdit(this)}};var b=this.colModel.getDataIndex(d.col);var a={grid:this,record:f,field:b,originalValue:c,value:g,row:d.row,column:d.col,cancel:false,renderTo:this};if(this.fireEvent("validateedit",a)!==false&&!a.cancel){f.set(b,a.value);delete a.cancel;this.fireEvent("afteredit",a)}}this.view.focusCell(d.row,d.col)},onRender:function(a){Ext.ux.netbox.core.DynamicFilterModelView.superclass.onRender.call(this,a);this.getTopToolbar().addField(this.fieldCombo);this.getTopToolbar().addSeparator();this.getTopToolbar().addField(this.logicOpeCombo)},createFilterGridConfig:function(a){this.filterStore=new Ext.data.SimpleStore({fields:["image","field","operatorId","value","filter","filterId"],data:[],id:5});this.operatorStore=new Ext.data.SimpleStore({fields:["operatorId","operatorLabel"],data:[]});var b=new Ext.form.ComboBox({store:this.operatorStore,mode:"local",valueField:"operatorId",displayField:"operatorLabel",editable:false,triggerAction:"all",lazyRender:true,listClass:"x-combo-list-small"});var c=new Ext.grid.ColumnModel([{header:this.deleteText,renderer:this.imageRenderer,width:50,dataIndex:"image"},{header:this.filterText,renderer:this.fieldRenderer,width:150,dataIndex:"field"},{header:this.operatorText,renderer:this.operatorRenderer,width:150,dataIndex:"operatorId",editor:b},{header:this.valueText,width:150,renderer:this.valueRenderer,editable:true,dataIndex:"value"}]);b.on("select",this.completeEditLater,this);c.getCellEditorOrig=c.getCellEditor;c.filterStore=this.filterStore;c.getCellEditor=function(e,g){if(e==3){var f=this.filterStore.getAt(g).get("filter");var d=f.getOperator();return(d.getEditor())}return(this.getCellEditorOrig(e,g))};a.store=this.filterStore;a.colModel=c;a.cm=c;a.clicksToEdit=1;a.autoExpandColumn="3";a.enableColumnHide=false;a.enableColumnMove=false;a.enableColumnResize=false;a.elements="body, tbar";if(a.tbar==undefined){a.tbar=[]}return(a)},completeEditLater:function(){var b=this.getColumnModel().getCellEditor(2);var a=b.completeEdit;var c=new Ext.util.DelayedTask(a,b);c.delay(0)},populateFilterStore:function(){this.filterStore.removeAll();for(var a=0;a<this.getFilterModel().getAllElementaryFilters().length;a++){this.onFilterAdded(this.getFilterModel(),this.getFilterModel().getAllElementaryFilters()[a])}},createFieldCombo:function(){this.fieldStore=new Ext.data.SimpleStore({fields:["fieldId","label"],data:[],id:0});var a=this.getFilterModel().getFieldManager().getAllFields();this.addFields(a);this.fieldCombo=new Ext.form.ComboBox({emptyText:this.comboText,displayField:"label",valueField:"fieldId",store:this.fieldStore,mode:"local",triggerAction:"all",selectOnFocus:true,typeAhead:true,editable:true});this.fieldCombo.on("select",this.addFilter,this)},createLogicOpeCombo:function(){var a=new Ext.data.SimpleStore({fields:["label","value"],data:[[this.logicOpeAndText,Ext.ux.netbox.core.CompositeFilter.AND],[this.logicOpeOrText,Ext.ux.netbox.core.CompositeFilter.OR]]});this.logicOpeCombo=new Ext.form.ComboBox({displayField:"label",valueField:"value",store:a,mode:"local",triggerAction:"all",selectOnFocus:true,editable:false,value:Ext.ux.netbox.core.CompositeFilter.AND});this.logicOpeCombo.on("select",this.chgLogicOpe,this)},setLogicOpeCombo:function(){var a=this.getFilterModel().getFilter();if(a instanceof Ext.ux.netbox.core.CompositeFilter){this.logicOpeCombo.setValue(a.getLogicalOperator())}},addFields:function(a){var c=[];for(var b=0;b<a.length;b++){c.push([a[b].getId(),a[b].getLabel()])}this.fieldStore.loadData(c,true);this.fieldStore.sort("label","ASC")},removeFields:function(b){var c=b.getId();var a=this.fieldStore.getById(c);this.fieldStore.remove(a)},addFilter:function(d,a,b){var c=this.getFilterModel().addElementaryFilterByFieldId(a.id);this.fieldCombo.clearValue();this.filterStore.indexOfId(c);this.startEditing(this.filterStore.indexOfId(c),3)},chgLogicOpe:function(d,a,c){var b=a.get("value");this.getFilterModel().setLogicalOperator(b);this.getFilterModel().each(function(e){if(e instanceof Ext.ux.netbox.core.CompositeFilter&&e.getLogicalOperator()!=b){e.setLogicalOperator(b)}})},removeFilter:function(d,b,f,a){if(f==0){var c=d.getStore().getAt(b);var e=c.get("filter");this.getFilterModel().removeElementaryFilterById(e.getId())}},updateOperatorStore:function(d){if(d.column==2){var c=d.record.get("field");var a=[];for(var b=0;b<c.getAvailableOperators().length;b++){a.push([c.getAvailableOperators()[b].getId(),c.getAvailableOperators()[b].getLabel()])}this.operatorStore.loadData(a,false)}},updateFilter:function(f){if(f.column==2){var c=f.record.get("filter");var b=f.record.get("operatorId");c.setOperator(b)}else{if(f.column==3){var c=f.record.get("filter");try{c.setValues(f.record.get("value"))}catch(a){var d=this.filterStore.getById(c.getId());d.set("value",c.getValues())}}}this.filterStore.commitChanges()},updateFilterOperator:function(b){var a=this.filterStore.getById(b.getId());if(a.get("operatorId")!=b.getOperator().getId()){a.set("operatorId",b.getOperator().getId())}this.filterStore.commitChanges()},updateFilterValues:function(b){var a=this.filterStore.getById(b.getId());if(Ext.util.JSON.encode(a.get("value"))!=Ext.util.JSON.encode(b.getValues())){a.set("value",b.getValues())}this.filterStore.commitChanges()},imageRenderer:function(a,f,c,b,e,d){return('<img class="x-menu-item-icon x-icon-delete" style="cursor: pointer" src="'+Ext.BLANK_IMAGE_URL+'"/>')},fieldRenderer:function(a,f,c,b,e,d){return(a.getLabel())},operatorRenderer:function(e,d,g,f,c,b){var a=g.get("filter").getField().getAvailableOperatorById(e);return(a.getLabel())},valueRenderer:function(a,f,c,b,e,d){return(c.get("filter").getOperator().render(a))}});Ext.reg("dynamicFilter",Ext.ux.netbox.core.DynamicFilterModelView);String.prototype.escHtml=function(){var a,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};var c=this;for(a in b){c=c.replace(new RegExp(a,"g"),b[a])}return c};Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.StaticFilterModelView=function(a){this.filterModel=a.filterModel;this.ratio=60;this.rowSize=27;if(a.rowSize!==undefined){this.rowSize=a.rowSize}if(a.ratio){this.ratio=a.ratio}a=this.createConfig(a);this.colsNumber=a.colsNumber;this.panelColumns=[];for(var b=0;b<this.colsNumber;b++){this.panelColumns[b]=null}Ext.ux.netbox.core.StaticFilterModelView.superclass.constructor.call(this,a);if(this.rendered){this.populateFields()}else{this.on("render",this.populateFields,this)}this.filterModel.getFieldManager().on("fieldAdded",this.addField,this);this.filterModel.getFieldManager().on("fieldRemoved",this.removeField,this);this.filterModel.on("elementaryFilterAdded",this.elementaryFilterAdded,this);this.filterModel.on("elementaryFilterRemoved",this.elementaryFilterRemoved,this);this.filterModel.on("filterChanged",this.populateFilters,this);this.fieldPanelMapping=new Ext.util.MixedCollection();this.filterEditorsMapping={};this.managedFilters=new Ext.util.MixedCollection();if(this.rendered){this.populateFilters()}else{this.on("render",this.populateFilters,this)}};Ext.extend(Ext.ux.netbox.core.StaticFilterModelView,Ext.form.FormPanel,{createConfig:function(a){a.layout="form";a.frame="true";if(!a.colsNumber){a.colsNumber=1}a.colsNumber=a.colsNumber*2;var d=1/(a.colsNumber);var g=[];var e=function(h,j){this.panelColumns[j]=h};for(var b=0;b<a.colsNumber;b++){var c;if(b%2===0){c=d*(this.ratio/100)*2}else{if(b%2===1){c=d*(1-(this.ratio/100))*2}}var f={columnWidth:c,layout:"anchor",items:null,plugins:{init:e.createDelegate(this,[b],true)}};g.push(f);if(b%2==1){g.push({width:15,style:"height: 1px"})}}a.items=[{layout:"column",items:g,anchor:"100% 100%"}];return(a)},getEditorPanelNumber:function(a){var c=this.fieldPanelMapping.get(a.getId());var f=c.getEditorComponent();var d=c.getOperatorCombo();var b=-1;for(var e=1;e<this.panelColumns.length;e+=2){if(this.panelColumns[e].items.contains(f)){b=e;break}}return(b)},elementaryFilterRemoved:function(b,h){var c=h.getField();var d=this.getEditorPanelNumber(c);var e=this.fieldPanelMapping.get(c.getId());var a=e.getEditorComponent();var g=e.getOperatorCombo();if(a.items&&a.items.getCount()>0){var f=a.items.first();a.remove(f)}if(g.getValue()!==""){g.clearValue()}h.un("operatorChanged",this.operatorChanged,this);h.un("valueChanged",this.valueChanged,this);this.managedFilters.remove(h)},elementaryFilterAdded:function(e,c){var h=c.getField();var j=this.getEditorPanelNumber(h);var b=this.fieldPanelMapping.get(h.getId());var k=b.getEditorComponent();var d=b.getOperatorCombo();d.setValue(c.getOperator().getId());var g=c.getOperator().getEditor(false);this.changeEditor(g,b);var a=b.getEditor().field;if(k.items&&k.items.getCount()>0){var f=k.items.first();k.remove(f)}this.addFormField(a,k);b.getEditor().editing=true;b.getEditor().setValue(c.getValues());b.getEditor().startValue=c.getValues();c.on("operatorChanged",this.operatorChanged,this);c.on("valueChanged",this.valueChanged,this);this.managedFilters.add(c)},changeEditor:function(b,a){if(a.getEditor()){a.getEditor().un("complete",this.editingCompleted,this);a.getEditor().field.un("change",this.editingCompleted,this)}a.setEditor(b);a.getEditor().on("complete",this.editingCompleted,this);a.getEditor().field.on("change",this.editingCompleted,this)},addFormField:function(b,a){a.add(b);a.doLayout()},operatorChanged:function(c,d){var g=c.getField();var a=this.fieldPanelMapping.get(g.getId());var b=a.getOperatorCombo();var j=a.getEditorComponent();if(b.getValue()!=d.getId()){b.setValue(d.getId())}var h=this.getEditorPanelNumber(g);var f=c.getOperator().getEditor(false);this.changeEditor(f,a);var k=a.getEditor().field;var e=j.items.first();j.remove(e);this.addFormField(k,j);a.getEditor().editing=true;a.getEditor().startValue=c.getValues();a.getEditor().setValue(c.getValues())},valueChanged:function(c,d){var a=this.fieldPanelMapping.get(c.getField().getId());var b=a.getEditor();b.setValue(d)},editingCompleted:function(c){var d=function(f){if(f.getEditor()&&(f.getEditor()==c||f.getEditor().field==c)){return(true)}return(false)};var b=this.fieldPanelMapping.find(d);var a=b.getField();var e=this.filterModel.getElementaryFiltersByFieldId(a.getId());if(Ext.util.JSON.encode(e[0].getValues())!==Ext.util.JSON.encode(b.getEditor().getValue())){e[0].setValues(b.getEditor().getValue())}b.getEditor().editing=true},populateFields:function(){var a=this.filterModel.getFieldManager().getAllFields();for(var b=0;b<a.length;b++){this.addField(a[b])}},removeField:function(e){var f=this.getEditorPanelNumber(e);var g=this.fieldPanelMapping.get(e.getId());var d=g.getEditorComponent();var b=g.getOperatorCombo();var a=d.items.first();d.remove(a,false);var c=b.getEl().up(".x-form-item");this.panelColumns[f-1].remove(b,true);c.remove();this.panelColumns[f].doLayout();this.panelColumns[f-1].doLayout();this.fieldPanelMapping.removeKey(e.getId())},operatorSelected:function(d,h,j){var k=function(l){if(l.getOperatorCombo()==d){return(true)}return(false)};var b=this.fieldPanelMapping.find(k);var a=b.getField();var c=this.filterModel.getElementaryFiltersByFieldId(a.getId());if(h.get("operatorId")===""){d.clearValue();if(c.length>0){this.filterModel.removeElementaryFilterById(c[0].getId())}return}if(h.get("operatorId")!==""&&c.length==0){var e=this.filterModel.addElementaryFilterByFieldId(a.getId());c.push(this.filterModel.getElementaryFilterById(e))}var g=a.getAvailableOperators();for(var f=0;f<g.length;f++){if(g[f].getId()===h.get("operatorId")){c[0].setOperator(g[f])}}return},populateFilters:function(){while(this.managedFilters.getCount()>0){var b=this.managedFilters.last();this.elementaryFilterRemoved(this.filterModel,b)}var c=this.filterModel.getAllElementaryFilters();for(var a=0;a<c.length;a++){this.elementaryFilterAdded(this.filterModel,c[a])}},addField:function(a){var d={};if(this.initialConfig.labelWidth!==undefined){d.labelWidth=this.initialConfig.labelWidth}if(this.initialConfig.hideLabels!==undefined){d.hideLabels=this.initialConfig.hideLabels}if(this.initialConfig.itemCls!==undefined){d.itemCls=this.initialConfig.itemCls}if(this.initialConfig.labelAlign!==undefined){d.labelAlign=this.initialConfig.labelAlign}if(this.initialConfig.labelPad!==undefined){d.labelPad=this.initialConfig.labelPad}var c=new Ext.ux.netbox.core.ElementaryFilterCfg(a,this.rowSize,d);var f=null;var b=0;for(var e=0;e<this.panelColumns.length;e+=2){if(!this.panelColumns[e].items){f=0;b=e;break}if(f==null||this.panelColumns[e].items.length<f){f=this.panelColumns[e].items.length;b=e}}this.fieldPanelMapping.add(a.getId(),c);c.getOperatorCombo().on("select",this.operatorSelected,this);d.layout="form";d.anchor="100%";d.items=[c.getOperatorCombo()];d.height=this.rowSize;this.panelColumns[b].add(d);this.panelColumns[b].doLayout();this.panelColumns[b+1].add(c.getEditorComponent());this.panelColumns[b+1].doLayout()}});Ext.reg("staticFilter",Ext.ux.netbox.core.StaticFilterModelView);Ext.ux.netbox.core.ElementaryFilterCfg=function(c,a,f){this.rowSize=a;var e=[["","<PRE> </PRE>"]];this.labelAlign=f.labelAlign;this.field=c;for(var h=0;h<c.getAvailableOperators().length;h++){e.push([c.getAvailableOperators()[h].getId(),c.getAvailableOperators()[h].getLabel()])}var d=new Ext.data.SimpleStore({fields:["operatorId","operatorLabel"],data:e});var g={store:d,mode:"local",valueField:"operatorId",displayField:"operatorLabel",editable:false,triggerAction:"all",lazyRender:true,fieldLabel:c.getLabel(),width:105,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.operatorLabel=="<PRE> </PRE>" ? values.operatorLabel : values.operatorLabel.escHtml()]}</div></tpl>'};if(Ext.isSafari){g.anchor="90%"}else{g.anchor="98%"}g.anchor+=" 100%";this.operatorCombo=new Ext.form.ComboBox(g);var b=Ext.apply({},f);b.layout="form";b.height=this.rowSize;b.labelWidth=1;b.labelPad=1;if(this.labelAlign!=="top"){b.hideLabels=true}this.editorComponent=new Ext.Panel(b)};Ext.ux.netbox.core.ElementaryFilterCfg.prototype={getOperatorCombo:function(){return(this.operatorCombo)},getEditorComponent:function(){return(this.editorComponent)},getField:function(){return(this.field)},setEditor:function(a){this.editor=a;if(Ext.isSafari){this.editor.field.anchor="90%"}else{this.editor.field.anchor="98%"}this.editor.field.labelSeparator="";if(this.labelAlign=="top"){if(Ext.isIE){this.editor.field.fieldLabel="<pre> </pre>"}else{this.editor.field.labelStyle="white-space: pre;";this.editor.field.fieldLabel=" "}}else{this.editor.field.fieldLabel=""}},getEditor:function(){return(this.editor)}};Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.FilterEditor=function(b,a){Ext.ux.netbox.FilterEditor.superclass.constructor.call(this,b,a)};Ext.extend(Ext.ux.netbox.FilterEditor,Ext.grid.GridEditor,{startEdit:function(b,c){if(this.editing){this.completeEdit()}this.boundEl=Ext.get(b);var a=c!==undefined?c:this.boundEl.dom.innerHTML;if(!this.rendered){this.render(this.parentEl||document.body)}if(this.fireEvent("beforestartedit",this,this.boundEl,a)===false){return}this.startValue=a;this.setValue(a);if(this.autoSize){var d=this.boundEl.getSize();switch(this.autoSize){case"width":this.setSize(d.width,"");break;case"height":this.setSize("",d.height);break;default:this.setSize(d.width,d.height)}}this.el.alignTo(this.boundEl,this.alignment);this.editing=true;this.show()},completeEdit:function(a){if(!this.editing){return}var b=this.getValue();if(this.revertInvalid!==false&&!this.field.isValid()){b=this.startValue;this.cancelEdit(true)}if(Ext.util.JSON.encode(b)===Ext.util.JSON.encode(this.startValue)&&this.ignoreNoChange){this.editing=false;this.hide();return}if(this.fireEvent("beforecomplete",this,b,this.startValue)!==false){this.editing=false;if(this.updateEl&&this.boundEl){this.boundEl.update(b)}if(a!==true){this.hide()}this.fireEvent("complete",this,b,this.startValue)}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.AvailableValuesEditor=function(c,a){if(a==undefined){a={}}var b="local";if(a.remote==true){b="remote"}if(a.multiSelect==undefined){a.multiSelect=false}this.fieldCombo=new Ext.ux.Andrie.Select({store:c,displayField:"label",valueField:"value",selectOnFocus:true,mode:b,triggerAction:"all",selectOnFocus:true,typeAhead:true,multiSelect:a.multiSelect,minChars:0});if(!a.multiSelect){this.fieldCombo.on("select",this.completeEditLater,this)}if(a.forceReload){this.fieldCombo.on("beforequery",function(d){d.combo.lastQuery=null})}if(a.caseSensitive){this.caseSensitive=true}else{this.caseSensitive=false}Ext.ux.netbox.core.AvailableValuesEditor.superclass.constructor.call(this,this.fieldCombo,a);this.store=c};Ext.extend(Ext.ux.netbox.core.AvailableValuesEditor,Ext.ux.netbox.FilterEditor,{setValue:function(d){var a=[];var e=[];var b="";if(d!=undefined&&d!=null&&Ext.type(d)=="array"){if(d.length>0){for(var c=0;c<d.length&&((this.fieldCombo.multiSelect)||c<1);c++){a.push(d[c].value);if(d[c].label!=undefined){e.push(d[c].label)}else{e.push(d[c].value)}}}}this.originalValue=d;Ext.ux.netbox.core.AvailableValuesEditor.superclass.setValue.call(this,a);Ext.form.ComboBox.superclass.setValue.call(this.fieldCombo,e.join(","));this.fieldCombo.value=a;this.fieldCombo.rawValueArray=e},completeEditLater:function(){var a=new Ext.util.DelayedTask(this.completeEdit,this);a.delay(0)},getValue:function(){var a=Ext.ux.netbox.core.AvailableValuesEditor.superclass.getValue.call(this);if(Ext.type(a)=="string"){a=a.split(",")}var e=[];for(var d=0;d<a.length;d++){var c=this.store.find("value",a[d],0,false,this.caseSensitive);if(c<0){continue}var b=this.store.getAt(c);e.push({label:b.get("label"),value:a[d]})}if((a.length>0&&a[0]!=="")&&e.length==0){return(this.originalValue)}else{return e}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.TextValuesEditor=function(b,a){if(b==undefined){b=new Ext.form.TextField()}Ext.ux.netbox.core.TextValuesEditor.superclass.constructor.call(this,b,a)};Ext.extend(Ext.ux.netbox.core.TextValuesEditor,Ext.ux.netbox.FilterEditor,{setValue:function(a){var b;if(a!==undefined&&a!==null&&Ext.type(a)==="array"){if(a.length==0){b=""}else{if(a[0].value!==undefined){b=a[0].value}else{b=a[0]}}}else{b=""}Ext.ux.netbox.FilterEditor.superclass.setValue.call(this,b)},getValue:function(){var a=Ext.ux.netbox.FilterEditor.superclass.getValue.call(this);if(a===""){return([])}else{a=[{label:a,value:a}]}return(a)}});Ext.namespace("Ext.ux.netbox.string");Ext.ux.netbox.string.TextFieldOperator=function(b,a){Ext.ux.netbox.string.TextFieldOperator.superclass.constructor.call(this,b,a);this.editor=null};Ext.extend(Ext.ux.netbox.string.TextFieldOperator,Ext.ux.netbox.core.Operator,{createEditor:function(a){var b=new Ext.ux.netbox.core.TextValuesEditor();return b}});Ext.namespace("Ext.ux.netbox.string");Ext.ux.netbox.string.StringListOperator=function(b,a){Ext.ux.netbox.string.StringListOperator.superclass.constructor.call(this,b,a);this.editor=null;valFn=function(c){return(this.getField().emptyNotAllowedFn(c))};this.addValidateFn(valFn)};Ext.extend(Ext.ux.netbox.string.StringListOperator,Ext.ux.netbox.core.Operator,{createEditor:function(a){var b=new Ext.ux.netbox.core.AvailableValuesEditor(this.getField().getAvailableValues(),{remote:this.isStoreRemote(),forceReload:this.isForceReload(),multiSelect:true,caseSensitive:this.isCaseSensitive()});return b},convertValue:function(c){var b=[];if(c!==null&&c!==undefined&&Ext.type(c)=="array"){for(var a=0;a<c.length;a++){if(c[a].value!==undefined&&c[a].label!==undefined){b.push(c[a])}}}return(b)}});Ext.namespace("Ext.ux.netbox.string");Ext.ux.netbox.string.StringField=function(d,a){Ext.ux.netbox.string.StringField.superclass.constructor.call(this,d,a);var b=new Ext.ux.netbox.core.Operator("STRING_EQUAL",this.stringEqualsLabel);this.addOperator(b);this.setDefaultOperator(b);this.addOperator(new Ext.ux.netbox.core.Operator("STRING_DIFFERENT",this.stringDifferentLabel));noEmptyAllowed=this.emptyNotAllowedFn.createDelegate(this);var c=new Ext.ux.netbox.string.TextFieldOperator("STRING_CONTAINS",this.containsText);c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.string.TextFieldOperator("STRING_DOESNT_CONTAIN",this.doesntContainsText);c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.string.TextFieldOperator("STRING_STARTS_WITH",this.startsWithText);c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.string.TextFieldOperator("STRING_ENDS_WITH",this.endsWithText);c.addValidateFn(noEmptyAllowed);this.addOperator(c)};Ext.extend(Ext.ux.netbox.string.StringField,Ext.ux.netbox.core.Field,{stringEqualsLabel:"=",stringDifferentLabel:"!=",containsText:"contains",doesntContainsText:"doesn't contain",startsWithText:"starts with",endsWithText:"ends with",stringListText:"in",stringNotListText:"not in"});Ext.namespace("Ext.ux.netbox.string");Ext.ux.netbox.string.EnumField=function(b,c){Ext.ux.netbox.string.EnumField.superclass.constructor.call(this,b,c);var a=new Ext.ux.netbox.core.Operator("STRING_EQUAL",this.stringEqualsLabel);this.addOperator(a);this.setDefaultOperator(a);this.addOperator(new Ext.ux.netbox.core.Operator("STRING_DIFFERENT",this.stringDifferentLabel))};Ext.extend(Ext.ux.netbox.string.EnumField,Ext.ux.netbox.core.Field,{stringEqualsLabel:"=",stringDifferentLabel:"!=",stringListText:"in",stringNotListText:"not in"});Ext.namespace("Ext.ux.netbox.number");Ext.ux.netbox.number.NumberRangeOperator=function(){Ext.ux.netbox.number.NumberRangeOperator.superclass.constructor.call(this,"NUMBER_RANGE",this.includeText);var a=function(d){var c=this.getField().emptyNotAllowedFn(d);if(c!==true){return(c)}if(d.length!=2){return(this.bothFromAndToNotEmpty)}var e=this.isNumeric(d[0].value);var b=this.isNumeric(d[1].value);if(!e&&!b){return(this.toAndFromNotANumber)}if(!e){return(this.fromNotANumber)}if(!b){return(this.toNotANumber)}if(parseFloat(d[0].value)>parseFloat(d[1].value)){return(this.fromBiggerThanTo)}return(true)};this.setValidateFn(a)};Ext.extend(Ext.ux.netbox.number.NumberRangeOperator,Ext.ux.netbox.core.Operator,{fromText:"from",toText:"to",includeText:"between",bothFromAndToNotEmpty:"Both 'from' and 'to' must have a value",fromBiggerThanTo:"From is bigger than to",fromNotANumber:"From is not a number",toNotANumber:"To is not a number",toAndFromNotANumber:"From and to are not numbers",isNumeric:function(b){if(Ext.type(b)==="number"){return(isFinite(b))}else{if(Ext.type(b)==="string"){if(b.lastIndexOf(".")===b.length){return("A number should not end with a .")}var a=/^(-)?(\d+)(\.?)(\d*)$/;return(b.match(a))}}return(false)},createEditor:function(c){var b=new Ext.ux.netbox.core.RangeField({textCls:Ext.form.NumberField,fromConfig:{},toConfig:{}});var a=new Ext.ux.netbox.FilterEditor(b);b.on("editingcompleted",a.completeEdit,a);return a},render:function(b){var a=b[0]==undefined?"":b[0].label;var c=b[1]==undefined?"":b[1].label;return(this.fromText+": "+a+", "+this.toText+": "+c)}});Ext.namespace("Ext.ux.netbox.number");Ext.ux.netbox.number.NumberField=function(d,a){Ext.ux.netbox.number.NumberField.superclass.constructor.call(this,d,a);var b=new Ext.ux.netbox.core.Operator("NUMBER_EQUAL","=");this.addOperator(b);this.setDefaultOperator(b);this.addOperator(new Ext.ux.netbox.core.Operator("NUMBER_NOT_EQUAL","!="));noEmptyAllowed=this.emptyNotAllowedFn.createDelegate(this);var c=new Ext.ux.netbox.core.Operator("NUMBER_GREATER",">");c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.core.Operator("NUMBER_GREATER_OR_EQUAL",">=");c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.core.Operator("NUMBER_LESS","<");c.addValidateFn(noEmptyAllowed);this.addOperator(c);c=new Ext.ux.netbox.core.Operator("NUMBER_LESS_OR_EQUAL","<=");c.addValidateFn(noEmptyAllowed);this.addOperator(c);this.addOperator(new Ext.ux.netbox.number.NumberRangeOperator())};Ext.extend(Ext.ux.netbox.number.NumberField,Ext.ux.netbox.core.Field,{createEditor:function(a){var b=new Ext.ux.netbox.core.TextValuesEditor(new Ext.form.NumberField({decimalPrecision:10}));return b}});Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.InputTextMask=function(b,e){if(e===undefined){this.clearWhenInvalid=true}else{this.clearWhenInvalid=e}this.rawMask=b;this.viewMask="";this.maskArray=[];var d=0;var a="";for(var c=0;c<b.length;c++){if(a){if(a=="X"){a=""}if(b.charAt(c)=="X"){this.maskArray[d]=a;d++;a=""}else{a+=b.charAt(c)}}else{if(b.charAt(c)=="X"){a+="X";this.viewMask+="_"}else{if(b.charAt(c)=="9"||b.charAt(c)=="L"||b.charAt(c)=="l"||b.charAt(c)=="A"){this.viewMask+="_";this.maskArray[d]=b.charAt(c);d++}else{this.viewMask+=b.charAt(c);this.maskArray[d]=RegExp.escape(b.charAt(c));d++}}}}this.specialChars=this.viewMask.replace(/(L|l|9|A|_|X)/g,"")};Ext.ux.netbox.InputTextMask.prototype={init:function(a){this.field=a;if(a.rendered){this.assignEl()}else{a.on("render",this.assignEl,this)}a.on("blur",this.removeValueWhenInvalid,this);a.on("focus",this.processMaskFocus,this)},assignEl:function(){this.inputTextElement=this.field.getEl().dom;this.field.getEl().on("keypress",this.processKeyPress,this);this.field.getEl().on("keydown",this.processKeyDown,this);if(Ext.isSafari||Ext.isIE){this.field.getEl().on("paste",this.startTask,this);this.field.getEl().on("cut",this.startTask,this)}if(Ext.isGecko||Ext.isOpera){this.field.getEl().on("mousedown",this.setPreviousValue,this)}if(Ext.isGecko){this.field.getEl().on("input",this.onInput,this)}if(Ext.isOpera){this.field.getEl().on("input",this.onInputOpera,this)}},onInput:function(){this.startTask(false)},onInputOpera:function(){if(!this.prevValueOpera){this.startTask(false)}else{this.manageBackspaceAndDeleteOpera()}},manageBackspaceAndDeleteOpera:function(){this.inputTextElement.value=this.prevValueOpera.cursorPos.previousValue;this.manageTheText(this.prevValueOpera.keycode,this.prevValueOpera.cursorPos);this.prevValueOpera=null},setPreviousValue:function(a){this.oldCursorPos=this.getCursorPosition()},getValidatedKey:function(a,c){var b=this.maskArray[c.start];if(b=="9"){return a.pressedKey.match(/[0-9]/)}else{if(b=="L"){return(a.pressedKey.match(/[A-Za-z]/))?a.pressedKey.toUpperCase():null}else{if(b=="l"){return(a.pressedKey.match(/[A-Za-z]/))?a.pressedKey.toLowerCase():null}else{if(b=="A"){return a.pressedKey.match(/[A-Za-z0-9]/)}else{if(b){return(a.pressedKey.match(new RegExp(b)))}}}}}return(null)},removeValueWhenInvalid:function(){if(this.clearWhenInvalid&&this.inputTextElement.value.indexOf("_")>-1){this.inputTextElement.value=""}},managePaste:function(){if(this.oldCursorPos===null){return}var b=this.inputTextElement.value.substring(this.oldCursorPos.start,this.inputTextElement.value.length-(this.oldCursorPos.previousValue.length-this.oldCursorPos.end));if(this.oldCursorPos.start<this.oldCursorPos.end){this.oldCursorPos.previousValue=this.oldCursorPos.previousValue.substring(0,this.oldCursorPos.start)+this.viewMask.substring(this.oldCursorPos.start,this.oldCursorPos.end)+this.oldCursorPos.previousValue.substring(this.oldCursorPos.end,this.oldCursorPos.previousValue.length);b=b.substr(0,this.oldCursorPos.end-this.oldCursorPos.start)}this.inputTextElement.value=this.oldCursorPos.previousValue;keycode={unicode:"",isShiftPressed:false,isTab:false,isBackspace:false,isLeftOrRightArrow:false,isDelete:false,pressedKey:""};var a=false;for(var c=0;c<b.length;c++){keycode.pressedKey=b.substr(c,1);keycode.unicode=b.charCodeAt(c);this.oldCursorPos=this.skipMaskCharacters(keycode,this.oldCursorPos);if(this.oldCursorPos===false){break}if(this.injectValue(keycode,this.oldCursorPos)){a=true;this.moveCursorToPosition(keycode,this.oldCursorPos);this.oldCursorPos.previousValue=this.inputTextElement.value;this.oldCursorPos.start=this.oldCursorPos.start+1}}if(!a&&this.oldCursorPos!==false){this.moveCursorToPosition(null,this.oldCursorPos)}this.oldCursorPos=null},processKeyDown:function(a){this.processMaskFormatting(a,"keydown")},processKeyPress:function(a){this.processMaskFormatting(a,"keypress")},startTask:function(a){if(this.task===undefined){this.task=new Ext.util.DelayedTask(this.managePaste,this)}if(a!==false){this.oldCursorPos=this.getCursorPosition()}this.task.delay(0)},skipMaskCharacters:function(a,b){if(b.start!=b.end&&(a.isDelete||a.isBackspace)){return(b)}while(this.specialChars.match(RegExp.escape(this.viewMask.charAt(((a.isBackspace)?b.start-1:b.start))))){if(a.isBackspace){b.dec()}else{b.inc()}if(b.start>=b.previousValue.length||b.start<0){return false}}return(b)},isManagedByKeyDown:function(a){if(a.isDelete||a.isBackspace){return(true)}return(false)},processMaskFormatting:function(c,b){this.oldCursorPos=null;var d=this.getCursorPosition();var a=this.getKeyCode(c,b);if(a.unicode===0){return}if((a.unicode==67||a.unicode==99)&&c.ctrlKey){return}if((a.unicode==88||a.unicode==120)&&c.ctrlKey){this.startTask();return}if((a.unicode==86||a.unicode==118)&&c.ctrlKey){this.startTask();return}if((a.isBackspace||a.isDelete)&&Ext.isOpera){this.prevValueOpera={cursorPos:d,keycode:a};return}if(b=="keydown"&&!this.isManagedByKeyDown(a)){return true}if(b=="keypress"&&this.isManagedByKeyDown(a)){return true}if(this.handleEventBubble(c,a,b)){return true}return(this.manageTheText(a,d))},manageTheText:function(a,b){if(this.inputTextElement.value.length===0){this.inputTextElement.value=this.viewMask}b=this.skipMaskCharacters(a,b);if(b===false){return false}if(this.injectValue(a,b)){this.moveCursorToPosition(a,b)}return(false)},processMaskFocus:function(){if(this.inputTextElement.value.length===0){var a=this.getCursorPosition();this.inputTextElement.value=this.viewMask;this.moveCursorToPosition(null,a)}},isManagedByBrowser:function(b,c,a){if(((a=="keypress"&&b.charCode===0)||a=="keydown")&&(c.unicode==Ext.EventObject.TAB||c.unicode==Ext.EventObject.RETURN||c.unicode==Ext.EventObject.ENTER||c.unicode==Ext.EventObject.SHIFT||c.unicode==Ext.EventObject.CONTROL||c.unicode==Ext.EventObject.ESC||c.unicode==Ext.EventObject.PAGEUP||c.unicode==Ext.EventObject.PAGEDOWN||c.unicode==Ext.EventObject.END||c.unicode==Ext.EventObject.HOME||c.unicode==Ext.EventObject.LEFT||c.unicode==Ext.EventObject.UP||c.unicode==Ext.EventObject.RIGHT||c.unicode==Ext.EventObject.DOWN)){return(true)}return(false)},handleEventBubble:function(c,a,b){try{if(a&&this.isManagedByBrowser(c,a,b)){return true}c.stopEvent();return false}catch(d){alert(d.message)}},getCursorPosition:function(){var c,b,a;if(this.inputTextElement.createTextRange){a=document.selection.createRange().duplicate();a.moveEnd("character",this.inputTextElement.value.length);if(a.text===""){c=this.inputTextElement.value.length}else{c=this.inputTextElement.value.lastIndexOf(a.text)}a=document.selection.createRange().duplicate();a.moveStart("character",-this.inputTextElement.value.length);b=a.text.length}else{c=this.inputTextElement.selectionStart;b=this.inputTextElement.selectionEnd}return this.CursorPosition(c,b,a,this.inputTextElement.value)},moveCursorToPosition:function(a,c){var b=(!a||(a&&a.isBackspace))?c.start:c.start+1;if(this.inputTextElement.createTextRange){c.range.move("character",b);c.range.select()}else{this.inputTextElement.selectionStart=b;this.inputTextElement.selectionEnd=b}},injectValue:function(a,c){if(!a.isDelete&&a.unicode==c.previousValue.charCodeAt(c.start)){return true}var b;if(!a.isDelete&&!a.isBackspace){b=this.getValidatedKey(a,c)}else{if(c.start==c.end){b="_";if(a.isBackspace){c.dec()}}else{b=this.viewMask.substring(c.start,c.end)}}if(b){this.inputTextElement.value=c.previousValue.substring(0,c.start);this.inputTextElement.value+=b+c.previousValue.substring(c.start+b.length,c.previousValue.length);return true}return false},getKeyCode:function(a,b){var c={};c.unicode=a.getKey();c.isShiftPressed=a.shiftKey;c.isDelete=((a.getKey()==Ext.EventObject.DELETE&&b=="keydown")||(b=="keypress"&&a.charCode===0&&a.keyCode==Ext.EventObject.DELETE))?true:false;c.isTab=(a.getKey()==Ext.EventObject.TAB)?true:false;c.isBackspace=(a.getKey()==Ext.EventObject.BACKSPACE)?true:false;c.isLeftOrRightArrow=(a.getKey()==Ext.EventObject.LEFT||a.getKey()==Ext.EventObject.RIGHT)?true:false;c.pressedKey=String.fromCharCode(c.unicode);return(c)},CursorPosition:function(a,d,e,c){var b={};b.start=isNaN(a)?0:a;b.end=isNaN(d)?0:d;b.range=e;b.previousValue=c;b.inc=function(){b.start++;b.end++};b.dec=function(){b.start--;b.end--};return(b)}};Ext.applyIf(RegExp,{escape:function(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}});Ext.ux.InputTextMask=Ext.ux.netbox.InputTextMask;Ext.namespace("Ext.ux.netbox.date");Ext.ux.netbox.date.DateTextEditor=function(b,a){Ext.ux.netbox.date.DateTextEditor.superclass.constructor.call(this,b,a);if(a.format==undefined){a.format="Y-m-d H:i:s"}this.format=a.format};Ext.extend(Ext.ux.netbox.date.DateTextEditor,Ext.ux.netbox.FilterEditor,{getValue:function(){var a=Ext.ux.netbox.date.DateTextEditor.superclass.getValue.call(this);if(a===""){return([])}else{return[{value:a.format("Y-m-d H:i:s"),label:a.format(this.format)}]}},setValue:function(b){var a;if(b.length==0){a=""}else{a=Date.parseDate(b[0].value,"Y-m-d H:i:s")}Ext.ux.netbox.date.DateTextEditor.superclass.setValue.call(this,a)}});Ext.namespace("Ext.ux.netbox.date");Ext.ux.netbox.date.DateOperator=function(b,c,a){Ext.ux.netbox.date.DateOperator.superclass.constructor.call(this,b,c,a);this.editor=null;this.format=a};Ext.extend(Ext.ux.netbox.date.DateOperator,Ext.ux.netbox.core.Operator,{createEditor:function(b){var d;var a=this.format.split(" ");if(a.length>1){var c=new Ext.ux.form.DateTime({dateFormat:a[0],dateConfig:{altFormats:"Y-m-d|Y-n-d"},otherToNow:false,timeFormat:a[1],timeConfig:{altFormats:"H:i:s"}});d=new Ext.ux.netbox.date.DateTextEditor(c,{format:this.format})}else{d=new Ext.ux.netbox.date.DateTextEditor(new Ext.form.DateField({format:a[0],allowBlank:false}),{format:this.format})}return d},convertValue:function(a){if(a!==null&&a!==undefined&&Ext.type(a)=="array"){if(a.length>0&&a[0].value!==undefined&&a[0].label!==undefined){if(this.getField().checkDate(a[0].label)&&this.getField().checkDate(a[0].value,"Y-m-d H:i:s")){if(a.length==1){return(a)}else{return([a[0]])}}}}return([])},getFormat:function(){return this.format}});Ext.ux.netbox.date.DateRangeEditor=function(b,a){Ext.ux.netbox.date.DateRangeEditor.superclass.constructor.call(this,b,a);this.format=a.format};Ext.extend(Ext.ux.netbox.date.DateRangeEditor,Ext.ux.netbox.FilterEditor,{getValue:function(){var d=Ext.ux.netbox.date.DateRangeEditor.superclass.getValue.call(this);var c=[];for(var b=0;d&&b<d.length;b++){var a=Date.parseDate(d[b].value,this.format);if(!a){c.push({label:"",value:""});continue}d[b].value=a.format("Y-m-d H:i:s");c.push(d[b])}return(c)}});Ext.ux.netbox.date.DateRangeOperator=function(b){Ext.ux.netbox.date.DateRangeOperator.superclass.constructor.call(this,"DATE_RANGE",this.includeText,b);this.mapping={d:"99",m:"99",Y:"9999",y:"99",H:"99",i:"99",s:"99"};var a=function(f){var d=this.getField().emptyNotAllowedFn(f);if(d!==true){return(d)}if(f.length!=2){return(this.bothFromAndToNotEmpty)}var c=this.getField().checkDate(f[0].value,"Y-m-d H:i:s");var e=this.getField().checkDate(f[1].value,"Y-m-d H:i:s");if(!c&&!e){return(this.toAndFromNotADate)}if(!c){return(this.fromNotADate)}if(!e){return(this.toNotADate)}if(Date.parseDate(f[0].value,"Y-m-d H:i:s")>Date.parseDate(f[1].value,"Y-m-d H:i:s")){return(this.fromBiggerThanTo)}return(true)};this.setValidateFn(a)};Ext.extend(Ext.ux.netbox.date.DateRangeOperator,Ext.ux.netbox.date.DateOperator,{fromText:"from",toText:"to",includeText:"between",bothFromAndToNotEmpty:"Both 'from' and 'to' must have a value",fromBiggerThanTo:"From is bigger than to",fromNotADate:"From is not a valid date",toNotADate:"To is not a valid date",toAndFromNotADate:"From and to are not valid dates",createEditor:function(c){var b=new Ext.ux.netbox.core.RangeField({textCls:Ext.form.TextField,fromConfig:this.getTextFieldConfig(),toConfig:this.getTextFieldConfig(),minListWidth:300,fieldSize:36});var a=new Ext.ux.netbox.date.DateRangeEditor(b,{format:this.format});b.on("editingcompleted",a.completeEdit,a);return a},render:function(b){var a=b[0]==undefined?"":b[0].label;var c=b[1]==undefined?"":b[1].label;return(this.fromText+": "+a+", "+this.toText+": "+c)},getTextFieldConfig:function(){return({plugins:[new Ext.ux.netbox.InputTextMask(this.calculateMask(),true)]})},calculateMask:function(){var b="";for(var a=0;a<this.format.length;a++){if(this.mapping[this.format.charAt(a)]){b+=this.mapping[this.format.charAt(a)]}else{b+=this.format.charAt(a)}}return(b)}});Ext.ux.netbox.date.DatePeriodOperator=function(){Ext.ux.netbox.date.DatePeriodOperator.superclass.constructor.call(this,"DATE_PERIOD",this.periodText);this.periodStore=new Ext.data.SimpleStore({fields:["value","label"],data:[["LAST_QUARTER",this.quarterText],["LAST_HOUR",this.hourText],["LAST_DAY",this.dayText],["LAST_WEEK",this.weekText],["LAST_MONTH",this.monthText],["LAST_YEAR",this.yearText]]});var a=function(b){if(this.getField().emptyNotAllowedFn(b)!==true){return(this.getField().emptyNotAllowedFn(b))}if(b[0].value!=="LAST_QUARTER"&&b[0].value!=="LAST_HOUR"&&b[0].value!=="LAST_DAY"&&b[0].value!=="LAST_WEEK"&&b[0].value!=="LAST_MONTH"&&b[0].value!=="LAST_YEAR"){return(this.valueNotExpected)}return(true)};this.setValidateFn(a)};Ext.extend(Ext.ux.netbox.date.DatePeriodOperator,Ext.ux.netbox.core.Operator,{periodText:"period",yearText:"last year",monthText:"last month",weekText:"last week",dayText:"last day",hourText:"last hour",quarterText:"last quarter",valueNotExpected:"Value not expected",getDefaultValues:function(){return([{value:"LAST_DAY",label:this.dayText}])},setPeriods:function(a){this.periodStore=a;this.editor=null},createEditor:function(a){var b=new Ext.ux.netbox.core.AvailableValuesEditor(this.periodStore);return b},convertValue:function(a){if(a!==null&&a!==undefined&&Ext.type(a)=="array"){if(a.length>0&&a[0].value!==undefined&&a[0].label!==undefined){if(this.periodStore.find("value",a[0].value)!="-1"){if(a.length==1){return(a)}else{return([a[0]])}}}}return([])}});Ext.namespace("Ext.ux.netbox.date");Ext.ux.netbox.date.DateField=function(a,b,c){Ext.ux.netbox.date.DateField.superclass.constructor.call(this,a,b);this.setValidateFn(this.validateDate);var d=new Ext.ux.netbox.date.DatePeriodOperator();this.addOperator(d);this.setDefaultOperator(d);this.addOperator(new Ext.ux.netbox.date.DateOperator("DATE_EQUAL","=",c));noEmptyAllowed=this.emptyNotAllowedFn.createDelegate(this);var e=new Ext.ux.netbox.date.DateOperator("DATE_GREATER",">",c);e.addValidateFn(noEmptyAllowed);this.addOperator(e);e=new Ext.ux.netbox.date.DateOperator("DATE_GREATER_OR_EQUAL",">=",c);e.addValidateFn(noEmptyAllowed);this.addOperator(e);e=new Ext.ux.netbox.date.DateOperator("DATE_LESS","<",c);e.addValidateFn(noEmptyAllowed);this.addOperator(e);e=new Ext.ux.netbox.date.DateOperator("DATE_LESS_OR_EQUAL","<=",c);e.addValidateFn(noEmptyAllowed);this.addOperator(e);this.addOperator(new Ext.ux.netbox.date.DateRangeOperator(c));this.format=c};Ext.extend(Ext.ux.netbox.date.DateField,Ext.ux.netbox.core.Field,{validateDate:function(a){for(var b=0;a&&b<a.length;b++){if(a[b].value!==""&&!this.checkDate(a[b].value,"Y-m-d H:i:s")){return(this.checkDate(a[b].value,"Y-m-d H:i:s"))}}return(true)},checkDate:function(c,d){if(d==undefined){d=this.format}var a=Date.parseDate(c,d);if(!a){return(false)}var b=a.format(d);if(c!=b){return(false)}return(true)}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.RangeField=function(a){this.textCls=a.textCls;this.fromConfig=a.fromConfig;this.toConfig=a.toConfig;if(a.minListWidth){this.minListWidth=a.minListWidth}else{this.minListWidth=100}if(a.fieldSize){this.defaultAutoCreate.size=a.fieldSize}else{this.defaultAutoCreate.size=20}Ext.ux.netbox.core.RangeField.superclass.constructor.call(this,a);this.addEvents("editingcompleted")};Ext.extend(Ext.ux.netbox.core.RangeField,Ext.form.TriggerField,{fromText:"from",toText:"to",defaultAutoCreate:{tag:"input",type:"text",size:"20",autocomplete:"off"},readOnly:true,rangeValue:null,onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.ux.netbox.core.RangeMenu(this.textCls,this.fromConfig,this.toConfig,this.validate.createDelegate(this));this.menu.on("hide",this.fireEditingCompleted,this)}this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));var b=this.menu.getEl();var a=Math.max(this.wrap.getWidth(),this.minListWidth);b.setWidth(a);this.menu.doLayout(a-b.getBorderWidth("lr")-b.getPadding("lr")-b.getMargins("lr"));this.menu.setValue(this.rangeValue);this.menu.show(this.el);this.validate()},validateBlur:function(a){return(this.menu&&!this.menu.getEl().contains(a.target))},getValue:function(){if(this.menu!==undefined){this.rangeValue=this.menu.getValue()}return(this.rangeValue)},setValue:function(a){valueFrom=a[0]!==undefined?a[0]:{value:"",label:""};valueTo=a[1]!==undefined?a[1]:{value:"",label:""};formattedValue=this.fromText+": "+valueFrom.label+", "+this.toText+": "+valueTo.label;Ext.ux.netbox.core.RangeField.superclass.setValue.call(this,formattedValue);this.rangeValue=a;if(this.menu!=null){this.menu.setValue(this.rangeValue)}},fireEditingCompleted:function(){this.fireEvent("editingcompleted")},markInvalid:function(a){Ext.ux.netbox.core.RangeField.superclass.markInvalid.call(this,a);if(this.menu){this.menu.markInvalid(a)}},clearInvalid:function(){Ext.ux.netbox.core.RangeField.superclass.clearInvalid.call(this);if(this.menu){this.menu.clearInvalidFields()}}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.RangeMenu=function(c,f,a,b){Ext.ux.netbox.core.RangeMenu.superclass.constructor.apply(this,arguments);if(c===undefined){c=Ext.form.TextField}var e=new c(f);var d=new c(a);e.validate=b;d.validate=b;this.fields=new Ext.ux.netbox.core.RangeItem({editorFrom:e,editorTo:d});this.add(this.fields);this.fields.on("keyup",this.onKeyUp,this);this.addEvents({update:true});this.on("show",this.disableKeyNav,this)};Ext.extend(Ext.ux.netbox.core.RangeMenu,Ext.menu.Menu,{disableKeyNav:function(){if(this.keyNav){this.keyNav.disable()}if(Ext.isGecko){var b=this.getEl();b.setStyle("overflow","auto");var a=b.select(".x-form-text");a.each(function(c){c.dom.select()})}},setValue:function(c){var b="";var a="";if(c.length==2){b=c[0].label;a=c[1].label}else{if(c.length==1){b=c[0].label}}this.fields.setValueTo(a);this.fields.setValueFrom(b);this.fireEvent("update",this)},onKeyUp:function(a){if(a.getKey()==a.ENTER&&this.isValid()){this.hide(true);return}},getValue:function(){var a=[{value:this.fields.getValueFrom(),label:this.fields.getValueFrom()},{value:this.fields.getValueTo(),label:this.fields.getValueTo()}];return a},isValid:function(){return(this.fields.isValidFrom()&&this.fields.isValidTo())},doLayout:function(b){var a=this.fields.getEl();this.fields.doLayout(b-a.getBorderWidth("lr")-a.getPadding("lr")-a.getMargins("lr"))},markInvalid:function(a){this.fields.markInvalid(a)},clearInvalidFields:function(){this.fields.clearInvalidFields()}});Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.RangeItem=function(a){this.editorFrom=a.editorFrom;this.editorTo=a.editorTo;this.editorFrom.fieldLabel=this.fromText;this.editorTo.fieldLabel=this.toText;this.panel=new Ext.Panel({layout:"column",bodyBorder:false,border:false,hideBorders:true,items:[{layout:"form",labelWidth:28,labelPad:2,items:[this.editorFrom],columnWidth:0.5},{layout:"form",labelWidth:28,labelPad:2,items:[this.editorTo],columnWidth:0.5}]});Ext.ux.netbox.core.RangeItem.superclass.constructor.apply(this,[this.panel,a])};Ext.extend(Ext.ux.netbox.core.RangeItem,Ext.menu.Adapter,{fromText:"from",toText:"to",itemCls:"x-menu-item",hideOnClick:false,initComponent:function(){this.addEvents({keyup:true})},doLayout:function(b){var a=(b/2)-32;this.editorTo.setWidth(a);this.editorFrom.setWidth(a);this.panel.setWidth(b);this.panel.doLayout()},onRender:function(a){if(this.editorFrom.getValue()==""){this.editorFrom.setValue("")}if(this.editorTo.getValue()==""){this.editorTo.setValue("")}Ext.ux.netbox.core.RangeItem.superclass.onRender.apply(this,arguments)},getValueFrom:function(){return this.editorFrom.getValue()},getValueTo:function(){return this.editorTo.getValue()},setValueFrom:function(a){if(a===""){this.editorFrom.setRawValue(a)}else{this.editorFrom.setValue(a)}},setValueTo:function(a){if(a===""){this.editorTo.setRawValue(a)}else{this.editorTo.setValue(a)}},isValidFrom:function(a){return this.editorFrom.isValid(a)},isValidTo:function(a){return this.editorTo.isValid(a)},markInvalid:function(a){this.editorFrom.markInvalid(a);this.editorTo.markInvalid(a)},clearInvalidFields:function(){this.editorFrom.clearInvalid();this.editorTo.clearInvalid()}});Ext.namespace("Ex.ux.netbox.core");Ext.ux.netbox.core.LocalStoreFilterResolver=function(b,a){this.mapping=null;if(a==undefined){this.mapping={NUMBER_EQUAL:{fn:this.filterNumberEqual,scope:this},NUMBER_NOT_EQUAL:{fn:this.filterNumberDifferent,scope:this},NUMBER_GREATER:{fn:this.filterNumberGreater,scope:this},NUMBER_GREATER_OR_EQUAL:{fn:this.filterNumberGreaterOrEqual,scope:this},NUMBER_LESS:{fn:this.filterNumberLess,scope:this},NUMBER_LESS_OR_EQUAL:{fn:this.filterNumberLessOrEqual,scope:this},NUMBER_RANGE:{fn:this.filterNumberRange,scope:this},STRING_EQUAL:{fn:this.filterStringEquals,scope:this},STRING_DIFFERENT:{fn:this.filterStringDifferent,scope:this},STRING_CONTAINS:{fn:this.filterStringContains,scope:this},STRING_DOESNT_CONTAIN:{fn:this.filterStringDoesntContains,scope:this},STRING_STARTS_WITH:{fn:this.filterStringStartsWith,scope:this},STRING_ENDS_WITH:{fn:this.filterStringEndsWith,scope:this},STRING_LIST:{fn:this.filterList,scope:this},STRING_NOT_IN_LIST:{fn:this.filterNotInList,scope:this},DATE_EQUAL:{fn:this.filterDateEqual,scope:this},DATE_GREATER:{fn:this.filterDateGreater,scope:this},DATE_GREATER_OR_EQUAL:{fn:this.filterDateGreaterOrEqual,scope:this},DATE_LESS:{fn:this.filterDateLess,scope:this},DATE_LESS_OR_EQUAL:{fn:this.filterDateLessOrEqual,scope:this},DATE_RANGE:{fn:this.filterDateRange,scope:this},DATE_PERIOD:{fn:this.filterDatePeriod,scope:this}}}this.filterModel=b};Ext.ux.netbox.core.LocalStoreFilterResolver.prototype={escapeRegExp:function(a){return a.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},calcolateValue:function(a){if(a.length==0){return("")}else{return(a[0].value)}},calcolateValueNumber:function(a){if(a.length==0){throw ("Not a number")}else{var b=parseFloat(a[0].value);if(isNaN(b)){throw ("Not a number")}return(b)}},calcolateValueDate:function(b){if(b.length==0){throw ("Not a date")}else{var a=Date.parseDate(b[0].value,"Y-m-d H:i:s");if(!a){throw ("Not a date")}return(a)}},filterStringEquals:function(c,b,a){return(c.get(a)===this.calcolateValue(b))},filterStringDifferent:function(c,b,a){return(!this.filterStringEquals(c,b,a))},filterList:function(a,d,c){for(var b=0;b<d.length;b++){if(this.filterStringEquals(a,[d[b]],c)){return(true)}}return(false)},filterNotInList:function(c,b,a){return(!this.filterList(c,b,a))},filterStringStartsWith:function(b,e,c){var a=this.escapeRegExp(this.calcolateValue(e));var d=new RegExp("^"+a,"");return(b.get(c).match(d)!==null)},filterStringEndsWith:function(b,e,c){var a=this.escapeRegExp(this.calcolateValue(e));var d=new RegExp(a+"$","");return(b.get(c).match(d)!==null)},filterStringContains:function(b,e,c){var a=this.escapeRegExp(this.calcolateValue(e));var d=new RegExp(".*"+a+".*","");return(b.get(c).match(d)!==null)},filterStringDoesntContains:function(c,b,a){return(!this.filterStringContains(c,b,a))},filterNumberEqual:function(b,d,c){var a;try{a=this.calcolateValueNumber(d)}catch(f){return(false)}return(b.get(c)===a)},filterNumberDifferent:function(c,b,a){return(!this.filterNumberEqual(c,b,a))},filterNumberGreater:function(b,d,c){var a;try{a=this.calcolateValueNumber(d)}catch(f){return(false)}return(b.get(c)>a)},filterNumberLessOrEqual:function(b,d,c){var a;try{a=this.calcolateValueNumber(d)}catch(f){return(false)}return(!this.filterNumberGreater(b,d,c))},filterNumberLess:function(b,d,c){var a;try{a=this.calcolateValueNumber(d)}catch(f){return(false)}return(b.get(c)<a)},filterNumberGreaterOrEqual:function(b,d,c){var a;try{a=this.calcolateValueNumber(d)}catch(f){return(false)}return(!this.filterNumberLess(b,d,c))},filterNumberRange:function(c,a,e){if(a.length!=2){return(false)}var b=this.filterNumberGreaterOrEqual(c,[a[0]],e);var d=this.filterNumberLessOrEqual(c,[a[1]],e);return(b&&d)},filterDateEqual:function(b,f,d){var c;try{c=this.calcolateValueDate(f)}catch(a){return(false)}return(b.get(d).getTime()==c.getTime())},filterDateGreater:function(b,f,d){var c;try{c=this.calcolateValueDate(f)}catch(a){return(false)}return(b.get(d).getTime()>c.getTime())},filterDateLessOrEqual:function(b,d,c){var a;try{a=this.calcolateValueDate(d)}catch(f){return(false)}return(!this.filterDateGreater(b,d,c))},filterDateLess:function(b,f,d){var c;try{c=this.calcolateValueDate(f)}catch(a){return(false)}return(b.get(d).getTime()<c.getTime())},filterDateGreaterOrEqual:function(b,f,d){var c;try{c=this.calcolateValueDate(f)}catch(a){return(false)}return(!this.filterDateLess(b,f,d))},filterDateRange:function(c,a,e){if(a.length!=2){return(false)}var b=this.filterDateGreaterOrEqual(c,[a[0]],e);var d=this.filterDateLessOrEqual(c,[a[1]],e);return(b&&d)},filterDatePeriod:function(d,b,a){if(b.length!=1){return(false)}var f=new Date();upperValue={label:f.format("Y-m-d H:i:s"),value:f.format("Y-m-d H:i:s")};var e;if(b[0].value==="LAST_YEAR"){e=f.add(Date.YEAR,-1)}else{if(b[0].value==="LAST_MONTH"){e=f.add(Date.MONTH,-1)}else{if(b[0].value==="LAST_WEEK"){e=f.add(Date.DAY,-7)}else{if(b[0].value==="LAST_DAY"){e=f.add(Date.DAY,-1)}else{if(b[0].value==="LAST_HOUR"){e=f.add(Date.HOUR,-1)}else{if(b[0].value==="LAST_QUARTER"){e=f.add(Date.MINUTE,-15)}else{return(false)}}}}}}var c={label:e.format("Y-m-d H:i:s"),value:e.format("Y-m-d H:i:s")};return(this.filterDateRange(d,[c,upperValue],a))},apply:function(a){a.filterBy(this.filter,this)},filter:function(c,b,a){if(a==undefined){a=this.filterModel.getFilterObj()}if(a==null){return(true)}if(a.operatorId!=undefined){var f=this.mapping[a.operatorId].fn;var e=this.mapping[a.operatorId].scope;if(e===undefined||e===null){e=window}toReturn=f.call(e,c,a.values,a.fieldId);return(toReturn)}else{var d=this.filter(c,b,a.left);if(d===true&&a.logicalOperator===Ext.ux.netbox.core.CompositeFilter.OR){return true}if(d===false&&a.logicalOperator===Ext.ux.netbox.core.CompositeFilter.AND){return(false)}d=this.filter(c,b,a.right);return(d)}}};Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.ContainerMenuItem=function(a){Ext.ux.netbox.ContainerMenuItem.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.netbox.ContainerMenuItem,Ext.menu.Item,{getSubMenu:function(){return this.menu},setSubMenu:function(a){this.menu=Ext.menu.MenuMgr.get(a);if(this.getEl()){this.getEl().addClass("x-menu-item-arrow")}},removeSubMenu:function(){this.menu=undefined;if(this.getEl()){this.getEl().removeClass("x-menu-item-arrow")}}});Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.ContextMenuManager=function(a){this.menu=a.menu};Ext.ux.netbox.ContextMenuManager.prototype={init:function(a){this.gridPanel=a;this.gridPanel.on("contextmenu",this.onContextmenu,this)},onCellcontextmenu:function(k,g,f,c,l){var n=false;if(!l){n=true;if(!(this.menu instanceof Ext.menu.Menu)){this.menu=new Ext.menu.Menu(this.menu)}l=this.menu}c.stopEvent();var b=false;for(var a=0;a<l.items.getCount();a++){var d=l.items.get(a);var j=d.initialConfig.scope?d.initialConfig.scope:window;var m;if(d.initialConfig.isToShow){m=d.initialConfig.isToShow.call(j,k,g,f,d);if(m&&d.menu){this.onCellcontextmenu(k,g,f,c,d.menu)}}else{if(!d.menu){m=(g>=0&&f>=0)}else{m=this.onCellcontextmenu(k,g,f,c,d.menu)}}if(m){d.setVisible(true);if(d.initialConfig.handler){var h=d.initialConfig.handler.createDelegate(j,[k,g,f,d],false);d.setHandler(h)}b=true}else{d.setVisible(false)}}if(b&&n){this.menu.showAt([c.getPageX(),c.getPageY()])}return b},onContextmenu:function(d){var c=d.getTarget();var a=this.gridPanel.getView().findHeaderIndex(c);if(a!==false){return}var f=-1;var b=-1;if(this.gridPanel.getView().findRowIndex(c)!==false){f=this.gridPanel.getView().findRowIndex(c)}if(this.gridPanel.getView().findCellIndex(c)!==false){b=this.gridPanel.getView().findCellIndex(c)}this.onCellcontextmenu(this.gridPanel,f,b,d)}};Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.QuickFilterModelView=function(a){this.addEvents({filterChanged:true});this.filterModel=a.filterModel;this.quickFilterItem=null;this.removeFilterItem=null;this.fieldsOptions=a.fieldsOptions;if(a.duplicatedElementaryFiltersAllowed===undefined){this.duplicatedElementaryFiltersAllowed=false}else{this.duplicatedElementaryFiltersAllowed=a.duplicatedElementaryFiltersAllowed}if(a.isStatic===undefined){this.isStatic=false}else{this.isStatic=a.isStatic}this.stringOperDefault=["STRING_EQUAL","STRING_DIFFERENT"];this.numberOperDefault=["NUMBER_EQUAL","NUMBER_NOT_EQUAL","NUMBER_GREATER","NUMBER_GREATER_OR_EQUAL","NUMBER_LESS","NUMBER_LESS_OR_EQUAL"];this.dateOperDefault=["DATE_EQUAL","DATE_GREATER","DATE_GREATER_OR_EQUAL","DATE_LESS","DATE_LESS_OR_EQUAL"]};Ext.extend(Ext.ux.netbox.core.QuickFilterModelView,Ext.util.Observable,{quickFilterText:"QuickFilter",removeText:"Remove filter",removeAllText:"Remove all",filterIsToShow:function(d,h,l){if(l==-1||this.getField(d,l)==null){return false}else{var e=[];var c=this.getField(d,l);var m;if(this.fieldsOptions){for(var o=0;o<this.fieldsOptions.length;o++){if(this.fieldsOptions[o].id===c.getId()&&this.fieldsOptions[o].operators){m=this.fieldsOptions[o].operators}}}if(!m){if(c instanceof Ext.ux.netbox.string.StringField||c instanceof Ext.ux.netbox.string.EnumField){m=this.stringOperDefault}else{if(c instanceof Ext.ux.netbox.number.NumberField){m=this.numberOperDefault}else{if(c instanceof Ext.ux.netbox.date.DateField){m=this.dateOperDefault}else{var p=c.getAvailableOperators();for(var o=0;o<p.length;o++){m.push(p[o].getId())}}}}}for(var o=0;o<m.length;o++){var b=true;var g=c.getAvailableOperatorById(m[o]);var k={text:Ext.util.Format.htmlEncode(g.getLabel()),handler:this.setFilter.createDelegate(this,[d,h,l,c.getId(),g.getId()],false)};var a=this.filterModel.getElementaryFiltersByFieldId(c.getId());var f=this.getValues(d,h,l,c.getId(),g.getId());for(var n=0;n<a.length;n++){if(a[n].getOperator().getId()===g.getId()&&Ext.util.JSON.encode(a[n].getValues())===Ext.util.JSON.encode(f)){b=false}}if(g.validate(f)!==true){b=false}if(b){e.push(k)}}if(e.length>0){this.quickFilterItem.setSubMenu(new Ext.menu.Menu({items:e}));return true}else{return false}}},getValues:function(e,h,k,a,c){var n=e.getStore().getAt(h);var j=n.get(e.getColumnModel().getDataIndex(k));var f;var m;if(this.fieldsOptions){for(var l=0;l<this.fieldsOptions.length;l++){if(this.fieldsOptions[l].id===a&&this.fieldsOptions[l].getterFn){f=this.fieldsOptions[l].getterFn;if(this.fieldsOptions[l].getterScope){m=this.fieldsOptions[l].getterScope}}}}if(!f){var d=this.getField(e,k);var g=d.getAvailableOperatorById(c);if(g instanceof Ext.ux.netbox.date.DateOperator&&j instanceof Date){f=this.getValuesDate}else{f=this.getValuesOther}}if(!m){m=this}var b=f.call(m,j,a,c,e,h,k);return b},getValuesOther:function(g,b,c,f,e,h){var j=f.getColumnModel().getRenderer(h);var a=f.getStore().getAt(e);var d=j(g,{},a,e,h,f.getStore());return([{label:d,value:g}])},getValuesDate:function(h,g,f,a,d,b){var c=this.filterModel.getFieldManager().getFieldById(g);var e=c.getAvailableOperatorById(f);return([{label:h.format(e.getFormat()),value:h.format("Y-m-d H:i:s")}])},setFilter:function(c,b,e,j,k){var a=this.getValues(c,b,e,j,k);var h={fieldId:j,operatorId:k,values:a};var g=true;if(!this.duplicatedElementaryFiltersAllowed){var d=this.filterModel.getElementaryFiltersByFieldId(j);for(var f=0;f<d.length;f++){if(d[f].getOperator().getId()===k&&Ext.util.JSON.encode(d[f].getValues())===Ext.util.JSON.encode(a)){g=false;break}}}if(this.isStatic){var d=this.filterModel.getElementaryFiltersByFieldId(j);for(var f=0;f<d.length;f++){this.filterModel.removeElementaryFilterById(d[f].getId())}}if(g){this.filterModel.addElementaryFilter(h);this.fireEvent("filterChanged")}},getFilterMenu:function(){if(this.quickFilterItem==null){this.quickFilterItem=new Ext.ux.netbox.ContainerMenuItem({text:this.quickFilterText,isToShow:this.filterIsToShow,scope:this})}return this.quickFilterItem},getRemoveFilterMenu:function(){if(this.removeFilterItem==null){this.removeFilterItem=new Ext.ux.netbox.ContainerMenuItem({text:this.removeText,isToShow:this.removeFilterIsToShow,scope:this})}return this.removeFilterItem},removeFilterIsToShow:function(c,b,g){var e=this.filterModel.getAllElementaryFilters();if(e.length>0){var d=[];for(var h=0;h<e.length;h++){var k=e[h].getField().getLabel()+" "+e[h].getOperator().getLabel()+" "+e[h].getOperator().render(e[h].getValues());var a="";if(e[h].isValid()!==true){a="x-icon-invalid"}var f={iconCls:a,text:k,handler:this.removeFilterById.createDelegate(this,[e[h].getId()],false),isToShow:function(){return(true)}};d.push(f)}var j={text:this.removeAllText,handler:this.removeAllFilters,scope:this,isToShow:function(){return(true)}};d.push(j);this.removeFilterItem.setSubMenu(new Ext.menu.Menu({items:d}));return true}else{return false}},removeAllFilters:function(){this.filterModel.setFilterObj(null);this.fireEvent("filterChanged")},removeFilterById:function(a){this.filterModel.removeElementaryFilterById(a);this.fireEvent("filterChanged")},getField:function(a,b){var c=a.getColumnModel().getDataIndex(b);var d=this.filterModel.getFieldManager().getFieldById(c);return d}});Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.PreferenceManager=function(a){Ext.ux.netbox.PreferenceManager.superclass.constructor.call(this,a);this.addEvents({preferenceSaved:true,preferenceDeleteFailed:true,applyDefaultPreferenceFailed:true,applyPreferenceFailed:true,preferenceSaveFailed:true,preferenceDeleted:true,loadPreferencesFailed:true});this.id=a.id;this.userName=a.userName;this.setFn=a.setFn;this.getFn=a.getFn;this.fnScope=a.fnScope;this.getAllPrefURL=a.getAllPrefURL;this.applyDefaultPrefURL=a.applyDefaultPrefURL;this.loadPrefURL=a.loadPrefURL;this.savePrefURL=a.savePrefURL;this.deletePrefURL=a.deletePrefURL};Ext.extend(Ext.ux.netbox.PreferenceManager,Ext.util.Observable,{getAllPreferences:function(){if(this.store===undefined){this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.getAllPrefURL}),baseParams:{id:this.id,userName:this.userName},reader:new Ext.data.JsonReader({root:"preferences",totalProperty:"totalCount",fields:["prefId","prefName","prefDesc",{name:"isDefault",type:"boolean"}]})});this.store.on("loadexception",this._loadExceptionCbk,this);this.store.setDefaultSort("prefName")}return this.store},_loadExceptionCbk:function(a,b,c){this.fireEvent("loadPreferencesFailed",c)},applyDefaultPreference:function(){Ext.Ajax.request({url:this.applyDefaultPrefURL,success:this.applyDefaultPreferenceCbk.createDelegate(this),failure:this.errorFunction.createDelegate(this),params:{id:this.id,userName:this.userName}})},applyPreference:function(b,a){if(a===undefined){Ext.Ajax.request({url:this.loadPrefURL,success:this.applyPreferenceCbk.createDelegate(this),failure:this.errorFunction.createDelegate(this),params:{id:this.id,userName:this.userName,prefId:b}})}else{this.setFn.call(this.fnScope,a)}},applyDefaultPreferenceCbk:function(a,b){if(a.responseText!=""){this.applyPreferenceCbk(a,b)}},applyPreferenceCbk:function(a,b){var c=Ext.util.JSON.decode(a.responseText);this.setFn.call(this.fnScope,c)},savePreference:function(f,a,e,d){var b=this.getFn.call(this.fnScope);var c=Ext.util.JSON.encode(b);var g={url:this.savePrefURL,params:{id:this.id,userName:this.userName,prefId:f,prefName:a,prefDesc:e,prefValue:c,isDefault:d},success:this._onSaveSuccessCbk.createDelegate(this),failure:this._onSaveFailureCbk.createDelegate(this)};Ext.Ajax.request(g)},_onSaveSuccessCbk:function(a,b){this.fireEvent("preferenceSaved",b.params.prefId,b.params.prefName)},_onSaveFailureCbk:function(a,b){this.fireEvent("preferenceSaveFailed",b.params.prefId,b.params.prefName,a)},deletePreferences:function(b){var a={url:this.deletePrefURL,params:{id:this.id,userName:this.userName,prefIdArray:b},success:this._onDeleteSuccessCbk.createDelegate(this),failure:this._onDeleteFailureCbk.createDelegate(this)};Ext.Ajax.request(a)},_onDeleteSuccessCbk:function(a,b){this.fireEvent("preferenceDeleted",b.params.prefIdArray)},_onDeleteFailureCbk:function(a,b){this.fireEvent("preferenceDeleteFailed",b.params.prefIdArray,a)},errorFunction:function(a,b){if(b.params.prefId===undefined){this.fireEvent("applyDefaultPreferenceFailed",a)}else{this.fireEvent("applyPreferenceFailed",b.params.prefId,a)}}});Ext.namespace("Ext.ux.netbox");Ext.ux.netbox.PreferenceManagerView=function(a){Ext.QuickTips.init();this.preferenceManager=a.preferenceManager;Ext.ux.netbox.PreferenceManagerView.superclass.constructor.call(this,a);this.preferenceManager.on("preferenceSaved",this.onPreferenceSaved,this);this.preferenceManager.on("preferenceDeleted",this.onPreferenceDeleted,this);this.preferenceManager.on("loadPreferencesFailed",this.resetMenu,this);if(a.defaultErrorHandling===undefined||a.defaultErrorHandling){new Ext.ux.netbox.DefaultPreferenceManagerErrorManager(this.preferenceManager)}this.on("show",this.loadRemotePref,this,{single:true})};Ext.extend(Ext.ux.netbox.PreferenceManagerView,Ext.menu.Menu,{addText:"Add preference",addTooltipText:"Save the actual configuration",manageText:"Manage preferences",manageTooltipText:"Manage the saved configurations",okText:"OK",cancelText:"Cancel",modifyText:"Modify preference",modifyBtnText:"Modify",deleteBtnText:"Delete",closeBtnText:"Close",nameText:"Name",descText:"Description",defaultText:"Default",loadingText:"Loading...",loadRemotePref:function(){if(this.prefStore===undefined){this.prefStore=this.preferenceManager.getAllPreferences();this.prefStore.on("load",this.loadRemotePrefAsync,this);this.prefStore.on("beforeload",this.beforeLoad,this);this.createStableItems()}this.prefStore.load()},createStableItems:function(){if(this.items.getCount()==0){this.add({text:this.addText,tooltip:this.addTooltipText,handler:this.addPreference,scope:this},{text:this.manageText,tooltip:this.manageTooltipText,handler:this.showManageDialog,scope:this},"-")}},beforeLoad:function(){this.resetMenu();this.getEl().mask(this.loadingText)},resetMenu:function(){if(this.getEl()){this.getEl().unmask()}for(var a=this.items.getCount()-1;a>=0;a--){if(this.items.get(a).removable===true){if(this.items.get(a).getEl()&&this.items.get(a).getEl().isMasked()){this.items.get(a).getEl().unmask()}this.remove(this.items.get(a))}}},loadRemotePrefAsync:function(){this.resetMenu();for(var a=0;a<this.prefStore.getTotalCount();a++){var b=this.prefStore.getAt(a);var c="";if(b.get("isDefault")==true){c="x-icon-checked"}this.add({id:b.get("prefId"),text:b.get("prefName"),tooltip:b.get("prefDesc"),iconCls:c,handler:this.applyPreference,scope:this,removable:true})}},addPreference:function(){this.showAddDialog("","","",false)},managePreference:function(){selModel=this.manageGridPanel.getSelectionModel();record=selModel.getSelected();if(record){this.showAddDialog(record.get("prefId"),record.get("prefName"),record.get("prefDesc"),record.get("isDefault"))}},deletePreferences:function(){selModel=this.manageGridPanel.getSelectionModel();records=selModel.getSelections();if(records.length>0){var b=[];for(var a=0;a<records.length;a++){b.push(records[a].get("prefId"))}this.preferenceManager.deletePreferences(b)}},showAddDialog:function(d,a,c,b){if(!this.addDialog){this.addDialog=new Ext.Window({width:400,height:160,minWidth:400,minHeight:160,closeAction:"hide",layout:"fit",plain:true,modal:true,shadow:true,items:this.addForm=new Ext.form.FormPanel({labelWidth:75,border:false,bodyStyle:"background-color:transparent;padding:10px; ",items:[{id:"prefId",xtype:"hidden",name:"prefId",value:d},{id:"prefName",xtype:"textfield",fieldLabel:this.nameText,name:"prefName",value:a,allowBlank:false,width:"96%"},{id:"prefDesc",xtype:"textfield",fieldLabel:this.descText,name:"prefDesc",value:c,width:"96%"},{id:"isDefault",xtype:"checkbox",fieldLabel:this.defaultText,name:"isDefault",checked:b}]}),buttons:[{text:this.okText,handler:this.savePreference,scope:this},{text:this.cancelText,handler:function(){this.addDialog.hide()},scope:this}]})}else{this.addForm.findById("prefId").setValue(d);this.addForm.findById("prefName").setValue(a);this.addForm.findById("prefDesc").setValue(c);this.addForm.findById("isDefault").setValue(b)}if(d!=""){this.addDialog.setTitle(this.modifyText)}else{this.addDialog.setTitle(this.addText)}this.addDialog.show()},showManageDialog:function(){if(!this.manageDialog){this.manageDialog=new Ext.Window({title:this.manageText,width:600,height:300,minWidth:500,minHeight:250,closeAction:"hide",layout:"fit",plain:true,modal:true,shadow:true,items:this.manageGridPanel=new Ext.grid.GridPanel({store:this.prefStore,border:false,enableColumnHide:false,columns:[{id:"prefId",hidden:true,dataIndex:"prefId"},{id:"prefName",header:this.nameText,sortable:true,dataIndex:"prefName",width:200},{id:"prefDesc",header:this.descText,sortable:true,dataIndex:"prefDesc",width:330},{id:"isDefault",header:this.defaultText,sortable:true,dataIndex:"isDefault",width:60,renderer:this.imageRenderer}],viewConfig:{forceFit:true},tbar:[{text:this.modifyBtnText,cls:"x-btn-text-icon",iconCls:"x-icon-modify",handler:this.managePreference,scope:this},"-",{text:this.deleteBtnText,cls:"x-btn-text-icon",iconCls:"x-icon-delete",handler:this.deletePreferences,scope:this},"-",{text:this.closeBtnText,cls:"x-btn-text-icon",iconCls:"x-icon-cancel",handler:function(){this.manageDialog.hide()},scope:this}]})})}this.manageDialog.show()},imageRenderer:function(a,f,c,b,e,d){if(a==true){return('<img class="x-menu-item-icon x-icon-checked" src="'+Ext.BLANK_IMAGE_URL+'"/>')}},applyPreference:function(b,a){this.preferenceManager.applyPreference(b.getId())},savePreference:function(){var d=this.addForm.findById("prefId");var a=this.addForm.findById("prefName");var c=this.addForm.findById("prefDesc");var b=this.addForm.findById("isDefault");if(a.isValid()){this.preferenceManager.savePreference(d.getValue(),a.getValue(),c.getValue(),b.getValue())}},onPreferenceSaved:function(a,b){this.prefStore.reload();this.addDialog.hide()},onPreferenceDeleted:function(a){this.prefStore.reload()}});Ext.menu.BaseItem.prototype.onRender=function(a){this.el=Ext.get(this.el);a.dom.appendChild(this.el.dom);if(this.tooltip){this.el.dom.qtip=this.tooltip}};Ext.ux.netbox.DefaultPreferenceManagerErrorManager=function(a){a.on("applyDefaultPreferenceFailed",this.manageApplyDefaultPreferenceFailed,this);a.on("applyPreferenceFailed",this.manageApplyPreferenceFailed,this);a.on("loadPreferencesFailed",this.manageLoadPreferencesFailed,this);a.on("preferenceDeleteFailed",this.manageDeletePreferencesFailed,this);a.on("preferenceSaveFailed",this.manageSavePreferenceFailed,this)};Ext.ux.netbox.DefaultPreferenceManagerErrorManager.prototype={failedToApplyDefaultPreferenceTitle:"Error applying default preference",failedToApplyPreferenceTitle:"Error applying preference",failedToSavePreferenceTitle:"Error saving preference",failedToDeletePreferenceTitle:"Error deleting preference(s)",failedToLoadPreferenceTitle:"Error loading preferences",manageApplyDefaultPreferenceFailed:function(a){this.manageError(this.failedToApplyDefaultPreferenceTitle,a.responseText)},manageApplyPreferenceFailed:function(b,a){this.manageError(this.failedToApplyPreferenceTitle,a.responseText)},manageSavePreferenceFailed:function(b,c,a){this.manageError(this.failedToSavePreferenceTitle,a.responseText)},manageDeletePreferencesFailed:function(a,b){this.manageError(this.failedToDeletePreferenceTitle,b.responseText)},manageLoadPreferencesFailed:function(a){this.manageError(this.failedToLoadPreferenceTitle,a.responseText)},manageError:function(b,a){Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,minWidth:200})}};Ext.namespace("Ext.ux.netbox.core");Ext.ux.netbox.core.FilterHeaderPlugin=function(a){this.filterModel=a};Ext.ux.netbox.core.FilterHeaderPlugin.prototype={filterCls:"ux-filtered-column",init:function(a){this.grid=a;a.on("render",this.onRender,this)},onRender:function(){this.grid.getView().on("refresh",this.onRefresh,this);this.updateColumnHeadings(this.grid.getView())},onRefresh:function(a){this.updateColumnHeadings(a)},updateColumnHeadings:function(d){if(!d||!d.mainHd){return}var b=d.mainHd.select("td").removeClass(this.filterCls);for(var f=0,c=d.cm.config.length;f<c;f++){var a=this.filterModel.getElementaryFiltersByFieldId(d.cm.config[f].dataIndex);for(var e=0;e<a.length;e++){if(a[e].isValid()===true){b.item(f).addClass(this.filterCls);break}}}}};if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}Ext.ns("Ext.ux.grid");Ext.ux.grid.RowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visiblity",widthIntercept:4,widthSlope:21,init:function(b){this.grid=b;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var a=b.getView();var c={scope:this};c[this.actionEvent]=this.onClick;b.afterRender=b.afterRender.createSequence(function(){a.mainBody.on(c)},this);if(!this.renderer){this.renderer=function(g,e,j,h,f,d){e.css+=(e.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(g,e,j,h,f,d))}.createDelegate(this)}if(a.groupTextTpl&&this.groupActions){a.interceptMouse=a.interceptMouse.createInterceptor(function(d){if(d.getTarget(".ux-grow-action-item")){return false}});a.groupTextTpl='<div class="ux-grow-action-text">'+a.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(a,c,d,b,f,e){return d.data||{}},processActions:function(d,c){var a=[];Ext.each(d,function(f,g){if(f.iconCls&&"function"===typeof(f.callback||f.cb)){this.callbacks=this.callbacks||{};this.callbacks[f.iconCls]=f.callback||f.cb}var e={cls:f.iconIndex?"{"+f.iconIndex+"}":(f.iconCls?f.iconCls:""),qtip:f.qtipIndex?"{"+f.qtipIndex+"}":(f.tooltip||f.qtip?f.tooltip||f.qtip:""),text:f.textIndex?"{"+f.textIndex+"}":(f.text?f.text:""),hide:f.hideIndex?'<tpl if="'+f.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(f.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:f.align||"right",style:f.style?f.style:""};a.push(e)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},onClick:function(b,c){var d=this.grid.getView();var m=false;var j=b.getTarget(".x-grid3-row");var k=d.findCellIndex(c.parentNode.parentNode);var h=b.getTarget(".ux-row-action-item");if(h){m=h.className.replace(/ux-row-action-item /,"");if(m){m=m.replace(/ ux-row-action-text/,"");m=m.trim()}}if(false!==j&&false!==k&&false!==m){var a=this.grid.store.getAt(j.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[m]){this.callbacks[m](this.grid,a,m,j.rowIndex,k)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,a,m,j.rowIndex,k)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,a,m,j.rowIndex,k)}}}h=b.getTarget(".ux-grow-action-item");if(h){var f=d.findGroup(c);var n=f?f.id.replace(/ext-gen[0-9]+-gp-/,""):null;var l;if(n){var g=new RegExp(RegExp.escape(n));l=this.grid.store.queryBy(function(e){return e._groupId.match(g)});l=l?l.items:[]}m=h.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[m]){this.callbacks[m](this.grid,l,m,n)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,l,m,n)){return false}this.fireEvent("groupaction",this.grid,l,m,n)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);if(!Ext.isArray){Ext.isArray=function(a){return a&&typeof a.pop==="function"}}Ext.ux.IconMenu=function(a){Ext.apply(this,a);Ext.ux.IconMenu.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.IconMenu,Ext.util.Observable,{closeText:"Close",createDefault:true,dblClickClose:true,defaultItems:["restore","minimize","maximize","separator","close"],maximizeText:"Maximize",minimizeText:"Minimize",restoreText:"Restore",style:"width:16px;height:16px;left:0;top:4px;position:absolute;cursor:pointer",closeHandler:function(){if(this.panel.closable){var a=this.panel.closeAction;if("hide"!==a){this.onDestroy()}this.panel[a]()}},getItemByCmd:function(b){if(!this.menu||!b){return null}var a=this.menu.items.find(function(c){return b===c.cmd});return a},hideMenu:function(){if(this.menu){this.menu.hide()}},init:function(c){this.panel=c;this.iconCls=this.iconCls||c.iconCls;c.on({scope:this,render:this.onRender,hide:this.hideMenu,destroy:this.onDestroy});var d,b,e;var a="im-"+c.id;if(this.createDefault&&Ext.isArray(this.defaultItems)&&this.defaultItems.length){if(this.menu){this.menu.add("-")}else{this.menu=new Ext.menu.Menu({id:a})}for(d=0;d<this.defaultItems.length;d++){this.addItem(this.defaultItems[d])}}if(Ext.isArray(this.customItems)){if(!this.menu){this.menu=new Ext.menu.Menu({id:a})}for(d=0;d<this.customItems.length;d++){this.addItem(this.customItems[d])}}if(this.menu){this.menu.id=this.menu.id||a;this.menu=Ext.menu.MenuMgr.get(this.menu);this.menu.on("show",this.onMenuShow,this);this.menu.on("hide",this.onMenuHide,this);this.menu.parentPanel=this.panel}},addItem:function(b){if("separator"===b||"-"===b){this.menu.add("-");return}var a;if("string"===typeof b){a={text:this[b+"Text"],cmd:b,iconCls:"x-im-icon x-tool x-tool-"+b,scope:this,handler:this[b+"Handler"]}}else{a=b}this.menu.add(a)},maximizeHandler:function(){this.hideMenu();if(this.panel.maximizable){this.panel.maximize()}},minimizeHandler:function(){this.hideMenu();if(this.panel.minimizable){this.panel.minimize()}},onDestroy:function(){if(this.menu){var a=this.menu.getEl();if(a.shadow&&a.shadow.el){a.shadow.el.remove()}this.menu.destroy();a.remove();this.menu=null}},onMenuHide:function(a){this.ignoreNextClick=this.restoreClick.defer(350,this)},onMenuShow:function(a){this.ignoreNextClick=0},onRender:function(){var b=this.panel.header;if(!b){return}Ext.util.CSS.createStyleSheet(".x-im-icon{float:none!important;margin-left:0!important}");b.addClass("x-panel-icon");b.applyStyles({position:"relative"});this.icon=b.insertFirst({tag:"div",id:Ext.id(),style:this.style,cls:this.iconCls,qtip:this.qtip||this.tooltip||""},"first");var c=b.down("img");if(c){this.icon.alignTo(c,"tl-tl");c.removeClass(this.panel.iconCls||this.iconCls);c.set({src:Ext.BLANK_IMAGE_URL})}this.icon.on({scope:this,dblclick:function(){if(this.dblClickClose){this.closeHandler()}},click:{scope:this,delay:200,fn:function(e,d){if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){this.showMenu()}}}});this.panel.setIconClass=this.setIconClass.createDelegate(this);Ext.util.CSS.getRule(".x-panel-tl .x-panel-icon, .x-window-tl .x-panel-icon",true);if(Ext.isIE){Ext.util.CSS.updateRule(".x-panel-tl .x-panel-icon","padding","");Ext.util.CSS.updateRule(".x-panel-tl .x-panel-icon","padding","5px 0 4px 0");Ext.util.CSS.updateRule(".x-window-tl .x-panel-icon","padding","");Ext.util.CSS.updateRule(".x-window-tl .x-panel-icon","padding","5px 0 4px 0")}else{Ext.util.CSS.updateRule(".x-panel-tl .x-panel-icon, .x-window-tl .x-panel-icon","padding","");Ext.util.CSS.updateRule(".x-panel-tl .x-panel-icon, .x-window-tl .x-panel-icon","padding","5px 0 4px 0")}var a=this.icon.getWidth()+4+"px !important";Ext.util.CSS.createStyleSheet(".x-im-header{padding-left:"+a+";}");b.addClass("x-im-header")},restoreClick:function(){this.ignoreNextClick=0},restoreHandler:function(){this.hideMenu();this.panel.restore()},setIconClass:function(a){this.icon.replaceClass(this.iconCls,a)},showMenu:function(){var a;if(this.menu){try{a=this.getItemByCmd("close");if(a){a.setDisabled(!this.panel.closable)}a=this.getItemByCmd("maximize");if(a){a.setDisabled(!this.panel.maximizable||this.panel.maximized)}a=this.getItemByCmd("minimize");if(a){a.setDisabled(!this.panel.minimizable||this.panel.minimized)}a=this.getItemByCmd("restore");if(a){a.setDisabled(!(this.panel.minimized||this.panel.maximized))}this.menu.show(this.icon,"tl-bl?")}catch(b){}}}});Ext.reg("iconmenu",Ext.ux.IconMenu);Ext.ns("Ext.ux.grid");Ext.ux.grid.RecordForm=function(a){Ext.apply(this,a);Ext.ux.grid.RecordForm.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RecordForm,Ext.util.Observable,{autoHide:true,cancelIconCls:"icon-cancel",cancelText:"Cancel",columnCount:1,defaultFormConfig:{border:false,frame:true,autoHeight:true,labelWidth:100},defaultWindowConfig:{border:false,width:480,autoHeight:true,layout:"fit",closeAction:"hide",modal:true,plugins:[new Ext.ux.IconMenu({defaultItems:[]})]},dirtyRowCls:"ux-grid3-dirty-row",focusDefer:200,mapping:{auto:"textfield","boolean":"checkbox",date:"datefield","float":"numberfield","int":"numberfield",string:"textfield"},newRowCls:"ux-grid3-new-row",okIconCls:"icon-ok",okText:"OK",showButtons:true,init:function(a){a.afterRender=a.afterRender.createSequence(function(){if("function"===typeof a.view.getRowClass){a.view.getRowClass=a.view.getRowClass.createSequence(this.getRowClass,this)}else{a.view.getRowClass=this.getRowClass.createDelegate(this)}if(this.autoShow){this.show({data:{}})}},this);this.grid=a;a.reconfigure=a.reconfigure.createSequence(this.reconfigure,this);this.reconfigure()},afterUpdateRecord:Ext.emptyFn,createFormConfig:function(){if(this.form){return}var d=this.grid.getColumnModel();var c=this.grid.store.recordType.prototype.fields;var e=this.grid.store;this.form=Ext.apply({xtype:"form",items:[{layout:"column",anchor:"100%",border:false,monitorValid:true,autoHeight:true,defaults:{columnWidth:1/this.columnCount,autoHeight:true,border:false,layout:"form",hideLabel:true},items:(function(){var f=[];for(var g=0;g<this.columnCount;g++){f.push({defaults:{anchor:"-25"},items:[]})}return f}).createDelegate(this)()}],buttons:(function(){if(this.showButtons){return[{text:this.okText,iconCls:this.okIconCls,scope:this,handler:this.onOK,formBind:true},{text:this.cancelText,iconCls:this.cancelIconCls,scope:this,handler:this.onCancel}]}else{return[]}}).createDelegate(this)(),keys:[{key:[10,13],scope:this,stopEvent:true,fn:this.onOK}]},this.formConfig,this.defaultFormConfig);var a=0;var b=1;c.each(function(g,f){if(this.ignoreFields&&this.ignoreFields[g.name]){return}var j=this.findConfig(d,g.name);var h={};if(j&&j.editor&&j.editor.field){Ext.apply(h,{xtype:j.editor.field.getXType(),fieldLabel:j.header},j.editor.field.initialConfig)}else{Ext.apply(h,{fieldLabel:(j&&j.header?j.header:g.name),xtype:this.mapping[g.type]||"textfield"});if("date"===g.type&&g.dateFormat){h.format=g.dateFormat}}if(this.readonlyFields&&true===this.readonlyFields[g.name]){h.readOnly=true}if(this.disabledFields&&true===this.disabledFields[g.name]){h.disabled=true}h.name=g.name;h.tabIndex=b++;if("datefield"===h.xtype||"timefield"===h.xtype||"datetime"===h.xtype){h.anchor=""}if("textarea"===h.xtype){h.grow=false;h.autoHeight=true}this.form.items[0].items[a++].items.push(h);a=a===this.columnCount?0:a},this)},findConfig:function(c,b){var a=null;Ext.each(c.config,function(e,d){if(a){return}if(b===e.dataIndex){a=e}});return a},getRowClass:function(a){if(a.get("newRecord")){return this.newRowCls}if(a.dirty){return this.dirtyRowCls}return""},onDestroy:function(){if(this.window){this.window.destroy();this.window=null;this.form=null}else{if(this.form){if("function"===typeof this.form.destroy){this.form.destroy()}this.form=null}}},onOK:function(){this.updateRecord();if(this.autoHide){this.window.hide(null)}},onCancel:function(){if(this.record.get("newRecord")&&!this.record.dirty){this.record.store.remove(this.record)}if(this.autoHide){this.window.hide(null)}},reconfigure:function(){this.onDestroy();this.createFormConfig()},getPanel:function(){if(this.window){return this.window}if(this.formCt){var c=Ext.getCmp(this.formCt);if(c){c.add(this.form);c.doLayout()}else{c=Ext.fly(this.formCt);if(c){c=new Ext.Panel({renderTo:c,items:this.form})}}}else{var a=Ext.apply({},this.defaultWindowConfig);a=Ext.apply(a,this.windowConfig);Ext.applyIf(a,{title:this.title||this.grid.title,iconCls:this.iconCls||this.grid.iconCls,items:this.form,listeners:{show:{scope:this,delay:this.focusDefer,fn:function(){this.form.startMonitoring();var d=this.form.getForm();d.items.itemAt(0).focus();d.isValid()}},hide:{scope:this,fn:function(){this.form.stopMonitoring()}}}});var b=new Ext.Window(a);this.form=b.items.itemAt(0);return b}c.on({show:{scope:this,delay:this.focusDefer,fn:function(){this.form.startMonitoring();var d=this.form.getForm();d.items.itemAt(0).focus();d.isValid()}},hide:{scope:this,fn:function(){this.form.stopMonitoring()}}});this.form=c.items.itemAt(0);return c},show:function(a,b){if(!this.window){this.window=this.getPanel()}this.window.show(b);var c=this.form.getForm();c.loadRecord(a);this.record=a},updateRecord:function(){this.form.getForm().items.each(function(b,a){this.record.set(b.name,b.getValue())},this);this.afterUpdateRecord(this.record)}});Ext.reg("gridrecordform",Ext.ux.grid.RecordForm);Ext.namespace("Ext.ux");if(!Ext.ux.Utility){Ext.ux.Utility={isNullOrUndefined:function(a){return(typeof a=="undefined"||a==null||(typeof a=="string"&&a=="undefined"))},isFunction:function(a){return typeof a=="function"}}}Ext.ux.FieldReadOnlyPlugin=function(){this.init=function(a){a.setReadOnly=function(c){if(a.readOnly){return}a._readOnly=c;if(a.rendered){if(Ext.ux.Utility.isNullOrUndefined(a.editable)||a.editable===true){var b=a.getEl();b.dom.setAttribute("readOnly",c);b.dom.readOnly=c}}else{a.readOnly=c}};if(Ext.ux.Utility.isFunction(a.expand)){a.expand=a.expand.createInterceptor(function(){return !a._readOnly})}if(Ext.ux.Utility.isFunction(a.onTriggerClick)){a.onTriggerClick=a.onTriggerClick.createInterceptor(function(){return !a._readOnly})}if(Ext.ux.Utility.isFunction(a.onClick)){a.onClick=a.onClick.createInterceptor(function(){if(a._readOnly){this.el.dom.checked=a.checked}return !a._readOnly})}if(Ext.ux.Utility.isFunction(a.setValue)&&a instanceof Ext.form.Checkbox){a.setValue=a.setValue.createInterceptor(function(){return !a._readOnly})}}};Ext.ux.CenterWindowPlugin=function(){this.init=function(a){Ext.EventManager.onWindowResize(function(){a.center()})}};Ext.ux.ThemeCombo=Ext.extend(Ext.form.ComboBox,{themeBlueText:"Ext Blue Theme",themeGrayText:"Gray Theme",themeDarkGrayText:"Dark Gray Theme",themeSlateText:"Slate Theme",themeVistaText:"Vista Theme",selectThemeText:"Select Theme",lazyRender:true,lazyInit:true,cssPath:"./css/",initComponent:function(){Ext.apply(this,{store:new Ext.data.SimpleStore({fields:["themeFile","themeName"],data:[["xtheme-default.css",this.themeBlueText],["xtheme-gray.css",this.themeGrayText],["xtheme-darkgray.css",this.themeDarkGrayText],["xtheme-slate.css",this.themeSlateText],["xtheme-vista.css",this.themeVistaText]]}),valueField:"themeFile",displayField:"themeName",triggerAction:"all",width:195,mode:"local",forceSelection:true,editable:false,fieldLabel:this.selectThemeText});Ext.ux.ThemeCombo.superclass.initComponent.apply(this,arguments)},onSelect:function(){Ext.ux.ThemeCombo.superclass.onSelect.apply(this,arguments);var a=this.getValue();Ext.util.CSS.swapStyleSheet("theme",this.cssPath+a);if(Ext.state.Manager.getProvider()){Ext.state.Manager.set("theme",a)}}});Ext.reg("themecombo",Ext.ux.ThemeCombo);Ext.ux.ThemeCycleButton=Ext.extend(Ext.CycleButton,{cssItems:[{file:"xtheme-default.css",text:"Ext Blue&nbsp;"},{file:"xtheme-gray.css",text:"Gray&nbsp;"},{file:"xtheme-darkgray.css",text:"Dark Gray&nbsp;"},{file:"xtheme-slate.css",text:"Slate&nbsp;"},{file:"xtheme-vista.css",text:"Vista&nbsp;"}],themeVar:"style",cssPath:"./css/",initComponent:function(){Ext.apply(this,{showText:true,width:115,prependText:"Theme:&nbsp;",items:this.cssItems});if(Ext.state.Manager){var b=Ext.state.Manager.get(this.themeVar);if(b){for(var a=0;a<this.items.length;a++){if(this.items[a].file==b){this.items[a].checked=true;this.changeHandler.defer(100,this,[this,this.items[a]]);break}}}else{this.items[0].checked=true}}Ext.ux.ThemeCycleButton.superclass.initComponent.apply(this,arguments)},changeHandler:function(b,a){if(Ext.state.Manager.getProvider()){Ext.state.Manager.set(this.themeVar,a.file)}Ext.util.CSS.swapStyleSheet(this.themeVar,this.cssPath+a.file)}});Ext.reg("themecyclebutton",Ext.ux.ThemeCycleButton);Ext.namespace("ux");ux.TabPanel=Ext.extend(Ext.TabPanel,{enableTabScroll:false,afterRender:function(){ux.TabPanel.superclass.afterRender.call(this);var e=this[this.stripTarget].dom;var u='<td style="height:27px;width:100%;border-right:0px;"><div id="td_tabs" style="margin:0px;height:27px;"></div></td>';var f=this.initialConfig.toolbars;var k,j;for(var l=0,c=f.length;l<c;l++){if(f[l].align.toLowerCase()=="left"){k=f[l]}else{j=f[l]}}var a=(k)?k.id:"leftTbar";var b=(j)?j.id:"rightTbar";var d="border-top:1px solid #8DB2E3;margin:0px;";var q='<td><div id="'+a+'" class="x-tab-toolbar-wrap" style="border-left:1px solid #8DB2E3;'+d+'"></div></td>';var m='<td><div id="'+b+'" class="x-tab-toolbar-wrap" style="border-right:1px solid #8DB2E3;'+d+'"></div></td>';var t='<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr>';var h="</tr></table>";var s=t+(k?q:"")+u+(j?m:"")+h;var o=e.parentNode;o.removeChild(this[this.stripTarget].dom);Ext.DomHelper.insertFirst(o,s);var u=Ext.get("td_tabs");u.dom.appendChild(e);if(k){var g=new Ext.Panel({renderTo:a,border:false,width:k.width,tbar:k.tbar,height:0});if(Ext.isIE){var n=g.bwrap;n.dom.removeChild(n.dom.lastChild)}}if(j){var g=new Ext.Panel({renderTo:b,border:false,width:j.width-1,tbar:j.tbar,height:0});if(Ext.isIE){var n=g.bwrap;n.dom.removeChild(n.dom.lastChild)}}this.fixTabStripWidth()},initEvents:function(){ux.TabPanel.superclass.initEvents.call(this);this.on("afterlayout",this.fixTabStripWidth,this)},fixTabStripWidth:function(){var a=this.getScrollArea();this.strip.setWidth(a);this[this.stripTarget].setWidth(a);if(this[this.stripTarget].first){this[this.stripTarget].first().setWidth(a)}},getScrollArea:function(){var a=0;if(this.initialConfig.toolbars){for(var b=0;b<this.initialConfig.toolbars.length;b++){a+=this.initialConfig.toolbars[b].width}}a=this.el.dom.clientWidth-a-1;return a}});Ext.reg("uxTabPanel",ux.TabPanel);Ext.ns("Ext.ux.grid");Ext.ux.grid.AutoSizeColumns=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.grid.AutoSizeColumns,Object,{cellPadding:8,init:function(a){a.getView().onHeaderClick=this.onHeaderClick;a.on("headerdblclick",function(f,n,l){var j=f.getView().getHeaderCell(n);if(j.style.cursor!="col-resize"){return}var c=Ext.lib.Dom.getXY(j);if(l.getXY()[0]-c[0]<=5){n--;j=f.getView().getHeaderCell(n)}if(f.getColumnModel().isFixed(n)||f.getColumnModel().isHidden(n)){return}var g=j.firstChild;g.style.width="0px";var m=g.scrollWidth;g.style.width="auto";for(var d=0,k=f.getStore().getCount();d<k;d++){var b=f.getView().getCell(d,n).firstChild;b.style.width="0px";m=Math.max(m,b.scrollWidth);b.style.width="auto"}m+=this.cellPadding;f.getColumnModel().setColumnWidth(n,m)},this)},onHeaderClick:function(b,c){if(this.headersDisabled||!this.cm.isSortable(c)){return}var a=this.getHeaderCell(c);if(a.style.cursor=="col-resize"){return}b.stopEditing(true);b.store.sort(this.cm.getDataIndex(c))}});Ext.ux.PanelBlind=Ext.extend(Ext.Panel,{constructor:function(a){a=Ext.apply({autoHeight:true,layout:"fit",floating:true,cls:"x-blind",buttonAlign:"center",buttons:[{text:"OK and Close",handler:this.dismiss,scope:this}]},a);Ext.ux.PanelBlind.superclass.constructor.call(this,a)},init:function(a){this.client=a;if(!this.client.blinds){this.client.blinds=new Ext.util.MixedCollection()}a.blinds.add(this);this.client.constructor.prototype.showBlind=this.clientShowBlind;this.client.constructor.prototype.dismissBlind=this.clientDismissBlind;this.client.on({destroy:this.destroy,resize:this.syncSizeWithClient,scope:this})},syncSizeWithClient:function(){this.setWidth(this.client.body.getSize(true).width)},clientShowBlind:function(c){var a=this.blinds.get(c);if(a){a.show()}},clientDismissBlind:function(c){var a=this.blinds.get(c);if(a){a.dismiss()}},show:function(){var a=this.client.getEl().mask();if(!this.rendered){this.render(this.client.getEl())}this.el.setZIndex(Number(a.getStyle("z-index"))+1);this.el.disableShadow();this.syncSizeWithClient();this.el.alignTo(this.client.body,"tl-tl");this.el.slideIn("t",{callback:function(){this.el.visible=true;this.el.enableShadow(true)},scope:this})},dismiss:function(){if(this.destroyOnDismiss){this.destroy();delete this.client.blinds[this.id]}else{this.el.disableShadow();this.el.slideOut("t");this.client.getEl().unmask()}}});var Base64=(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function b(d){d=d.replace(/\r\n/g,"\n");var c="";for(var f=0;f<d.length;f++){var e=d.charCodeAt(f);if(e<128){c+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){c+=String.fromCharCode((e>>6)|192);c+=String.fromCharCode((e&63)|128)}else{c+=String.fromCharCode((e>>12)|224);c+=String.fromCharCode(((e>>6)&63)|128);c+=String.fromCharCode((e&63)|128)}}}return c}return{encode:(typeof btoa=="function")?function(c){return btoa(c)}:function(g){var e="";var d,m,k,c,l,j,h;var f=0;g=b(g);while(f<g.length){d=g.charCodeAt(f++);m=g.charCodeAt(f++);k=g.charCodeAt(f++);c=d>>2;l=((d&3)<<4)|(m>>4);j=((m&15)<<2)|(k>>6);h=k&63;if(isNaN(m)){j=h=64}else{if(isNaN(k)){h=64}}e=e+a.charAt(c)+a.charAt(l)+a.charAt(j)+a.charAt(h)}return e}}})();Ext.override(Ext.grid.GridPanel,{getExcelXml:function(a){var b=this.createWorksheet(a);var c=this.getColumnModel().getTotalWidth(a);return'<xml version="1.0" encoding="utf-8"><ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office"><o:DocumentProperties><o:Title>'+this.title+"</o:Title></o:DocumentProperties><ss:ExcelWorkbook><ss:WindowHeight>"+b.height+"</ss:WindowHeight><ss:WindowWidth>"+b.width+'</ss:WindowWidth><ss:ProtectStructure>False</ss:ProtectStructure><ss:ProtectWindows>False</ss:ProtectWindows></ss:ExcelWorkbook><ss:Styles><ss:Style ss:ID="Default"><ss:Alignment ss:Vertical="Top" ss:WrapText="1" /><ss:Font ss:FontName="arial" ss:Size="10" /><ss:Borders><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Top" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Bottom" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Left" /><ss:Border ss:Color="#e4e4e4" ss:Weight="1" ss:LineStyle="Continuous" ss:Position="Right" /></ss:Borders><ss:Interior /><ss:NumberFormat /><ss:Protection /></ss:Style><ss:Style ss:ID="title"><ss:Borders /><ss:Font /><ss:Alignment ss:WrapText="1" ss:Vertical="Center" ss:Horizontal="Center" /><ss:NumberFormat ss:Format="@" /></ss:Style><ss:Style ss:ID="headercell"><ss:Font ss:Bold="1" ss:Size="10" /><ss:Alignment ss:WrapText="1" ss:Horizontal="Center" /><ss:Interior ss:Pattern="Solid" ss:Color="#A3C9F1" /></ss:Style><ss:Style ss:ID="even"><ss:Interior ss:Pattern="Solid" ss:Color="#CCFFFF" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evendate"><ss:NumberFormat ss:Format="[ENG][$-409]dd-mmm-yyyy;@" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evenint"><ss:NumberFormat ss:Format="0" /></ss:Style><ss:Style ss:Parent="even" ss:ID="evenfloat"><ss:NumberFormat ss:Format="0.00" /></ss:Style><ss:Style ss:ID="odd"><ss:Interior ss:Pattern="Solid" ss:Color="#CCCCFF" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="odddate"><ss:NumberFormat ss:Format="[ENG][$-409]dd-mmm-yyyy;@" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="oddint"><ss:NumberFormat ss:Format="0" /></ss:Style><ss:Style ss:Parent="odd" ss:ID="oddfloat"><ss:NumberFormat ss:Format="0.00" /></ss:Style></ss:Styles>'+b.xml+"</ss:Workbook>"},createWorksheet:function(c){var B=[];var u=[];var g=this.getColumnModel();var e=0;var b="";var x="";var f=0;for(var z=0;z<g.getColumnCount();z++){if(c||!g.isHidden(z)){var n=g.getColumnWidth(z);e+=n;if((Ext.ux.Utility.isNullOrUndefined(g.getDataIndex(z)))||(g.getColumnHeader(z)==="")||(g.getColumnId(z)==="checker")||(g.getColumnHeader(z)==="Alert")||((String(g.getColumnId(z)).match("_actions")=="_actions")&&(g.getColumnHeader(z)==="Actions"))){B.push("None");u.push("");++f}else{b+='<ss:Column ss:AutoFitWidth="1" ss:Width="'+n+'" />';x+='<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">'+g.getColumnHeader(z)+'</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>';var a=this.store.recordType.prototype.fields.get(g.getDataIndex(z));switch(a.type){case"int":B.push("Number");u.push("int");break;case"float":B.push("Number");u.push("float");break;case"bool":case"boolean":B.push("String");u.push("");break;case"date":B.push("DateTime");u.push("date");break;default:B.push("String");u.push("");break}}}}var p=B.length-f;var h={height:9000,width:Math.floor(e*30)+50};var y='<ss:Worksheet ss:Name="'+this.title+'"><ss:Names><ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\''+this.title+'\'!R1:R2" /></ss:Names><ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="'+(p)+'" ss:ExpandedRowCount="'+(this.store.getCount()+2)+'">'+b+'<ss:Row ss:Height="38"><ss:Cell ss:StyleID="title" ss:MergeAcross="'+(p-1)+'"><ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String"><html:B>Cacti CaMM plugin export rezult (Generated by ExtJS)</html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell></ss:Row><ss:Row ss:AutoFitHeight="1">'+x+"</ss:Row>";for(var z=0,d=this.store.data.items,s=d.length;z<s;z++){y+="<ss:Row>";var A=(z&1)?"odd":"even";r=d[z].data;var o=0;for(var m=0;m<g.getColumnCount();m++){if(c||!g.isHidden(m)){var q=r[g.getDataIndex(m)];if(B[o]!=="None"){if(!q){y+='<ss:Cell ss:StyleID="'+A+'"></ss:Cell>'}else{y+='<ss:Cell ss:StyleID="'+A+u[o]+'"><ss:Data ss:Type="'+B[o]+'">';if(B[o]=="DateTime"){y+=q.format("Y-m-d\\TH:i:s.000")}else{y+=q}y+="</ss:Data></ss:Cell>"}}o++}}y+="</ss:Row>"}h.xml=y+'</ss:Table><x:WorksheetOptions><x:PageSetup><x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" /><x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" /><x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" /></x:PageSetup><x:FitToPage /><x:Print><x:PrintErrors>Blank</x:PrintErrors><x:FitWidth>1</x:FitWidth><x:FitHeight>32767</x:FitHeight><x:ValidPrinterInfo /><x:VerticalResolution>600</x:VerticalResolution></x:Print><x:Selected /><x:DoNotDisplayGridlines /><x:ProtectObjects>False</x:ProtectObjects><x:ProtectScenarios>False</x:ProtectScenarios></x:WorksheetOptions></ss:Worksheet>';return h}});Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.CheckBoxMemory=Ext.extend(Object,{constructor:function(a){if(!a){a={}}this.prefix="id_";this.items={};this.idProperty=a.idProperty||"id"},init:function(a){this.grid=a;this.view=a.getView();this.store=null;this.sm=a.getSelectionModel();this.sm.on("rowselect",this.onSelect,this);this.sm.on("rowdeselect",this.onDeselect,this);this.view.on("refresh",this.reConfigure,this)},reConfigure:function(){this.store=this.grid.getStore();this.store.on("clear",this.onClear,this);this.store.on("datachanged",this.restoreState,this)},onSelect:function(b,c,a){this.items[this.getId(a)]=true},onDeselect:function(b,c,a){delete this.items[this.getId(a)]},restoreState:function(){if(this.store!=null){var a=0;var b=[];this.store.each(function(c){var d=this.getId(c);if(this.items[d]===true){b.push(a)}++a},this);if(b.length>0){this.sm.selectRows(b)}}},onClear:function(){var a=[];this.items={}},getId:function(a){return a.get(this.idProperty)}});Ext.namespace("Ext.ux.plugins");Ext.ux.plugins.TreePanelStatefull=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.plugins.TreePanelStatefull,Ext.util.Observable,{init:function(a){Ext.apply(a,{cp:null,state:null,stateful:true,lastSelectedNode:null,saveState:function(d){this.state=d;this.cp.set("TreePanelStatefull_"+this.id,this.state)},restoreState:function(k){var j=this.cp.get("LastSelectedNodeId_"+this.id);var g=this.state;if(this.state.length==0){var e=new Array(k);this.saveState(e);this.expandPath(k);return}for(var f=0;f<g.length;++f){try{var h=g[f];this.expandPath(h)}catch(d){}}},stateEvents:[{click:{fn:function(d){this.cp.set("LastSelectedNodePath_"+this.id,d.getPath());this.cp.set("LastSelectedNodeId_"+this.id,d.id)}},expandnode:{fn:function(e){var d=e.getPath();var g=new Array();for(var h=0;h<this.state.length;++h){var f=this.state[h];if(d.indexOf(f)==-1){g.push(f)}}g.push(d);this.saveState(g)}},collapsenode:{fn:function(g){if(g.id==this.root.id){return}var e=g.getPath();var j=new Array();for(var h=0;h<this.state.length;++h){var f=this.state[h];if(f.indexOf(e)==-1){j.push(f)}else{if(f==e){var d=g.parentNode;if(d.id!=this.root.id){j.push(d.getPath())}}}}if(j.length==0){var d=g.parentNode;j.push((d==null?this.pathSeparator:d.getPath()))}this.saveState(j)}},load:{fn:function(g){var f=this.cp.get("LastSelectedNodePath_"+this.id);var h=this.cp.get("LastSelectedNodeId_"+this.id);var d=this.getRootNode();if(g.id==d.id){this.restoreState(this.root.getPath());if(g.id==h){this.selectPath(f);g.fireEvent("click",g)}return}if(g.id==h){g.fireEvent("click",g)}else{var e=g.findChild("id",h);if(e&&e.isLeaf()){e.ensureVisible();this.selectPath(f);e.fireEvent("click",e)}else{if(e&&!e.isLeaf()){this.selectPath(f);e.fireEvent("click",e)}}}}},textchange:{fn:function(f,g,d){var e=this.cp.get("LastSelectedNodePath_"+this.id);var h=e.replace(d,g);this.cp.set("LastSelectedNodePath_"+this.id,h);this.expandPath(f.getPath());this.selectPath(f.getPath())}},remove:{fn:function(h,e,g){var f=this.cp.get("LastSelectedNodePath_"+this.id);var d=this.cp.get("LastSelectedNodeId_"+this.id);if(g.id==d){this.cp.set("LastSelectedNodePath_"+this.id,e.getPath());this.cp.set("LastSelectedNodeId_"+this.id,e.id)}}}}]});if(!a.stateful){a.stateful=true}if(!a.cp){if(this.cp){a.cp=this.cp}else{a.cp=new Ext.state.CookieProvider()}}if(!a.lastSelectedNode){var c=a.cp.get("LastSelectedNode_"+a.id);if(!c){a.lastSelectedNode=a.root}else{a.lastSelectedNode=c}}if(!a.state){var b=a.cp.get("TreePanelStatefull_"+a.id);if(!b){a.state=new Array()}else{a.state=b}}}});Ext.ns("Ext.ux.tree");Ext.ux.tree.TreeFilterX=Ext.extend(Ext.tree.TreeFilter,{expandOnFilter:true,filter:function(d,a,c){if(false!==this.expandOnFilter){c=c||this.tree.root;var b=this.tree.animate;this.tree.animate=false;c.expand(true,false,function(){Ext.ux.tree.TreeFilterX.superclass.filter.call(this,d,a,c)}.createDelegate(this));this.tree.animate=b}else{Ext.ux.tree.TreeFilterX.superclass.filter.apply(this,arguments)}},filterBy:function(j,h,g){g=g||this.tree.root;if(this.autoClear){this.clear()}var e=this.filtered,d=this.reverse;var a=function(f){if(f===g){return true}if(e[f.id]){return false}var k=j.call(h||f,f);if(!k||d){e[f.id]=f;f.ui.hide();return true}else{f.ui.show();var l=f.parentNode;while(l&&l!==this.root){l.ui.show();l=l.parentNode}return true}return true};g.cascade(a);if(this.remove){for(var c in e){if(typeof c!="function"){var b=e[c];if(b&&b.parentNode){b.parentNode.removeChild(b)}}}}}});Ext.namespace("Ext.ux.wam");Ext.ux.wam.PropertyRecord=Ext.data.Record.create([{name:"name",type:"string"},{name:"fname",type:"string"},{name:"text",type:"string"},"order","value",{name:"disabled",type:"boolean"},"editor","group","type","renderer"]);Ext.ux.wam.PropertyColumnModel=function(b){this.store=b;Ext.ux.wam.PropertyColumnModel.superclass.constructor.call(this,[{header:Ext.grid.PropertyColumnModel.prototype.nameText,width:50,sortable:false,dataIndex:"name",id:"name"},{header:Ext.grid.PropertyColumnModel.prototype.valueText,width:50,resizable:false,dataIndex:"value",id:"proper_value"},{header:"group",hidden:true,dataIndex:"group",id:"group"}]);this.bselect=Ext.DomHelper.append(document.body,{tag:"select",cls:"x-grid-editor x-hide-display",children:[{tag:"option",value:"true",html:"true"},{tag:"option",value:"false",html:"false"}]});var a=new Ext.form.Field({el:this.bselect,bselect:this.bselect,autoShow:true,getValue:function(){return this.bselect.value=="true"}});this.editors={date:new Ext.grid.GridEditor(new Ext.form.DateField({selectOnFocus:true})),string:new Ext.grid.GridEditor(new Ext.form.TextField({selectOnFocus:true})),number:new Ext.grid.GridEditor(new Ext.form.NumberField({selectOnFocus:true,style:"text-align:left;"})),"boolean":new Ext.grid.GridEditor(a)};this.renderCellDelegate=this.renderCell.createDelegate(this);this.renderPropDelegate=this.renderProp.createDelegate(this)};Ext.extend(Ext.ux.wam.PropertyColumnModel,Ext.grid.ColumnModel,{renderDate:function(a){return a.dateFormat(Ext.grid.PropertyColumnModel.prototype.dateFormat)},renderBool:function(a){return a?"true":"false"},isCellEditable:function(a,b){return(a==1)&&(this.store.getAt(b).data.disabled!==true)},getRenderer:function(a){return a==1?this.renderCellDelegate:this.renderPropDelegate},renderProp:function(b,a,c){return"<b>"+c.data.fname+"</b><br>"+c.data.text||c.data.name},renderCell:function(c,b,a){var d=c;if(a.data.renderer==""){if(c instanceof Date){d=this.renderDate(c)}else{if(typeof c=="boolean"){d=this.renderBool(c)}else{if(a.data.type=="combobox"){var d=c}}}d=Ext.util.Format.htmlEncode(d)}else{d=a.data.renderer.call(this,c)}return d},getCellEditor:function(a,d){var b=this.store.getAt(d);var c=b.data.value;if(b.data.editor!==""){return b.data.editor}if(c instanceof Date){return this.editors.date}else{if(typeof c=="number"){return this.editors.number}else{if(typeof c=="boolean"){return this.editors["boolean"]}else{return this.editors.string}}}}});Ext.ux.wam.PropertyGrid=Ext.extend(Ext.grid.EditorGridPanel,{enableColumnMove:false,stripeRows:false,trackMouseOver:false,clicksToEdit:1,enableHdMenu:false,initComponent:function(){this.lastEditRow=null;var a=new Ext.ux.wam.PropertyColumnModel(this.store);this.store.sort("order","ASC");this.addEvents("beforepropertychange","propertychange");this.cm=a;Ext.ux.wam.PropertyGrid.superclass.initComponent.call(this);this.selModel.on("beforecellselect",function(d,c,b){if(this.store.getAt(c).data.disabled==true){return false}if(b===0){this.startEditing.defer(200,this,[c,1]);return false}},this)},onRender:function(){Ext.ux.wam.PropertyGrid.superclass.onRender.apply(this,arguments);this.getGridEl().addClass("x-props-grid")}});Ext.ns("cacti.plugin.camm");cacti.plugin.camm.def_grid=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){var b=this.tbar||[];var a=this.plugins||[];Ext.apply(this,{viewConfig:{forceFit:true},layout:"fit",stripeRows:true,plugins:a.concat([new Ext.ux.grid.AutoSizeColumns]),loadMask:true,tbar:b.concat([{text:"Export to Excel...",iconCls:"excel_export",listeners:{click:{scope:this,fn:function(){document.location="data:application/vnd.ms-excel;base64,"+Base64.encode(this.getExcelXml())}}}}])});this.bbar=new Ext.PagingToolbar({plugins:[(new Ext.ux.Andrie.pPageSize({beforeText:"Rows per page:",afterText:""})),(new Ext.ux.Andrie.AutoRefresher)],pageSize:50,store:this.store,stateful:true,displayInfo:true,displayMsg:"Displaying rows {0} - {1} of {2} for {3}sec ({4}ms/row)",emptyMsg:"No rows to display"});cacti.plugin.camm.def_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.on({scope:this,beforeload:function(){this.store.start_time=new Date()},loadexception:cacti.plugin.camm.loadexception});Ext.PagingToolbar.override({updateInfo:function(){if(this.displayEl){var c=this.store.getCount();if(this.store.start_time===undefined){var b=0}else{var b=this.store.start_time.getElapsed()}var a=c===0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+c,this.store.getTotalCount(),Math.round(b/10)/100,Math.round(b/c*100)/100);this.displayEl.update(a)}}});cacti.plugin.camm.def_grid.superclass.onRender.apply(this,arguments)}});Ext.reg("camm_def_grid",cacti.plugin.camm.def_grid);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.testtrapstab_grid=Ext.extend(cacti.plugin.camm.def_grid,{initComponent:function(){this.selmod=new Ext.grid.RowSelectionModel();Ext.apply(this,{store:new Ext.data.Store({id:"testTrpDataStore",proxy:new Ext.data.HttpProxy({url:"camm_db_admin.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"description",type:"string",mapping:"description"},{name:"eventname",type:"string",mapping:"eventname"},{name:"eventid",type:"string",mapping:"eventid"},{name:"trapoid",type:"string",mapping:"trapoid"},{name:"enterprise",type:"string",mapping:"enterprise"},{name:"community",type:"string",mapping:"community"},{name:"category",type:"string",mapping:"category"},{name:"hostname",type:"string",mapping:"hostname"},{name:"severity",type:"string",mapping:"severity"},{name:"traptime",type:"date",mapping:"traptime",dateFormat:"Y-m-d H:i:s"},{name:"formatline",type:"string",mapping:"formatline"},{name:"alert",type:"int",mapping:"alert"}]),baseParams:{task:"camm_test_rule",type:"snmptt"},sortInfo:{field:"traptime",direction:"DESC"}}),cm:new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:60,hidden:true},{header:"Description",readOnly:true,dataIndex:"description",width:210},{header:"EventName",readOnly:true,dataIndex:"eventname",width:140},{header:"EventId",dataIndex:"eventid",width:100,hidden:true},{header:"TrapOid",hidden:true,dataIndex:"trapoid",width:100},{header:"Enterprise",hidden:true,dataIndex:"enterprise",width:100},{header:"Community",hidden:true,dataIndex:"community",width:100},{header:"Category",hidden:true,dataIndex:"category",width:100},{header:"HostName",dataIndex:"hostname",width:110},{header:"Severity",dataIndex:"severity",width:60},{header:"Trap Time",readOnly:true,dataIndex:"traptime",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:125},{id:"formatlinecolumn",header:"Format Line",dataIndex:"formatline",width:380,readOnly:true},{header:"Alert",dataIndex:"alert",renderer:this.rendalert,width:40}]),only_new_mode:false,selModel:this.selmod,viewConfig:{forceFit:true},enableColLock:false,layout:"fit",autoExpandColumn:"formatlinecolumn",loadMask:true,footer:true,tbar:[{text:"Use only new record",iconCls:"icon_bullet_new",enableToggle:true,pressed:this.only_new_mode,listeners:{click:{scope:this,fn:function(a){this.only_new_mode=(!this.only_new_mode);this.store.reload()}}}}]});cacti.plugin.camm.testtrapstab_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.on({scope:this,beforeload:function(){this.store.baseParams={task:"camm_test_rule",type:"snmptt",only_new:this.only_new_mode,filter:Ext.util.JSON.encode(filterModel.getFilterObj())}}});cacti.plugin.camm.testtrapstab_grid.superclass.onRender.apply(this,arguments)},rendalert:function(a,c,d,b,f,e){if(a>0){c.css="alerted"}}});Ext.reg("TestTrapsGrid",cacti.plugin.camm.testtrapstab_grid);var wndTest=new Ext.Window({caption:"Test Rule Rezults",frame:true,height:500,width:750,resizable:true,closeAction:"hide",modal:true,maximizable:true,layout:"fit",constrain:true,buttonAlign:"center",items:[{xtype:"TestTrapsGrid",id:"TestTrapsGrid_id"}],buttons:[{text:"Close",handler:function(){wndTest.hide(null)}}]});cacti.plugin.camm.testsyslstab_grid=Ext.extend(cacti.plugin.camm.def_grid,{initComponent:function(){this.selmod=new Ext.grid.RowSelectionModel();Ext.apply(this,{store:new Ext.data.Store({id:"testSysDataStore",proxy:new Ext.data.HttpProxy({url:"camm_db_admin.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"device_id",type:"int",mapping:"device_id"},{name:"description",type:"string",mapping:"description"},{name:"facility",type:"string",mapping:"facility"},{name:"priority",type:"string",mapping:"priority"},{name:"sys_date",type:"date",mapping:"sys_date",dateFormat:"Y-m-d H:i:s"},{name:"host",type:"string",mapping:"host"},{name:"message",type:"string",mapping:"message"}]),baseParams:{task:"camm_test_rule",type:"syslog"},sortInfo:{field:"sys_date",direction:"DESC"}}),cm:new Ext.grid.ColumnModel([{header:"id",dataIndex:"id",width:60,hidden:true,sortable:true},{header:"device_id",dataIndex:"device_id",width:60,hidden:true},{header:"Description",dataIndex:"description",width:210},{header:"host",dataIndex:"host",width:100},{header:"facility",dataIndex:"facility",width:140},{header:"priority",dataIndex:"priority",width:100},{header:"DateTime",dataIndex:"sys_date",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:125},{id:"formatlinecolumn",header:"message",dataIndex:"message",width:380},{header:"Alert",dataIndex:"alert",renderer:this.rendalert,width:47}]),selModel:this.selmod,viewConfig:{forceFit:true,getRowClass:function(d,b){var a="";var c=d.data.priority;switch(c){case"crit":a="crit-row";break;case"warning":a="warn-row";break;case"alert":a="alert-row";break;case"debug":a="debug-row";break;case"err":a="err-row";break}return a}},only_new_mode:false,enableColLock:false,layout:"fit",autoExpandColumn:"formatlinecolumn",loadMask:true,footer:true,tbar:[{text:"Use only new record",iconCls:"icon_bullet_new",enableToggle:true,pressed:this.only_new_mode,listeners:{click:{scope:this,fn:function(a){this.only_new_mode=(!this.only_new_mode);this.store.reload()}}}}]});cacti.plugin.camm.testsyslstab_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.on({scope:this,beforeload:function(){this.store.baseParams={task:"camm_test_rule",type:"syslog",only_new:this.only_new_mode,filter:Ext.util.JSON.encode(filterModel.getFilterObj())}}});cacti.plugin.camm.testsyslstab_grid.superclass.onRender.apply(this,arguments)},rendalert:function(a,c,d,b,f,e){if(d.data.status==0){c.css="record_new"}else{if(a>100){c.css="alerted"}else{if(a>0){return'<img src="'+camm_start_var.cacti_path+'/plugins/camm/images/flag_red.png"> ['+a+"]"}}}}});Ext.reg("TestSyslGrid",cacti.plugin.camm.testsyslstab_grid);var wndSysTest=new Ext.Window({caption:"Test Rule Rezults",frame:true,height:500,width:750,resizable:true,closeAction:"hide",modal:true,maximizable:true,layout:"fit",constrain:true,buttonAlign:"center",items:[{xtype:"TestSyslGrid",id:"TestSyslsGrid_id"}],buttons:[{text:"Close",handler:function(){wndSysTest.hide(null)}}]});cacti.plugin.camm.RuleFilterEdit=Ext.extend(Ext.Window,{id:"id_RuleFilterEdit_wnd",layout:"fit",width:580,height:450,resizable:true,plain:true,border:false,closeAction:"hide",modal:true,title:"Edit filter for rule",constrain:true,buttonAlign:"center",initComponent:function(){this.wndTest=wndTest;this.wndSysTest=wndSysTest;var e=new Ext.data.Store({autoLoad:true,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_eventnames"}});var b=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_severites"}});var a=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_facilitys"}});var c=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_prioritys"}});var d=[{id:"eventname",label:"snmptt - eventname",type:"string",availableValues:e,remoteStore:true},{id:"hostname",label:"snmptt - hostname"},{id:"severity",label:"snmptt - severity",type:"string",availableValues:b,remoteStore:true},{id:"traptime",label:"snmptt - traptime",type:"date",format:"Y-m-d H:i:s"},{id:"formatline",label:"snmptt - formatline"},{id:"facility",label:"syslog - facility",type:"string",availableValues:a,remoteStore:true},{id:"host",label:"syslog - host"},{id:"priority",label:"syslog - priority",type:"string",availableValues:c,remoteStore:true},{id:"sys_date",label:"syslog - message time",type:"date",format:"Y-m-d H:i:s"},{id:"message",label:"syslog - message"}];filterModel=new Ext.ux.netbox.core.FilterModel(d);localFilterResolver=new Ext.ux.netbox.core.LocalStoreFilterResolver(filterModel);var f=new Ext.Button({text:"Apply"});Ext.apply(this,{items:[{filterModel:filterModel,xtype:"dynamicFilter"}],buttons:[{text:"Done",iconCls:"icon-accept",handler:function(){this.clearFilterElementary();this.getEl().mask("Processing ...");Ext.Ajax.request({url:"camm_db_admin.php",method:"POST",scope:this,callback:cacti.plugin.camm.requestCallback,params:{task:"camm_convert_json_to_sql_string",filter:Ext.util.JSON.encode(filterModel.getFilterObj())}})},scope:this},{text:"Test it",formBind:true,handler:function(){this.clearFilterElementary();if(this.record_type=="snmptt"){this.wndTest.show();this.wndTest.items.itemAt(0).store.load({params:{start:0,limit:50}})}else{if(this.record_type=="syslog"){this.wndSysTest.show();this.wndSysTest.items.itemAt(0).store.load({params:{start:0,limit:50}})}}},scope:this},{text:"Cancel",iconCls:"icon-cancel",handler:function(){this.hide()},scope:this}]});cacti.plugin.camm.RuleFilterEdit.superclass.initComponent.apply(this,arguments)},onRender:function(){cacti.plugin.camm.RuleFilterEdit.superclass.onRender.apply(this,arguments)},clearFilterElementary:function(){var c=this.record_type.substring(0,6);var b=new Array();var b=filterModel.getAllElementaryFilters();imax=b.length;for(var e=0;e<imax;++e){var a=b[e];var d=a.field.label.substring(0,6);if(!(d==c)){filterModel.removeElementaryFilterById(a.id)}}},EditFilterRule:function(a){this.record=a.rec;this.record_type=a.type;this.show();if(!(this.record.data.json_filter=="")){filterModel.setFilterObj(Ext.util.JSON.decode(this.record.data.json_filter))}else{filterModel.setFilterObj(null)}}});Ext.reg("RuleFilterEdit",cacti.plugin.camm.RuleFilterEdit);cacti.plugin.camm.RuleWin=Ext.extend(Ext.Window,{layout:"fit",width:520,resizable:false,plain:true,border:false,autoHeight:true,closeAction:"hide",constrain:true,modal:true,initComponent:function(){this.win_RuleFilterEdit=new cacti.plugin.camm.RuleFilterEdit();this.frmpnlAddRule=new Ext.FormPanel({url:"camm_db_admin.php",id:"frmpnlAddRule",frame:true,bodyStyle:"padding:20px 20px 20px",monitorValid:true,labelWidth:85,buttonAlign:"center",autoHeight:true,width:520,bodyStyle:"padding-top:15px",items:[new Ext.form.TextField({name:"name",id:"id_name_fld",fieldLabel:"Rule name",width:380,height:20,allowBlank:false,minLength:7,msgTarget:"side"}),new Ext.form.ComboBox({name:"tule_type",id:"id_tule_type_cmbbx",fieldLabel:"Rule Type",store:new Ext.data.SimpleStore({fields:["label","value"],data:[["snmptt","snmptt"],["Syslog","syslog"]]}),width:380,height:80,mode:"local",displayField:"label",allowBlank:false,forceSelection:true,valueField:"value",msgTarget:"side",editable:false,triggerAction:"all"}),new Ext.form.ComboBox({name:"rule_enable",id:"id_rule_enable_cmbbx",fieldLabel:"Rule enable",store:new Ext.data.SimpleStore({fields:["label","value"],data:[["enable","enable"],["disable","disable"]]}),width:380,height:80,mode:"local",displayField:"label",allowBlank:false,forceSelection:true,valueField:"value",msgTarget:"side",editable:false,triggerAction:"all"}),new Ext.form.TriggerField({name:"sql_filter",id:"id_sql_filter_trFld",fieldLabel:"Filter (sql)",triggerClass:"x-form-search-trigger",readOnly:true,width:380,editable:false,onTriggerClick:this.editFilter.createDelegate(this)}),new Ext.form.TextArea({name:"notes",id:"id_notes_txtfld",fieldLabel:"Notes",grow:true,width:380,height:90}),{xtype:"fieldset",checkboxToggle:{type:"checkbox",tag:"input",name:"is_function",id:"id_is_function"},title:"Execute user function",autoHeight:true,defaults:{width:365},collapsed:false,items:[new Ext.form.ComboBox({name:"function_name",id:"id_function_name_cmbbx",fieldLabel:"Function",store:new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db_admin.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"data"},[{name:"id"},{name:"func_name"}]),baseParams:{task:"camm_get_user_functions"}}),width:230,height:80,mode:"remote",displayField:"func_name",allowBlank:false,forceSelection:true,valueField:"func_name",msgTarget:"side",editable:false,triggerAction:"all"})]},{xtype:"fieldset",checkboxToggle:{type:"checkbox",tag:"input",name:"is_email",id:"id_is_email"},title:"E-mail Notification",autoHeight:true,defaults:{width:365},collapsed:true,items:[{xtype:"textfield",id:"id_email_txtfld",name:"email",fieldLabel:"Email",height:20,allowBlank:false,vtype:"vt_email"},new Ext.form.ComboBox({name:"email_mode",id:"id_email_mode_cmbbx",fieldLabel:"Email Mode",store:new Ext.data.SimpleStore({fields:["label","value"],data:[["All records in the one mail","1"],["Each record in the separate mail","2"]]}),mode:"local",width:365,listWidth:365,displayField:"label",allowBlank:false,forceSelection:true,valueField:"value",msgTarget:"side",editable:false,triggerAction:"all"}),{xtype:"textarea",id:"id_email_msg_txtfld",name:"email_message",fieldLabel:"Email message",height:90,allowBlank:true,minLength:10}]},{xtype:"fieldset",checkboxToggle:{type:"checkbox",tag:"input",name:"is_delete",id:"id_is_delete"},title:"Delete Record",autoHeight:true,defaultType:"textfield",collapsed:true},{xtype:"fieldset",checkboxToggle:{type:"checkbox",tag:"input",name:"is_mark",id:"id_is_mark"},title:"Mark Record",autoHeight:true,defaults:{width:365},defaultType:"numberfield",collapsed:true,items:[{fieldLabel:"marker",id:"id_marker_numfld",name:"marker",height:20,maxValue:100,allowBlank:false}]}],buttons:[{text:"Done",iconCls:"icon-accept",formBind:true,handler:function(){this.sel_record.set("is_delete",Ext.get("id_is_delete").dom.checked);this.sel_record.set("is_email",Ext.get("id_is_email").dom.checked);this.sel_record.set("is_function",Ext.get("id_is_function").dom.checked);this.sel_record.set("is_mark",Ext.get("id_is_mark").dom.checked);this.sel_record.set("sql_filter",this.sel_record.data.sql_filter);this.sel_record.set("json_filter",this.sel_record.data.json_filter);this.sel_record.set("name",this.frmpnlAddRule.items.itemAt(0).getValue());this.sel_record.set("rule_type",this.frmpnlAddRule.items.itemAt(1).getValue());this.sel_record.set("rule_enable",(this.frmpnlAddRule.items.itemAt(2).getValue()=="enable"?"1":"0"));this.sel_record.set("function_name",Ext.getCmp("id_function_name_cmbbx").getValue());this.sel_record.set("email",Ext.getCmp("id_email_txtfld").getValue());this.sel_record.set("email_mode",Ext.getCmp("id_email_mode_cmbbx").getValue());this.sel_record.set("email_message",Ext.getCmp("id_email_msg_txtfld").getValue());this.sel_record.set("marker",Ext.getCmp("id_marker_numfld").getValue());this.sel_record.set("notes",Ext.getCmp("id_notes_txtfld").getValue());this.sel_record.set("date",new Date());this.hide()},scope:this},{text:"Cancel",iconCls:"icon-cancel",handler:function(){if(((this.mode=="add")||(this.mode=="add_on_trap")||(this.mode=="add_on_sys"))){this.sel_record.store.remove(this.sel_record)}this.hide(null)},scope:this}]});Ext.apply(this,{items:[this.frmpnlAddRule]});cacti.plugin.camm.RuleWin.superclass.initComponent.apply(this,arguments)},editFilter:function(){this.win_RuleFilterEdit.EditFilterRule({rec:this.sel_record,type:this.frmpnlAddRule.items.itemAt(1).getValue()})},addRecord:function(){var a=this.rule_store;if(a.recordType){var b=new a.recordType({newRecord:true});b.fields.each(function(c){b.data[c.name]=c.defaultValue||null});b.commit();a.add(b);return b}return false},showtab:function(b){this.mode=b.mode;switch(b.mode){case"edit":this.setTitle("Edit rule");this.sel_record=b.rec;this.show();break;case"add":this.setTitle("Add new rule");this.sel_record=this.addRecord();this.show();break;case"add_on_trap":this.setTitle("Create new rule based on trap");this.sel_record=this.addRecord();var a=b.rec.data;this.show();this.sel_record.set("rule_type","snmptt");this.sel_record.set("notes","Rule was auto create based on trap");this.sel_record.set("json_filter",'{"left":{"left":{"left":{"left":{"fieldId":"eventname","operatorId":"STRING_EQUAL","values":[{"label":"'+a.eventname+'","value":"'+a.eventname+'"}]},"logicalOperator":"AND","right":{"fieldId":"formatline","operatorId":"STRING_EQUAL","values":[{"label":"'+a.formatline+'","value":"'+a.formatline+'"}]}},"logicalOperator":"AND","right":{"fieldId":"hostname","operatorId":"STRING_EQUAL","values":[{"label":"'+a.hostname+'","value":"'+a.hostname+'"}]}},"logicalOperator":"AND","right":{"fieldId":"severity","operatorId":"STRING_EQUAL","values":[{"label":"'+a.severity+'","value":"'+a.severity+'"}]}},"logicalOperator":"AND","right":{"fieldId":"traptime","operatorId":"DATE_EQUAL","values":[{"value":"'+a.traptime.format("Y-m-d H:i:s")+'","label":"'+a.traptime.format("Y-m-d H:i:s")+'"}]}}');this.win_RuleFilterEdit.EditFilterRule({rec:this.sel_record,type:"snmptt"});break;case"add_on_sys":this.setTitle("Create new rule based on syslog message");this.sel_record=this.addRecord();var a=b.rec.data;this.show();this.sel_record.set("rule_type","syslog");this.sel_record.set("notes","Rule was auto create based on syslog message");this.sel_record.set("json_filter",'{"left":{"left":{"left":{"left":{"fieldId":"host","operatorId":"STRING_EQUAL","values":[{"label":"'+a.host+'","value":"'+a.host+'"}]},"logicalOperator":"AND","right":{"fieldId":"facility","operatorId":"STRING_EQUAL","values":[{"label":"'+a.facility+'","value":"'+a.facility+'"}]}},"logicalOperator":"AND","right":{"fieldId":"priority","operatorId":"STRING_EQUAL","values":[{"label":"'+a.priority+'","value":"'+a.priority+'"}]}},"logicalOperator":"AND","right":{"fieldId":"sys_date","operatorId":"DATE_EQUAL","values":[{"value":"'+a.sys_date.format("Y-m-d H:i:s")+'","label":"'+a.sys_date.format("Y-m-d H:i:s")+'"}]}},"logicalOperator":"AND","right":{"fieldId":"message","operatorId":"STRING_EQUAL","values":[{"label":"'+a.message+'","value":"'+a.message+'"}]}}');this.win_RuleFilterEdit.EditFilterRule({rec:this.sel_record,type:"syslog"});break}this.frmpnlAddRule.getForm().loadRecord(this.sel_record);Ext.getCmp("id_function_name_cmbbx").store.load();Ext.getCmp("id_function_name_cmbbx").setValue(this.sel_record.data.function_name);Ext.getCmp("id_tule_type_cmbbx").setValue(this.sel_record.data.rule_type);Ext.getCmp("id_email_mode_cmbbx").setValue(this.sel_record.data.email_mode);Ext.getCmp("id_rule_enable_cmbbx").setValue(this.sel_record.data.rule_enable==1?"enable":"disable");if(this.sel_record.data.is_function==true){this.frmpnlAddRule.items.itemAt(5).expand();Ext.get("id_is_function").dom.checked=true}else{this.frmpnlAddRule.items.itemAt(5).collapse();Ext.get("id_is_function").dom.checked=false}if(this.sel_record.data.is_email==true){this.frmpnlAddRule.items.itemAt(6).expand();Ext.get("id_is_email").dom.checked=true}else{this.frmpnlAddRule.items.itemAt(6).collapse();Ext.get("id_is_email").dom.checked=false}if(this.sel_record.data.is_delete==true){this.frmpnlAddRule.items.itemAt(7).expand();Ext.get("id_is_delete").dom.checked=true}else{this.frmpnlAddRule.items.itemAt(7).collapse();Ext.get("id_is_delete").dom.checked=false}if(this.sel_record.data.is_mark==true){this.frmpnlAddRule.items.itemAt(8).expand();Ext.get("id_is_mark").dom.checked=true}else{this.frmpnlAddRule.items.itemAt(8).collapse();Ext.get("id_is_mark").dom.checked=false}}});Ext.reg("RuleWin",cacti.plugin.camm.RuleWin);cacti.plugin.camm.TrapWin=Ext.extend(Ext.Window,{layout:"fit",width:580,resizable:false,plain:true,border:false,autoHeight:true,closeAction:"hide",modal:true,title:"View full trap",constrain:true,initComponent:function(){this.frmpnlFullTrap=new Ext.FormPanel({url:"camm_db.php",id:"frmpnlFullTrap",frame:true,bodyStyle:"padding:10px 10px 0",labelWidth:85,buttonAlign:"center",autoHeight:true,width:550,bodyStyle:"padding-top:10px",defaults:{height:20,width:440},items:[new Ext.form.TextArea({name:"id",fieldLabel:"ID"}),new Ext.form.TextArea({name:"eventname",fieldLabel:"Eventname"}),new Ext.form.TextArea({name:"eventid",fieldLabel:"Eventid"}),new Ext.form.TextArea({name:"trapoid",fieldLabel:"Trapoid"}),new Ext.form.TextArea({name:"enterprise",fieldLabel:"Enterprise"}),new Ext.form.TextArea({name:"community",fieldLabel:"Community"}),new Ext.form.TextArea({name:"hostname",fieldLabel:"hostname"}),new Ext.form.TextArea({name:"agentip",fieldLabel:"agentip"}),new Ext.form.TextArea({name:"category",fieldLabel:"category"}),new Ext.form.TextArea({name:"severity",fieldLabel:"severity"}),new Ext.form.TextArea({name:"uptime",fieldLabel:"uptime"}),new Ext.form.TextArea({name:"traptime",fieldLabel:"traptime"}),new Ext.form.TextArea({name:"formatline",fieldLabel:"Formatline",grow:true,width:400,height:40}),new Ext.form.TextArea({name:"status",fieldLabel:"status"}),new Ext.form.TextArea({name:"alert",fieldLabel:"alert"})],buttons:[{text:"Close",iconCls:"icon-cancel",handler:function(){this.hide(null)},scope:this}]});Ext.apply(this,{items:[this.frmpnlFullTrap]});cacti.plugin.camm.TrapWin.superclass.initComponent.apply(this,arguments)},showTrap:function(a){this.rec_id=a.rec_id;this.show();this.frmpnlFullTrap.getForm().load({url:"camm_db.php",waitMsg:"Loading",method:"POST",params:{task:"camm_get_full_trap",id:"["+a.rec_id+"]"}})}});Ext.reg("TrapWin",cacti.plugin.camm.TrapWin);cacti.plugin.camm.UnkTrapWin=Ext.extend(Ext.Window,{layout:"fit",width:580,resizable:false,plain:true,border:false,autoHeight:true,closeAction:"hide",modal:true,title:"View full unk trap",constrain:true,initComponent:function(){this.frmpnlFullTrap=new Ext.FormPanel({url:"camm_db.php",id:"frmpnlFullUnkTrap",frame:true,bodyStyle:"padding:10px 10px 0",labelWidth:85,buttonAlign:"center",autoHeight:true,width:550,bodyStyle:"padding-top:10px",defaults:{height:20,width:440},items:[new Ext.form.TextArea({name:"id",fieldLabel:"ID"}),new Ext.form.TextArea({name:"trapoid",fieldLabel:"Trapoid"}),new Ext.form.TextArea({name:"enterprise",fieldLabel:"Enterprise"}),new Ext.form.TextArea({name:"community",fieldLabel:"Community"}),new Ext.form.TextArea({name:"hostname",fieldLabel:"hostname"}),new Ext.form.TextArea({name:"agentip",fieldLabel:"agentip"}),new Ext.form.TextArea({name:"uptime",fieldLabel:"uptime"}),new Ext.form.TextArea({name:"traptime",fieldLabel:"traptime"}),new Ext.form.TextArea({name:"formatline",fieldLabel:"Formatline",grow:true,width:400,height:40})],buttons:[{text:"Close",iconCls:"icon-cancel",handler:function(){this.hide(null)},scope:this}]});Ext.apply(this,{items:[this.frmpnlFullTrap]});cacti.plugin.camm.UnkTrapWin.superclass.initComponent.apply(this,arguments)},showTrap:function(a){this.rec_id=a.rec_id;this.show();this.frmpnlFullTrap.getForm().load({url:"camm_db.php",waitMsg:"Loading",method:"POST",params:{task:"camm_get_full_unk_trap",id:"["+a.rec_id+"]"}})}});Ext.reg("UnkTrapWin",cacti.plugin.camm.UnkTrapWin);cacti.plugin.camm.SysMesWin=Ext.extend(Ext.Window,{layout:"fit",width:580,resizable:false,plain:true,border:false,autoHeight:true,closeAction:"hide",modal:true,title:"View full Syslog message",constrain:true,initComponent:function(){this.frmpnlFullSysMes=new Ext.FormPanel({url:"camm_db.php",id:"frmpnlFullSysMessage",frame:true,bodyStyle:"padding:10px 10px 0",labelWidth:85,buttonAlign:"center",autoHeight:true,width:550,bodyStyle:"padding-top:10px",defaults:{height:20,width:440},items:[new Ext.form.TextArea({name:"id",fieldLabel:"ID"}),new Ext.form.TextArea({name:"facility",fieldLabel:"Facility"}),new Ext.form.TextArea({name:"priority",fieldLabel:"Priority"}),new Ext.form.TextArea({name:"sys_date",fieldLabel:"Sys_date"}),new Ext.form.TextArea({name:"host",fieldLabel:"Host"}),new Ext.form.TextArea({name:"sourceip",fieldLabel:"sourceip"}),new Ext.form.TextArea({name:"status",fieldLabel:"status"}),new Ext.form.TextArea({name:"message",fieldLabel:"Message",grow:true,width:400,height:40})],buttons:[{text:"Close",iconCls:"icon-cancel",handler:function(){this.hide(null)},scope:this}]});Ext.apply(this,{items:[this.frmpnlFullSysMes]});cacti.plugin.camm.SysMesWin.superclass.initComponent.apply(this,arguments)},showSys:function(a){this.rec_id=a.rec_id;this.show();this.frmpnlFullSysMes.getForm().load({url:"camm_db.php",callback:cacti.plugin.camm.requestCallback,scope:this,waitMsg:"Loading",method:"POST",params:{task:"camm_get_full_sys_mes",id:"["+a.rec_id+"]"}})}});Ext.reg("SysMesWin",cacti.plugin.camm.SysMesWin);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.rules_tab_rules_grid=Ext.extend(cacti.plugin.camm.def_grid,{idName:"id",id:"rules_tab_rules_grid_id",objName:"company",layout:"fit",buttonAlign:"center",initComponent:function(){this.win_addRule=new cacti.plugin.camm.RuleWin();this.recordForm=new Ext.ux.grid.RecordForm({title:"Edit camm Rule",iconCls:"icon-edit-record",columnCount:1,ignoreFields:{id:true,date:true},readonlyFields:{action1:true},disabledFields:{},formConfig:{labelWidth:65,buttonAlign:"center",bodyStyle:"padding-top:10px"},windowConfig:{width:750}});this.rowActions=new Ext.ux.grid.RowActions({header:"Actions",actions:[{iconCls:"icon-minus",qtip:"Delete Record"},{iconCls:"icon-edit-record",qtip:"Edit Record"},{iconCls:"icon-force_go",qtip:"Force run this Rule"}],widthIntercept:Ext.isSafari?4:2,id:"rule_actions"});this.rowActions.on("action",this.onRowAction,this);Ext.apply(this,{store:new Ext.data.GroupingStore({id:0,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"name",type:"string",mapping:"name"},{name:"rule_type",type:"string",mapping:"rule_type"},{name:"rule_enable",type:"string",mapping:"rule_enable"},{name:"is_function",type:"boolean",mapping:"is_function"},{name:"is_email",type:"boolean",mapping:"is_email"},{name:"is_mark",type:"boolean",mapping:"is_mark"},{name:"is_delete",type:"boolean",mapping:"is_delete"},{name:"function_name",type:"string",mapping:"function_name"},{name:"email",type:"string",mapping:"email"},{name:"email_mode",type:"int"},{name:"email_message",type:"string",mapping:"email_message"},{name:"marker",type:"int",mapping:"marker"},{name:"notes",type:"string",mapping:"notes"},{name:"date",type:"date",mapping:"date",dateFormat:"Y-m-d H:i:s"},{name:"username",type:"string",mapping:"username"},{name:"json_filter",type:"string",mapping:"json_filter"},{name:"count_triggered",type:"int",mapping:"count_triggered"},{name:"sql_filter",type:"string",mapping:"sql_filter"}]),sortInfo:{field:"id",direction:"ASC"},baseParams:{task:"camm_get_rules_records"}}),cm:new Ext.grid.ColumnModel([this.rowActions,{header:"id",id:"id",sortable:true,dataIndex:"id",hidden:true,width:15},{header:"Name",sortable:true,dataIndex:"name",width:60},{header:"Type",sortable:true,dataIndex:"rule_type",width:60},{header:"Enable",sortable:true,dataIndex:"rule_enable",width:20,renderer:this.rend_enable},{header:"Actions",width:110,renderer:this.rend_actions},{header:"is_function",sortable:true,dataIndex:"is_function",hidden:true,width:55},{header:"is_email",sortable:true,dataIndex:"is_email",hidden:true,width:35},{header:"is_mark",sortable:true,dataIndex:"is_mark",hidden:true,width:35},{header:"is_delete",sortable:true,dataIndex:"is_delete",hidden:true,width:45},{header:"Function name",dataIndex:"function_name",sortable:true,hidden:true,width:50},{header:"Email",dataIndex:"email",sortable:true,hidden:true,width:50},{header:"Email_message",id:"id_email_message",dataIndex:"email_message",sortable:true,hidden:true,width:110},{header:"Marker",dataIndex:"marker",sortable:true,hidden:true,width:20},{header:"Count Trig.",sortable:true,dataIndex:"count_triggered",width:30},{header:"Notes",id:"id_notes",dataIndex:"notes",sortable:true,width:110},{header:"Author name",dataIndex:"username",sortable:true,width:80},{header:"Date",dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:55},{header:"Filter (SQL)",id:"id_sql_filter",dataIndex:"sql_filter",sortable:true,hidden:true,width:120}]),view:new Ext.grid.GroupingView({forceFit:true,getRowClass:function(d,b){var a="";var c=d.data.rule_enable;switch(c){case"0":a="debug-row";break}return a},groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),selModel:new Ext.grid.RowSelectionModel(),viewConfig:{forceFit:true},columns:this.rowActions,enableColLock:false,layout:"fit",plugins:[this.rowActions,this.recordForm],autoExpandColumn:"FormatLine",loadMask:true,footer:true,buttons:[{text:"Save",iconCls:"icon-disk",scope:this,disabled:!(is_camm_admin==1),handler:this.commitChanges},{text:"Reset",iconCls:"icon-undo",scope:this,disabled:!(is_camm_admin==1),handler:function(){this.store.rejectChanges()}}],tbar:[{text:"Add Rule",disabled:!(is_camm_admin==1),iconCls:"icon-form-add",listeners:{click:{scope:this,buffer:200,fn:function(a){this.win_addRule.showtab({mode:"add"})}}}}]});cacti.plugin.camm.rules_tab_rules_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.load({params:{start:0,limit:50,task:"camm_get_rules_records",filter:"null"}});cacti.plugin.camm.rules_tab_rules_grid.superclass.onRender.apply(this,arguments);this.win_addRule.rule_store=this.store;this.on({scope:this,celldblclick:function(a,b){var c=this.store.getAt(b);this.win_addRule.showtab({mode:"edit",rec:c})}})},rend_actions:function(a,c,d,b,f,e){rezult="";if(d.data.is_function===true){rezult=rezult+"Execute user function ["+d.data.function_name+"]<br>"}if(d.data.is_email){rezult=rezult+"send e-mail to ["+d.data.email+"]";if(d.data.email_mode==1){rezult=rezult+" (one message)<br>"}else{rezult=rezult+" (separate messages)<br>"}}if(d.data.is_delete){rezult=rezult+"delete this trap."}else{if(d.data.is_mark){rezult=rezult+"mark this trap with marker ["+d.data.marker+"]."}}return rezult},rend_enable:function(a,c,d,b,f,e){if(a==1){return"true"}else{return"false"}},addRecord:function(){var a=this.store;if(a.recordType){var b=new a.recordType({newRecord:true});b.fields.each(function(c){b.data[c.name]=c.defaultValue||null});b.commit();a.add(b);return b}return false},onRowAction:function(d,b,e,a,c){if(is_camm_admin==1){switch(e){case"icon-minus":this.deleteRecord(b);break;case"icon-edit-record":this.win_addRule.showtab({mode:"edit",rec:b});break;case"icon-force_go":if(b.dirty){Ext.Msg.show({title:"Record changed",msg:"<b>You NEED</b> save rule to apply changes before execute it.",buttons:Ext.Msg.OK,icon:Ext.Msg.INFO});return}Ext.Msg.show({title:"Force Execute Rule ?",msg:"Do you really want to force execute rule  <b>"+b.get("name")+"</b>?<br/>It will mention all records already processed.</br>There is no undo.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(f){if("yes"!==f){return}this.getEl().mask("Execute rule ... ");var g=[];g.push(b.get("id"));Ext.Ajax.request({waitMsg:"Please Wait",url:"camm_db_admin.php",method:"POST",timeout:240000,scope:this,callback:cacti.plugin.camm.requestCallback,params:{task:"camm_execute_rule",id:Ext.encode(g)}})}});break}}else{Ext.Msg.alert("error","You do not have rigth for this action")}},commitChanges:function(){var c=this.store.getModifiedRecords();if(!c.length){return}this.getEl().mask("saving");var a=[];Ext.each(c,function(f,e){var d=f.getChanges();if(f.data.newRecord){d.newRecord=true}d[this.idName]=f.get(this.idName);a.push(d)},this);var b={url:"camm_db_admin.php",method:"POST",callback:cacti.plugin.camm.requestCallback,scope:this,params:{task:"camm_save_rule",objName:this.objName,data:Ext.encode(a)}};Ext.Ajax.request(b)},deleteRecord:function(a){var b=this;Ext.Msg.show({title:"Delete record?",msg:"Do you really want to delete <b>"+a.get("name")+"</b><br/>There is no undo.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(c){if("yes"!==c){return}this.getEl().mask("Deleting rule ... ");var d=[];d.push(a.get("id"));Ext.Ajax.request({waitMsg:"Please Wait",url:"camm_db_admin.php",method:"POST",scope:b,callback:cacti.plugin.camm.requestCallback,params:{task:"camm_delete_rule",id:Ext.encode(d)}})}})}});Ext.reg("RulesGrid",cacti.plugin.camm.rules_tab_rules_grid);cacti.plugin.camm.rule_tab=Ext.extend(Ext.Panel,{title:"Rules",layout:"border",closable:false,initComponent:function(){this.nettp_type_store=new Ext.data.SimpleStore({fields:["label","value"],data:[["camm","camm"],["syslog","syslog"]]}),this.rulesfilterCfg=[{id:"name",label:"name"},{id:"rule_type",label:"type",type:"string",availableValues:this.nettp_type_store,remoteStore:false},{id:"message",label:"FormatLine"},{id:"user",label:"user"},{id:"email",label:"email"},{id:"notes",label:"notes"},{id:"date",label:"date",type:"date",format:"Y-m-d H:i:s"}],this.rulesfieldManager=new Ext.ux.netbox.core.FieldManager(this.rulesfilterCfg),this.rulesfilterModel=new Ext.ux.netbox.core.FilterModel(this.rulesfieldManager),this.ruleslocalFilterResolver=new Ext.ux.netbox.core.LocalStoreFilterResolver(this.rulesfilterModel);Ext.apply(this,{items:[{id:"pn_rule_filter_grid",stateid:"stateid_panel_rile_grid",layout:"fit",title:"Global Search (in database)",height:195,region:"north",split:false,collapsible:true,collapseMode:"mini",animCollapse:true,animate:true,collapsed:true,items:[{filterModel:this.rulesfilterModel,id:"rulesfilter",colsNumber:3,labelWidth:45,labelAlign:"top",rowSize:40,ratio:33,labelPad:1,xtype:"staticFilter",itemCls:"filter",buttons:[{text:"Apply Filter",listeners:{click:{scope:this,fn:function(){this.apllyFilter()}}}},{text:"Clear Filter",listeners:{click:{scope:this,fn:function(){this.clearFilter()}}}}]}]},{xtype:"RulesGrid",region:"center",stateid:"stateid_rile_grid",plugins:[new Ext.ux.netbox.core.FilterHeaderPlugin(this.rulesfilterModel)]}]});cacti.plugin.camm.rule_tab.superclass.initComponent.apply(this,arguments);this.filterPanel=this.items.itemAt(0);this.gridPanel=this.items.itemAt(1);this.gridstore=this.gridPanel.store;this.gridPanel.on({scope:this,render:function(){this.gridstore.on({scope:this,beforeload:function(){this.gridstore.baseParams={filter:Ext.util.JSON.encode(this.rulesfilterModel.getFilterObj()),task:"camm_get_rules_records"}}})}})},afterRender:function(){cacti.plugin.camm.rule_tab.superclass.afterRender.apply(this,arguments)},apllyFilter:function(){this.gridstore.load({params:{start:0,limit:50}})},clearFilter:function(){this.rulesfilterModel.setFilterObj(null);this.gridstore.load({params:{start:0,limit:50}})}});Ext.reg("rule_tab",cacti.plugin.camm.rule_tab);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.syslogtab_grid=Ext.extend(cacti.plugin.camm.def_grid,{id:"sysl_tab_sysl_grid_id",initComponent:function(){this.win_FullSysMes=new cacti.plugin.camm.SysMesWin();this.rowActions=new Ext.ux.grid.RowActions({header:"Actions",actions:[{iconCls:"icon-edit-magnifier",qtip:"Edit Record"},{iconCls:"x-icon-modify",qtip:"create rule based on this message"}],widthIntercept:Ext.isSafari?4:2,id:"syslog_actions"});this.rowActions.on("action",this.onRowAction,this);this.selmod=new Ext.grid.CheckboxSelectionModel();Ext.apply(this,{store:new Ext.data.GroupingStore({id:"SyslogDataStore",proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"device_id",type:"int",mapping:"device_id"},{name:"description",type:"string",mapping:"description"},{name:"facility",type:"string",mapping:"facility"},{name:"priority",type:"string",mapping:"priority"},{name:"sys_date",type:"date",mapping:"sys_date",dateFormat:"Y-m-d H:i:s"},{name:"host",type:"string",mapping:"host"},{name:"message",type:"string",mapping:"message"}]),baseParams:{task:"camm_get_syslog_records",tree_id:"root",filter:""},sortInfo:{field:"sys_date",direction:"DESC"}}),cm:new Ext.grid.ColumnModel([this.selmod,this.rowActions,{header:"id",dataIndex:"id",width:60,hidden:true,sortable:true},{header:"device_id",dataIndex:"device_id",width:60,hidden:true},{header:"Description",dataIndex:"description",width:210},{header:"host",dataIndex:"host",width:100},{header:"facility",dataIndex:"facility",width:140},{header:"priority",dataIndex:"priority",width:100},{header:"DateTime",dataIndex:"sys_date",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:125},{id:"formatlinecolumn",header:"message",dataIndex:"message",width:380},{header:"Alert",dataIndex:"alert",renderer:this.rendalert,width:47}]),view:new Ext.grid.GroupingView({forceFit:true,getRowClass:function(d,b){var a="";var c=Ext.util.Format.lowercase(d.data.priority);switch(c){case"emergency":case"emerg":a="emergency-row";break;case"critical":case"crit":a="critical-row";break;case"notice":a="notice-row";break;case"info":a="info-row";break;case"debug":a="debug-row";break;case"warning":case"warn":a="warning-row";break;case"alert":a="alert-row";break;case"error":case"err":a="error-row";break}return a},onLoad:Ext.emptyFn,listeners:{beforerefresh:function(a){a.scrollTop=a.scroller.dom.scrollTop;a.scrollHeight=a.scroller.dom.scrollHeight},refresh:function(a){a.scroller.dom.scrollTop=a.scrollTop+(a.scrollTop==0?0:a.scroller.dom.scrollHeight-a.scrollHeight)}},groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),selModel:this.selmod,viewConfig:{forceFit:true},columns:this.rowActions,plugins:[this.rowActions,new Ext.ux.plugins.CheckBoxMemory()],enableColLock:false,layout:"fit",autoExpandColumn:"formatlinecolumn",loadMask:true,footer:true,tbar:[{text:"Actions",tooltip:"Actions with selected rows",menu:new Ext.menu.Menu({id:"sys_mainMenu",items:[{text:"Delete selected rows",id:"0",tooltip:"Delete selected rows",scope:this,handler:this.DeleteRecord,iconCls:"icon-minus",disabled:!(is_camm_admin==1)}]}),iconCls:"blist"}]});cacti.plugin.camm.syslogtab_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){cacti.plugin.camm.syslogtab_grid.superclass.onRender.apply(this,arguments);this.bottomToolbar.plugins["0"].setPageSize(camm_start_var.camm_num_rows||50);this.bottomToolbar.plugins["1"].public_update(parseFloat(camm_start_var.camm_sys_tab_update)||0);this.on({scope:this,celldblclick:function(a,b){var c=this.store.getAt(b);this.win_FullSysMes.showSys({rec_id:c.data.id})}})},rendalert:function(a,c,d,b,f,e){if(d.data.status==0){c.css="record_new"}else{if(a>100){c.css="alerted"}else{if(a>0){return'<img src="'+camm_start_var.cacti_path+'plugins/camm/images/flag_red.png"> ['+a+"]"}}}},onRowAction:function(e,c,f,a,d){switch(f){case"icon-edit-magnifier":this.win_FullSysMes.showSys({rec_id:c.data.id});break;case"x-icon-modify":if(is_camm_admin==1){MainTabs.activate("rule_tab_id");var b=MainTabs.items.item("rule_tab_id").items.item("rules_tab_rules_grid_id");if(b.getStore().getCount()==0){b.getStore().on("load",function(){MainTabs.items.item("rule_tab_id").items.item("rules_tab_rules_grid_id").win_addRule.showtab({mode:"add_on_sys",rec:c})},false,{single:true})}else{b.win_addRule.showtab({mode:"add_on_sys",rec:c})}}else{Ext.Msg.alert("error","You do not have rigth for this action")}break}},DeleteRecord:function(){var a=this.selModel;var b=this;if(a.getCount()>=1){Ext.Msg.show({title:"Delete record?",msg:"Do you really want to delete selected messages? There is no undo.",icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(c){if("yes"!==c){return}this.getEl().mask("Deleting messages ... ");var d=a.getSelections();var f=[];for(i=0;i<a.getCount();i++){f.push(d[i].json.id)}var e=Ext.encode(f);Ext.Ajax.request({scope:b,url:"camm_db_admin.php",method:"POST",params:{task:"camm_delete_syslog_message",ids:e},callback:cacti.plugin.camm.requestCallback})}})}else{Ext.MessageBox.alert("Uh oh...","You must select at least one trap.")}}});Ext.reg("syslogGrid",cacti.plugin.camm.syslogtab_grid);cacti.plugin.camm.syslog_tab=Ext.extend(Ext.Panel,{title:"syslog",layout:"border",closable:false,initComponent:function(){this.camm_facility_store=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_facilitys"}});this.camm_priority_store=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_prioritys"}});this.syslogfilterCfg=[{id:"facility",label:"Facility",type:"string",availableValues:this.camm_facility_store,remoteStore:true},{id:"host",label:"hostname"},{id:"sys_date",label:"DateTime",type:"date",format:"Y-m-d H:i:s"},{id:"priority",label:"Priority",type:"string",availableValues:this.camm_priority_store,remoteStore:true},{id:"message",label:"message"},{id:"alert",label:"alert",type:"int"}],this.syslogfieldManager=new Ext.ux.netbox.core.FieldManager(this.syslogfilterCfg),this.syslogfilterModel=new Ext.ux.netbox.core.FilterModel(this.syslogfieldManager),this.sysloglocalFilterResolver=new Ext.ux.netbox.core.LocalStoreFilterResolver(this.syslogfilterModel),this.MenuTree=new Ext.tree.TreePanel({width:300,rootVisible:false,autoScroll:true,cp:Ext.state.Manager.getProvider(),preloadChildren:true,tbar:["Filter:",{xtype:"trigger",triggerClass:"x-form-clear-trigger",onTriggerClick:function(){this.setValue("");SysTreefilter.clear()},id:"Sysfilter",enableKeyEvents:true,listeners:{keyup:{buffer:150,fn:function(d,c){if(Ext.EventObject.ESC==c.getKey()){d.onTriggerClick()}else{var f=this.getRawValue();var b=new RegExp(".*"+f+".*","i");SysTreefilter.clear();SysTreefilter.filter(b,"text")}}}}}],plugins:[new Ext.ux.plugins.TreePanelStatefull({cp:Ext.state.Manager.getProvider()})],loader:new Ext.tree.TreeLoader({dataUrl:"camm_db.php",requestMethod:"POST",root:"data",baseParams:{task:"camm_get_menutree",type:"syslog"}}),root:new Ext.tree.AsyncTreeNode({text:"My Root Node"})}),SysTreefilter=new Ext.ux.tree.TreeFilterX(this.MenuTree);Ext.apply(this,{items:[{id:"pn_syslog_filter_grid",stateid:"stateid_panel_syslog_grid",layout:"fit",title:"Global Search (in database)",height:195,region:"north",split:false,collapsible:true,collapseMode:"mini",animCollapse:true,animate:true,collapsed:true,titleCollapse:true,items:[{filterModel:this.syslogfilterModel,id:"syslogfilter",colsNumber:3,labelWidth:45,labelAlign:"top",rowSize:40,ratio:33,labelPad:1,xtype:"staticFilter",itemCls:"filter",buttons:[{text:"Apply Filter",listeners:{click:{scope:this,fn:function(){this.apllyFilter()}}}},{text:"Clear Filter",listeners:{click:{scope:this,fn:function(){this.clearFilter()}}}}]}]},{xtype:"syslogGrid",region:"center",stateid:"stateid_syslog_grid",plugins:[new Ext.ux.netbox.core.FilterHeaderPlugin(this.syslogfilterModel)]},{layout:"fit",title:"Tree Menu",id:"sysTreePanelWest",width:305,region:"west",split:true,collapsible:true,collapseMode:"mini",minSize:150,maxSize:400,layoutConfig:{animate:true},items:[this.MenuTree],tools:[{id:"minus",qtip:"Collapse all",scope:this,handler:function(){this.MenuTree.collapseAll();this.MenuTree.getRootNode().firstChild.expand()}},{id:"plus",qtip:"Expand all",scope:this,handler:function(){this.MenuTree.expandAll()}},{id:"refresh",qtip:"Refresh tree",scope:this,handler:function(){this.MenuTree.root.reload()}},{id:"gear",qtip:"Recreate tree",scope:this,handler:function(){if(is_camm_admin==1){this.MenuTree.getEl().mask("ReCreate");Ext.Ajax.request({scope:this.MenuTree,url:"camm_db_admin.php",method:"POST",timeout:90000,params:{task:"camm_recreate_tree",type:"syslog"},callback:cacti.plugin.camm.requestCallback})}else{Ext.Msg.alert("error","You do not have rigth for this action")}}}]}]});cacti.plugin.camm.syslog_tab.superclass.initComponent.apply(this,arguments);this.gridPanel=this.items.itemAt(1);this.gridstore=this.gridPanel.store;var a=this.items.itemAt(2).items.itemAt(0);this.gridPanel.on({scope:this,render:function(){this.gridstore.on({scope:this,beforeload:function(){var b=this.MenuTree.getSelectionModel().getSelectedNode();if(!b){b=this.MenuTree.getRootNode().firstChild}else{if(b.firstChild==this.MenuTree.getRootNode().firstChild){b=this.MenuTree.getRootNode().firstChild}}if(!b){b="root"}else{b=b.id}this.gridstore.baseParams={filter:Ext.util.JSON.encode(this.syslogfilterModel.getFilterObj()),task:"camm_get_syslog_records",tree_id:b,limit:this.gridPanel.bottomToolbar.pageSize}}});if(this.gridstore.getTotalCount()==0){this.gridstore.load({params:{start:0}})}}});TreeSelectModel=this.MenuTree.getSelectionModel();TreeSelectModel.on({selectionchange:function(b,c){this.gridstore.load({params:{start:0}})},scope:this});this.MenuTree.loader.on({beforeload:function(){this.MenuTree.getEl().mask("loading")},scope:this,load:function(){this.MenuTree.getEl().unmask()},scope:this,loadexception:function(){this.MenuTree.getEl().unmask()},scope:this})},afterRender:function(){cacti.plugin.camm.syslog_tab.superclass.afterRender.apply(this,arguments)},apllyFilter:function(){this.gridstore.load({params:{start:0}})},clearFilter:function(){this.syslogfilterModel.setFilterObj(null);this.gridstore.load({params:{start:0}})}});Ext.reg("syslog_tab",cacti.plugin.camm.syslog_tab);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.StatsGrid=Ext.extend(Ext.grid.GridPanel,{idName:"id",objName:"company",initComponent:function(){Ext.apply(this,{store:new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"stats"},[{name:"type",type:"string",mapping:"type"},{name:"name",type:"string",mapping:"name"},{name:"value",type:"string",mapping:"value"}]),sortInfo:{field:"type",direction:"ASC"},baseParams:{task:"camm_get_stats"},groupField:"type"}),cm:new Ext.grid.ColumnModel([{header:"name",sortable:true,dataIndex:"name",width:60},{header:"value",dataIndex:"value",sortable:true,width:80},{header:"type",dataIndex:"type",width:60,hidden:true}]),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:"{group}"}),selModel:new Ext.grid.RowSelectionModel(),viewConfig:{forceFit:true},enableColLock:false,layout:"fit",autoExpandColumn:"value",loadMask:true,footer:true,tbar:[{text:"Update",iconCls:"arrow_refresh",scope:this,handler:function(){this.store.load()}},{text:"Export to Excel...",iconCls:"excel_export",listeners:{click:{scope:this,fn:function(){document.location="data:application/vnd.ms-excel;base64,"+Base64.encode(this.getExcelXml())}}}}]});cacti.plugin.camm.StatsGrid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.on({scope:this,loadexception:cacti.plugin.camm.loadexception});this.store.load({params:{task:"view_stats"}});cacti.plugin.camm.StatsGrid.superclass.onRender.apply(this,arguments)}});Ext.reg("StatsGrid",cacti.plugin.camm.StatsGrid);cacti.plugin.camm.stat_graph_pan=Ext.extend(Ext.Panel,{initComponent:function(){Ext.apply(this,{title:"Graphs",id:"test1111",width:700,autoLoad:{url:"camm_db.php",method:"POST",nocache:true,timeout:20,params:{task:"camm_get_graphurl"}},tbar:[{text:"Update",iconCls:"arrow_refresh",scope:this,handler:this.updateGraph}]});cacti.plugin.camm.stat_graph_pan.superclass.initComponent.apply(this,arguments)},updateGraph:function(){this.getUpdater().update({url:"camm_db.php",timeout:20,method:"POST",nocache:true,params:{task:"camm_get_graphurl"}})}});Ext.reg("stat_graph_pan",cacti.plugin.camm.stat_graph_pan);cacti.plugin.camm.stat_tab=Ext.extend(Ext.Panel,{title:"Stats",layout:"border",closable:false,initComponent:function(){Ext.apply(this,{items:[{xtype:"StatsGrid",region:"center",layout:"fit",stateid:"stateid_state_grid"},{xtype:"stat_graph_pan",region:"west",collapsible:true,collapseMode:"mini",autoScroll:true}]});cacti.plugin.camm.stat_tab.superclass.initComponent.apply(this,arguments)},afterRender:function(){cacti.plugin.camm.stat_tab.superclass.afterRender.apply(this,arguments)}});Ext.reg("stat_tab",cacti.plugin.camm.stat_tab);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.RezultGrid=Ext.extend(Ext.grid.GridPanel,{idName:"id",height:"auto",objName:"company",title:"Rezults",enableColumnHide:false,enableColumnMove:false,enableHdMenu:false,height:250,initComponent:function(){Ext.apply(this,{store:new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"rezults"},[{name:"id",type:"int",mapping:"id"},{name:"group",type:"string",mapping:"group"},{name:"title",type:"string",mapping:"title"},{name:"message",type:"string",mapping:"message"},{name:"step_rezult",type:"string",mapping:"step_rezult"},{name:"step_data",type:"string",mapping:"step_data"},{name:"check_rezult",type:"string",mapping:"check_rezult"},{name:"check_data",type:"string",mapping:"check_data"}]),sortInfo:{field:"id",direction:"ASC"},baseParams:{task:"camm_view_rezults"},groupField:"group"}),cm:new Ext.grid.ColumnModel([{header:"id",hidden:true,sortable:true,dataIndex:"id",width:60},{header:"Group",hidden:true,sortable:true,dataIndex:"group",width:60},{header:"Title",sortable:false,dataIndex:"title",width:300},{header:"Action",sortable:false,dataIndex:"message",width:300},{header:"Rezult",dataIndex:"step_rezult",sortable:false,renderer:this.rendrezult,width:80},{header:"Check",dataIndex:"check_rezult",width:60,renderer:this.rendcheck,sortable:false}]),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),autoExpandColumn:"action",selModel:new Ext.grid.RowSelectionModel(),viewConfig:{forceFit:true},enableColLock:false,layout:"fit",loadMask:true,footer:true});cacti.plugin.camm.RezultGrid.superclass.initComponent.apply(this,arguments)},onRender:function(){cacti.plugin.camm.RezultGrid.superclass.onRender.apply(this,arguments)},rendrezult:function(a,c,d,b,f,e){if(a==="OK"){c.css="rezult_ok"}else{if(a==="no access"){c.css="rezult_no_access"}else{c.css="rezult_no_ok"}}if(d.data.step_data){return a+" ["+d.data.step_data+"]"}else{return a}},rendcheck:function(a,c,d,b,f,e){if(a==="OK"){c.css="rezult_ok"}else{if(a==="no access"){c.css="rezult_no_access"}else{c.css="rezult_no_ok"}}if(d.data.check_data){return a+" ["+d.data.check_data+"]"}else{return a}}});Ext.reg("RezultGrid",cacti.plugin.camm.RezultGrid);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.unknown_tab_grid=Ext.extend(cacti.plugin.camm.def_grid,{id:"unk_tab_unk_grid_id",initComponent:function(){this.win_FullUnkTrap=new cacti.plugin.camm.UnkTrapWin();this.rowActions=new Ext.ux.grid.RowActions({header:"Actions",actions:[{iconCls:"icon-edit-magnifier",qtip:"Edit Record"}],widthIntercept:Ext.isSafari?4:2,id:"unktraps_actions"});this.rowActions.on("action",this.onRowAction,this);this.selmod=new Ext.grid.CheckboxSelectionModel();Ext.apply(this,{store:new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"trapoid",type:"string",mapping:"trapoid"},{name:"enterprise",type:"string",mapping:"enterprise"},{name:"community",type:"string",mapping:"community"},{name:"hostname",type:"string",mapping:"hostname"},{name:"agentip",type:"string",mapping:"agentip"},{name:"traptime",type:"date",mapping:"traptime",dateFormat:"Y-m-d H:i:s"},{name:"formatline",type:"string",mapping:"formatline"}]),sortInfo:{field:"traptime",direction:"DESC"},baseParams:{task:"camm_get_unktraps_records",filter:""}}),cm:new Ext.grid.ColumnModel([this.selmod,this.rowActions,{header:"trapoid",sortable:true,dataIndex:"trapoid",width:120},{header:"enterprise",sortable:true,dataIndex:"enterprise",width:100},{header:"community",dataIndex:"community",sortable:true,hidden:true,width:110},{header:"hostname",dataIndex:"hostname",sortable:true,width:80},{header:"agentip",dataIndex:"agentip",sortable:true,width:80},{header:"Trap Time",readOnly:true,sortable:true,dataIndex:"traptime",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:125},{id:"formatlinecolumn",header:"Format Line",dataIndex:"formatline",sortable:true,width:380,readOnly:true}]),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),selModel:this.selmod,viewConfig:{forceFit:true},plugins:[this.rowActions,new Ext.ux.plugins.CheckBoxMemory()],enableColLock:false,layout:"fit",autoExpandColumn:"formatlinecolumn",loadMask:true,footer:true,tbar:[{text:"Actions",tooltip:"Actions with selected rows",menu:new Ext.menu.Menu({id:"mainMenu",items:[{text:"Delete selected rows",tooltip:"Delete selected rows",iconCls:"icon-minus",scope:this,disabled:!(is_camm_admin==1),handler:this.DeleteRecord}]}),iconCls:"blist"}]});cacti.plugin.camm.unknown_tab_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){cacti.plugin.camm.unknown_tab_grid.superclass.onRender.apply(this,arguments);this.bottomToolbar.plugins["0"].setPageSize(camm_start_var.camm_num_rows||0);this.bottomToolbar.plugins["1"].public_update(parseFloat(camm_start_var.camm_unktrap_tab_update)||0);this.on({scope:this,celldblclick:function(a,b){var c=this.store.getAt(b);this.win_FullUnkTrap.showTrap({rec_id:c.data.id})}})},onRowAction:function(d,b,e,a,c){switch(e){case"icon-edit-magnifier":this.win_FullUnkTrap.showTrap({rec_id:b.data.id});break}},DeleteRecord:function(){var a=this.selModel;var b=this;if(a.getCount()>=1){Ext.MessageBox.confirm("Confirmation","Are you sure you want to delete the following traps?",function(c){if(c=="yes"){var d=a.getSelections();var f=[];for(i=0;i<a.getCount();i++){f.push(d[i].json.id)}var e=Ext.encode(f);Ext.Ajax.request({waitMsg:"Please Wait",url:"camm_db_admin.php",method:"POST",scope:b,params:{task:"camm_delete_unktraps",ids:e},callback:cacti.plugin.camm.requestCallback})}})}else{Ext.MessageBox.alert("Uh oh...","You must select at least one trap.")}}});Ext.reg("UnkTrapsGrid",cacti.plugin.camm.unknown_tab_grid);cacti.plugin.camm.unktraps_tab=Ext.extend(Ext.Panel,{title:"Unknown Traps",layout:"border",closable:false,initComponent:function(){this.unktrapsfilterCfg=[{id:"trapoid",label:"trapoid"},{id:"enterprise",label:"enterprise"},{id:"community",label:"community"},{id:"hostname",label:"hostname"},{id:"agentip",label:"agentip"},{id:"traptime",label:"traptime",type:"date",format:"Y-m-d H:i:s"},{id:"formatline",label:"formatline"}],this.unktrapsfieldManager=new Ext.ux.netbox.core.FieldManager(this.unktrapsfilterCfg),this.unktrapsfilterModel=new Ext.ux.netbox.core.FilterModel(this.unktrapsfieldManager),this.unktrapslocalFilterResolver=new Ext.ux.netbox.core.LocalStoreFilterResolver(this.unktrapsfilterModel);Ext.apply(this,{items:[{id:"pn_unktraps_filter_grid",stateid:"stateid_panel_unktraps_grid",layout:"fit",title:"Global Search (in database)",height:195,region:"north",split:false,collapsible:true,collapseMode:"mini",animCollapse:true,animate:true,collapsed:true,items:[{filterModel:this.unktrapsfilterModel,id:"unktrapsfilter",colsNumber:3,labelWidth:45,labelAlign:"top",rowSize:40,ratio:33,labelPad:1,xtype:"staticFilter",itemCls:"filter",buttons:[{text:"Apply Filter",listeners:{click:{scope:this,fn:function(){this.apllyFilter()}}}},{text:"Clear Filter",listeners:{click:{scope:this,fn:function(){this.clearFilter()}}}}]}]},{xtype:"UnkTrapsGrid",region:"center",stateid:"stateid_unktraps_grid",plugins:[new Ext.ux.netbox.core.FilterHeaderPlugin(this.unktrapsfilterModel)]}]});cacti.plugin.camm.unktraps_tab.superclass.initComponent.apply(this,arguments);this.filterPanel=this.items.itemAt(0);this.gridPanel=this.items.itemAt(1);this.gridstore=this.gridPanel.store;this.gridPanel.on({scope:this,render:function(){this.gridstore.on({scope:this,beforeload:function(){this.gridstore.baseParams={filter:Ext.util.JSON.encode(this.unktrapsfilterModel.getFilterObj()),task:"camm_get_unktraps_records",limit:this.gridPanel.bottomToolbar.pageSize}}});if(this.gridstore.getTotalCount()==0){this.gridstore.load({params:{start:0}})}}})},afterRender:function(){cacti.plugin.camm.unktraps_tab.superclass.afterRender.apply(this,arguments)},apllyFilter:function(){this.gridstore.load({params:{start:0}})},clearFilter:function(){this.unktrapsfilterModel.setFilterObj(null);this.gridstore.load({params:{start:0}})}});Ext.reg("unktraps_tab",cacti.plugin.camm.unktraps_tab);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.settings_grid=Ext.extend(Ext.ux.wam.PropertyGrid,{id:"pg",frame:true,layout:"fit",buttonAlign:"center",title:"Settings",initComponent:function(){Ext.apply(this,{store:new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"camm_db_admin.php",method:"POST"}),recordType:Ext.ux.wam.PropertyRecord,groupField:"group",remoteSort:true,sortInfo:{field:"text",direction:"DESC"},reader:new Ext.data.JsonReader({id:"name",root:"settings"},Ext.ux.wam.PropertyRecord),baseParams:{task:"camm_get_settings"}}),view:new Ext.grid.GroupingView({forceFit:true,emptyGroupText:"No Group",enableGroupingMenu:false,showGroupName:false,getRowClass:function(a){return(a.data.disabled==true)?"x-item-disabled":""}}),enableColLock:false,layout:"fit",autoExpandColumn:"name",loadMask:true,footer:true,buttons:[{text:"Save",iconCls:"icon-disk",scope:this,disabled:!(is_camm_admin==1),handler:this.commitChanges},{text:"Reload",iconCls:"arrow_refresh",scope:this,disabled:!(is_camm_admin==1),handler:function(){this.store.reload()}},{text:"Reset",iconCls:"icon-undo",scope:this,disabled:!(is_camm_admin==1),handler:function(){this.store.rejectChanges()}}]});cacti.plugin.camm.settings_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){this.store.on({scope:this,datachanged:function(b){var a=this.store.getRange();if(!a.length){return}Ext.each(a,function(d,c){switch(d.data.type){case"date":d.data.value=new Date(Date.parseDate(d.data.value,"Y-m-d H:i:s"));break;case"boolean":d.data.value=Boolean(d.data.value);break;case"combobox":d.data.editor=new Ext.grid.GridEditor(new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["label","value"],data:d.data.editor}),listeners:{select:function(g,e,f){cur_rec=b.getById(d.data.name);if(!Ext.ux.Utility.isNullOrUndefined(cur_rec)){cur_rec.data.r_value=e.data.value}}},editable:false,typeAhead:true,displayField:"label",selectOnFocus:true,triggerAction:"all",forceSelection:true,mode:"local"}));break}},this)}});this.store.load();cacti.plugin.camm.settings_grid.superclass.onRender.apply(this,arguments)},renderer_crenderer:function(a){return'<span style="color:'+a+';">'+a+"</span>"},commitChanges:function(){var c=this.store.getModifiedRecords();if(!c.length){return}this.getEl().mask("saving");var a=[];Ext.each(c,function(f,e){var d=f.getChanges();d.name=f.get("name");d.r_value=f.get("r_value");a.push(d)},this);var b={url:"camm_db_admin.php",method:"POST",callback:cacti.plugin.camm.requestCallback,scope:this,params:{task:"camm_save_settings",data:Ext.encode(a)}};Ext.Ajax.request(b)}});Ext.reg("SettingsGrid",cacti.plugin.camm.settings_grid);Ext.ns("cacti.plugin.camm");cacti.plugin.camm.trapstab_grid=Ext.extend(cacti.plugin.camm.def_grid,{id:"trap_tab_trap_grid_id",initComponent:function(){this.win_FullTrap=new cacti.plugin.camm.TrapWin();this.rowActions=new Ext.ux.grid.RowActions({header:"Actions",actions:[{iconCls:"icon-edit-magnifier",qtip:"Edit Record"},{iconCls:"x-icon-modify",qtip:"create rule based on this trap"}],widthIntercept:Ext.isSafari?4:2,id:"traps_actions"});this.rowActions.on("action",this.onRowAction,this);this.selmod=new Ext.grid.CheckboxSelectionModel();Ext.apply(this,{store:new Ext.data.GroupingStore({id:"TrpDataStore",proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"results",totalProperty:"total",id:"id"},[{name:"id",type:"int",mapping:"id"},{name:"description",type:"string",mapping:"description"},{name:"eventname",type:"string",mapping:"eventname"},{name:"eventid",type:"string",mapping:"eventid"},{name:"trapoid",type:"string",mapping:"trapoid"},{name:"enterprise",type:"string",mapping:"enterprise"},{name:"community",type:"string",mapping:"community"},{name:"category",type:"string",mapping:"category"},{name:"hostname",type:"string",mapping:"hostname"},{name:"severity",type:"string",mapping:"severity"},{name:"traptime",type:"date",mapping:"traptime",dateFormat:"Y-m-d H:i:s"},{name:"formatline",type:"string",mapping:"formatline"},{name:"status",type:"int",mapping:"status"},{name:"alert",type:"int",mapping:"alert"}]),baseParams:{task:"camm_get_traps_records",tree_id:"root",filter:""},sortInfo:{field:"traptime",direction:"DESC"}}),cm:new Ext.grid.ColumnModel([this.selmod,this.rowActions,{header:"id",dataIndex:"id",width:60,hidden:true},{header:"Description",readOnly:true,dataIndex:"description",width:210},{header:"EventName",readOnly:true,dataIndex:"eventname",width:140},{header:"EventId",dataIndex:"eventid",width:100,hidden:true},{header:"TrapOid",hidden:true,dataIndex:"trapoid",width:100},{header:"Enterprise",hidden:true,dataIndex:"enterprise",width:100},{header:"Community",hidden:true,dataIndex:"community",width:100},{header:"Category",hidden:true,dataIndex:"category",width:100},{header:"HostName",dataIndex:"hostname",width:110},{header:"Severity",dataIndex:"severity",width:60},{header:"Trap Time",readOnly:true,dataIndex:"traptime",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s"),width:125},{id:"formatlinecolumn",header:"Format Line",dataIndex:"formatline",width:380,readOnly:true},{header:"Alert",dataIndex:"alert",renderer:this.rendalert,width:47}]),view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'}),selModel:this.selmod,viewConfig:{forceFit:true},columns:this.rowActions,plugins:[this.rowActions,new Ext.ux.plugins.CheckBoxMemory()],enableColLock:false,layout:"fit",autoExpandColumn:"formatlinecolumn",loadMask:true,footer:true,tbar:[{text:"Actions",tooltip:"Actions with selected rows",menu:new Ext.menu.Menu({id:"mainMenu",items:[{text:"Delete selected rows",id:"0",tooltip:"Delete selected rows",scope:this,handler:this.DeleteRecord,iconCls:"icon-minus",disabled:!(is_camm_admin==1)}]}),iconCls:"blist"}]});cacti.plugin.camm.trapstab_grid.superclass.initComponent.apply(this,arguments)},onRender:function(){cacti.plugin.camm.trapstab_grid.superclass.onRender.apply(this,arguments);this.bottomToolbar.plugins["0"].setPageSize(camm_start_var.camm_num_rows||50);this.bottomToolbar.plugins["1"].public_update(parseFloat(camm_start_var.camm_trap_tab_update)||0);this.on({scope:this,celldblclick:function(a,b){var c=this.store.getAt(b);this.win_FullTrap.showTrap({rec_id:c.data.id})}})},rendalert:function(a,c,d,b,f,e){if(d.data.status==0){c.css="record_new"}else{if(a>100){c.css="alerted"}else{if(a>0){return'<img src="'+camm_start_var.cacti_path+'plugins/camm/images/flag_red.png"> ['+a+"]"}}}},onRowAction:function(e,c,f,a,d){switch(f){case"icon-edit-magnifier":this.win_FullTrap.showTrap({rec_id:c.data.id});break;case"x-icon-modify":if(is_camm_admin==1){MainTabs.activate("rule_tab_id");var b=MainTabs.items.item("rule_tab_id").items.item("rules_tab_rules_grid_id");if(b.getStore().getCount()==0){b.getStore().on("load",function(){MainTabs.items.item("rule_tab_id").items.item("rules_tab_rules_grid_id").win_addRule.showtab({mode:"add_on_trap",rec:c})},false,{single:true})}else{b.win_addRule.showtab({mode:"add_on_trap",rec:c})}}else{Ext.Msg.alert("error","You do not have rigth for this action")}break}},DeleteRecord:function(){var b=this.selModel;var a=this;if(b.getCount()>=1){Ext.MessageBox.confirm("Confirmation","Are you sure you want to delete the following traps?",function(c){if(c=="yes"){var d=b.getSelections();var f=[];for(i=0;i<b.getCount();i++){f.push(d[i].json.id)}var e=Ext.encode(f);Ext.Ajax.request({scope:a,waitMsg:"Please Wait",url:"camm_db_admin.php",method:"POST",params:{task:"camm_delete_traps",ids:e},callback:cacti.plugin.camm.requestCallback})}})}else{Ext.MessageBox.alert("Uh oh...","You must select at least one trap.")}}});Ext.reg("TrapsGrid",cacti.plugin.camm.trapstab_grid);cacti.plugin.camm.traps_tab=Ext.extend(Ext.Panel,{title:"Traps",layout:"border",closable:false,initComponent:function(){this.camm_eventname_store=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_eventnames"}});this.camm_severity_store=new Ext.data.Store({autoLoad:false,proxy:new Ext.data.HttpProxy({url:"camm_db.php",method:"POST"}),reader:new Ext.data.JsonReader({root:"names"},[{name:"label"},{name:"value"}]),baseParams:{task:"camm_get_severites"}});this.trapsfilterCfg=[{id:"eventname",label:"eventname",type:"string",availableValues:this.camm_eventname_store,remoteStore:true},{id:"hostname",label:"hostname"},{id:"severity",label:"severity",type:"string",availableValues:this.camm_severity_store,remoteStore:true},{id:"traptime",label:"traptime",type:"date",format:"Y-m-d H:i:s"},{id:"formatline",label:"formatline"},{id:"alert",label:"alert",type:"int"}],this.trapsfieldManager=new Ext.ux.netbox.core.FieldManager(this.trapsfilterCfg),this.trapsfilterModel=new Ext.ux.netbox.core.FilterModel(this.trapsfieldManager),this.trapslocalFilterResolver=new Ext.ux.netbox.core.LocalStoreFilterResolver(this.trapsfilterModel);this.trpTree_Category_Loader=new Ext.tree.TreeLoader({dataUrl:"camm_db.php",requestMethod:"POST",root:"data",baseParams:{task:"camm_get_menutree",type:"snmptt"}}),this.trpTree_Category_Root=new Ext.tree.AsyncTreeNode({text:"My Root Node",draggable:false,id:"root"}),this.trpTree_Category=new Ext.tree.TreePanel({cp:Ext.state.Manager.getProvider(),root:this.trpTree_Category_Root,collapsible:false,animCollapse:true,border:true,preloadChildren:true,rootVisible:false,id:"trpTree_Category",autoScroll:true,layout:"fit",animate:true,singleExpand:false,plugins:[new Ext.ux.plugins.TreePanelStatefull({cp:Ext.state.Manager.getProvider()})],enableDD:true,mask:true,containerScroll:true,loader:this.trpTree_Category_Loader}),Ext.apply(this,{items:[{id:"pn_traps_filter_grid",stateid:"stateid_panel_traps_grid",layout:"fit",title:"Global Search (in database)",height:195,region:"north",split:false,collapsible:true,collapseMode:"mini",animCollapse:true,animate:true,collapsed:true,items:[{filterModel:this.trapsfilterModel,id:"trapsfilter",colsNumber:3,labelWidth:45,labelAlign:"top",rowSize:40,ratio:33,labelPad:1,xtype:"staticFilter",itemCls:"filter",buttons:[{text:"Apply Filter",listeners:{click:{scope:this,fn:function(){this.apllyFilter()}}}},{text:"Clear Filter",listeners:{click:{scope:this,fn:function(){this.clearFilter()}}}}]}]},{xtype:"TrapsGrid",region:"center",stateid:"stateid_traps_grid",plugins:[new Ext.ux.netbox.core.FilterHeaderPlugin(this.trapsfilterModel)]},{layout:"fit",title:"Tree Menu",id:"trpTreePanelWest",width:200,region:"west",split:true,collapsible:true,collapseMode:"mini",minSize:175,maxSize:400,layoutConfig:{animate:true},items:[this.trpTree_Category],tools:[{id:"minus",qtip:"Collapse all",scope:this,handler:function(){this.trpTree_Category.collapseAll();this.trpTree_Category.getRootNode().firstChild.expand()}},{id:"plus",qtip:"Expand all",scope:this,handler:function(){this.trpTree_Category.expandAll()}},{id:"refresh",qtip:"Refresh tree",scope:this,handler:function(){this.trpTree_Category.root.reload()}},{id:"gear",qtip:"Recreate tree",scope:this,handler:function(){if(is_camm_admin==1){this.trpTree_Category.getEl().mask("ReCreate");Ext.Ajax.request({scope:this.trpTree_Category,url:"camm_db_admin.php",method:"POST",timeout:90000,params:{task:"camm_recreate_tree",type:"snmptt"},callback:cacti.plugin.camm.requestCallback})}else{Ext.Msg.alert("error","You do not have rigth for this action")}}}]}]});cacti.plugin.camm.traps_tab.superclass.initComponent.apply(this,arguments);this.filterPanel=this.items.itemAt(0);this.gridPanel=this.items.itemAt(1);this.gridstore=this.gridPanel.store;this.gridPanel.on({scope:this,render:function(){this.gridstore.on({scope:this,beforeload:function(){var a=this.trpTree_Category.getSelectionModel().getSelectedNode();if(!a){a=this.trpTree_Category.getRootNode()}this.gridstore.baseParams={filter:Ext.util.JSON.encode(this.trapsfilterModel.getFilterObj()),task:"camm_get_traps_records",tree_id:a.id,limit:this.gridPanel.bottomToolbar.pageSize}}});if(this.gridstore.getTotalCount()==0){this.gridstore.load({params:{start:0}})}}});TreeSelectModel=this.trpTree_Category.getSelectionModel();TreeSelectModel.on({selectionchange:function(a,b){this.gridstore.load({params:{start:0}})},scope:this});this.trpTree_Category.loader.on({beforeload:function(){this.trpTree_Category.getEl().mask("loading")},scope:this,load:function(){this.trpTree_Category.getEl().unmask()},scope:this,loadexception:function(){this.trpTree_Category.getEl().unmask()},scope:this})},afterRender:function(){cacti.plugin.camm.traps_tab.superclass.afterRender.apply(this,arguments)},apllyFilter:function(){this.gridstore.load({params:{start:0}})},clearFilter:function(){this.trapsfilterModel.setFilterObj(null);this.gridstore.load({params:{start:0}})}});Ext.reg("traps_tab",cacti.plugin.camm.traps_tab);Ext.ns("cacti.plugin.camm");Ext.BLANK_IMAGE_URL="./images/default/s.gif";var MainTabs;var vt_email_test=/^([\w\-]+)(\.[\w]+)*@([\w\-]+\.){1,5}([A-Za-z]){2,4}$/;Ext.apply(Ext.form.VTypes,{vt_email:function(a){return vt_email_test.test(a)},vt_emailText:'This field should be an e-mail address in the format "user@domain.com"',vt_emailMask:/[a-z0-9_\.\-@]/i});cacti.plugin.camm.showError=function(b,a){Ext.Msg.show({title:a||"Error",msg:Ext.util.Format.ellipsis(b,2300),icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK,minWidth:1230>String(b).length?360:600})};cacti.plugin.camm.loadexception=function(g,d,c,f){try{var b=Ext.decode(c.responseText)}catch(a){if(camm_start_var.is_camm_admin){if((c.statusText=="OK")&&(c.responseText.search("<br />\n<b>Fatal error</b>:")==0)){cacti.plugin.camm.showError(c.responseText,"Got PHP error from server")}else{if((c.statusText=="OK")&&(c.responseText.search("<br />\n<b>Parse error</b>:")==0)){cacti.plugin.camm.showError(c.responseText,"Got PHP parse error from server")}else{cacti.plugin.camm.showError(c.responseText,"Cannot decode JSON object")}}}else{cacti.plugin.camm.showError("It's like a error!","Cannot decode JSON object")}return}if(!Ext.ux.Utility.isNullOrUndefined(b)){if(true!==b.success){cacti.plugin.camm.showError(b.error||"Unknown error");return}}else{if(!Ext.ux.Utility.isNullOrUndefined(c.statusText)){cacti.plugin.camm.showError(c.statusText)}else{cacti.plugin.camm.showError("Unknown error")}}};cacti.plugin.camm.requestCallback=function(options,success,response){this.getEl().unmask();if(true!==success){cacti.plugin.camm.showError(response.responseText);return}try{var o=Ext.decode(response.responseText)}catch(e){cacti.plugin.camm.showError(response.responseText,"Cannot decode JSON object");return}if(true!==o.success){cacti.plugin.camm.showError(o.error||"Unknown error");return}switch(options.params.task){case"camm_recreate_tree":this.root.reload();break;case"camm_delete_syslog_message":this.getStore().reload();break;case"camm_save_rule":var records=this.store.getModifiedRecords();Ext.each(records,function(r,i){if(o.insertIds&&o.insertIds[i]){r.set(this.idName,o.insertIds[i]);delete (r.data.newRecord)}});this.store.commitChanges();this.store.reload();break;case"camm_convert_json_to_sql_string":this.record.set("json_filter",Ext.util.JSON.encode(filterModel.getFilterObj()));this.record.set("sql_filter",o.sql_filter);Ext.getCmp("id_sql_filter_trFld").setValue(o.sql_filter);this.hide();break;case"camm_save_settings":var new_settings=Ext.decode(options.params.data);Ext.each(new_settings,function(setting,i){if(setting.name in camm_start_var){if(typeof(setting.r_value)!="undefined"){eval("camm_start_var."+setting.name+"="+setting.r_value)}else{eval("camm_start_var."+setting.name+"="+setting.value)}}switch(setting.name){case"camm_use_syslog":if(camm_start_var.camm_use_syslog){MainTabs.unhideTabStripItem("syslog_tab_id")}else{MainTabs.hideTabStripItem("syslog_tab_id")}break;case"camm_use_snmptt":if(camm_start_var.camm_use_snmptt){MainTabs.unhideTabStripItem("traps_tab_id");MainTabs.unhideTabStripItem("unktraps_tab_id")}else{MainTabs.hideTabStripItem("traps_tab_id");MainTabs.hideTabStripItem("unktraps_tab_id")}break}},this);this.store.reload();break;case"camm_delete_rule":this.store.reload();break;case"camm_delete_traps":this.store.reload();break;case"camm_delete_unktraps":this.store.reload();break}};var cp=new Ext.state.CookieProvider({path:window.location.pathname,domain:window.hostname,expires:new Date(new Date().getTime()+(1000*60*60*24*2))});Ext.state.Manager.setProvider(cp);Ext.onReady(function(){Ext.QuickTips.init();if(Ext.isIE){var b=new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*7))});Ext.state.Manager.setProvider(b)}Ext.form.Field.prototype.msgTarget="side";Ext.data.Connection.prototype.timeout=60000;Ext.Panel.prototype.titleCollapse=true;RezultPanel=new Ext.ux.PanelBlind({items:[{xtype:"RezultGrid"}]});function c(e,j,h){if(true!==j){cacti.plugin.camm.showError(h.responseText);return}try{var g=Ext.decode(h.responseText)}catch(f){cacti.plugin.camm.showError(h.responseText,"Cannot decode JSON object");return}if(true!==g.success){cacti.plugin.camm.showError(g.error||"Unknown error");return}switch(e.params.task){case"camm_get_start_variable":LoadingIndicator.textContent="Ready to start";camm_start_var=g;is_camm_admin=camm_start_var.is_camm_admin;camm_start_var.is_camm_admin=(camm_start_var.is_camm_admin=="1"?true:false);camm_start_var.camm_date=(camm_start_var.camm_date?new Date(camm_start_var.camm_date).format("Y-m-d H:i:s"):new Date().format("Y-m-d H:i:s"));a();break}if(camm_start_var.count_output_mess>0){d()}}function d(){RezultPanel.items.item(0).store.load({params:{task:"view_stats"}});MainTabs.showBlind(0)}function a(){if((camm_start_var.camm_startup_tab=="0")&&!(camm_start_var.camm_use_syslog)){camm_start_var.camm_startup_tab="1"}if(((camm_start_var.camm_startup_tab=="1")||(camm_start_var.camm_startup_tab=="2"))&&!(camm_start_var.camm_use_snmptt)){camm_start_var.camm_startup_tab="5"}MainTabs=new ux.TabPanel({id:"MainTabs",region:"center",toolbars:[{id:"id2",width:270,align:"right",tbar:[{xtype:"themecyclebutton"},"-",{id:"clock",width:50}]}],plugins:[RezultPanel],deferredRender:true,margins:"2 3 0 3",resizeTabs:true,region:"center",activeTab:camm_start_var.camm_startup_tab||0,defaults:{autoScroll:true},items:[{xtype:"syslog_tab",defaults:{split:true,layout:"fit"},id:"syslog_tab_id",title:"Syslogs"},{xtype:"traps_tab",defaults:{split:true,layout:"fit"},id:"traps_tab_id",title:"SNMP Traps"},{xtype:"unktraps_tab",defaults:{split:true,layout:"fit"},id:"unktraps_tab_id"},{xtype:"rule_tab",defaults:{split:true,layout:"fit"},id:"rule_tab_id"},{xtype:"stat_tab",id:"stat_tab_id",defaults:{split:true,layout:"fit"}},{xtype:"SettingsGrid",id:"set_tab_id",defaults:{split:true,layout:"fit",title:"Settings"},disabled:(!camm_start_var.is_camm_admin)}]});var e=new Ext.Viewport({layout:"border",minWidth:600,items:[new Ext.BoxComponent({region:"north",el:"cacti_north"}),MainTabs,{region:"south",el:"cacti_south",collapseMode:"mini",collapsed:true,split:true,height:100,minSize:100,maxSize:200,collapsible:true,margins:"0 0 2 0"}]});if(!(camm_start_var.camm_use_syslog)){MainTabs.hideTabStripItem("syslog_tab_id")}if(!(camm_start_var.camm_use_snmptt)){MainTabs.hideTabStripItem("traps_tab_id");MainTabs.hideTabStripItem("unktraps_tab_id")}setTimeout(function(){Ext.get("loading-mask").fadeOut({remove:true})},650)}LoadingIndicator=Ext.get("loading-text");LoadingIndicator.dom.textContent="Loading startup variables";Ext.Ajax.request({url:"camm_db.php",method:"POST",params:{task:"camm_get_start_variable"},callback:c})});